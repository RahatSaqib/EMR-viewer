{"version":3,"sources":["components/AboutDlg.js","fs/fs.js","LinearAlgebra/utils.js","LinearAlgebra/constants.js","LinearAlgebra/Vector.js","functions.js","constants/settings.js","actions/index.js","components/Dicomdir.js","constants/uids.js","components/OpenUrlDlg.js","components/CinePlayer.js","db/db.js","LinearAlgebra/Matrix.js","LinearAlgebra/Point.js","LinearAlgebra/Line.js","DicomGeometry/DicomGeometry.js","components/DicomViewer.js","components/DicomHeader.js","components/DownloadZipDlg.js","components/DicomPreviewer.js","components/Explorer.js","components/OpenMultipleFilesDlg.js","components/FsUI.js","components/Histogram.js","components/LayoutTool.js","components/ToolsPanel.js","components/MeasureItem.js","components/Measurements.js","components/Settings.js","App.js","serviceWorker.js","store/index.js","reducers/index.js","index.js"],"names":["AboutDlg","onClose","linkRepository","Typography","variant","Link","href","target","style","color","version","packageJson","Dialog","open","DialogTitle","disableTypography","DialogContent","List","ListItem","ListItemText","primary","secondary","DialogActions","Button","autoFocus","onClick","fs","Dexie","stores","files","areEqual","one","other","epsilon","Math","abs","sum","arr","reduce","acc","value","withoutElementAtIndex","index","slice","Vector","components","this","n","hypot","_","v","map","component","round","b","zero","xabs","yabs","zabs","x","y","z","number","length","getDicomStudyId","image","data","string","undefined","getDicomIpp","ipp","split","parseFloat","getDicomEchoNumber","getDicomSliceLocation","groupBy","list","keyGetter","Map","forEach","item","key","collection","get","push","set","isInputDirSupported","tmpInput","document","createElement","isUrlImage","url","match","isFileImage","file","includes","isFsFileImage","fsItem","console","log","type","toLowerCase","getFileNameCorrect","filename","isAndroid","isFirefox","getFileExt","getFileName","ext","exec","getFileExtReal","name","replace","getSettingsSaveInto","saveInto","localStorage","getItem","setItem","getSettingsOverlay","overlay","getSettingsFsView","view","isMobile","isTablet","getSettingsDicomdirView","getSettingsMprInterpolation","method","toCsvValue","theValue","t","String","fsFileStore","fsFile","filesStore","dcmIsOpen","dcmTool","tool","activeDcm","dcm","activeMeasurements","measurements","explorerActiveSeriesIndex","setZippedFile","fsZippedFile","setDcmEnableTool","dcmEnableTool","styleScrollbar","height","ExpandIcon","expanded","Dicomdir","props","state","buildData","id","output","images","series","study","patient","reverse","obj","i","unshift","path","children","setState","buildOutput","dataset","elements","x00041220","items","e","dcmTime","dcmDate","toString","dataSet","Date","substring","toLocaleDateString","year","month","day","pop","openDicomdir","reader","FileReader","onload","arrayBuffer","result","byteArray","Uint8Array","dicomParser","err","readAsArrayBuffer","openDicomdirFs","find","dicomdir","origin","onOpenFile","fsCurrentDir","parent","join","where","first","setFsFileStore","onOpenFs","studyText","classes","styleComponent","marginTop","width","button","listItemText","Collapse","in","dense","className","PureComponent","connect","dispatch","withStyles","theme","paddingLeft","spacing","fontSize","uids","OpenUrlDlg","hide","cancel","window","stop","aria-labelledby","LinearProgress","progress","CinePlayer","firstframe","runCinePlayer","previousframe","play","pause","nextframe","lastframe","inPlay","IconButton","mdiPause","size","mdiPlay","margin","mdiSkipBackward","mdiSkipPrevious","mdiSkipNext","mdiSkipForward","db","measurement","Matrix","rows","j","r","func","newRows","row","element","componentWiseOperation","a","Error","columns","column","parts","coef","matrixRows","determinant","dimension","zeros","Array","fill","__","pow","minor","cofactor","transpose","adjugate","scaleBy","Point","sqrt","Line","p1","p2","m","c","distance","line","d","isNaN","DicomGeometry","iop","pixelSpacing","spacingY","spacingX","cols","lengthX","lengthY","rowDir","colDir","nrmDir","crossProduct","topLeft","topRight","add","mul","bottomLeft","bottomRight","sub","transformImageToRcs","transformRcsToImage","inverse","p","orientation","scrollToIndex","csTools","cornerstoneTools","cornerstone","cornerstoneMath","cornerstoneFileImageLoader","cornerstoneWebImageLoader","cornerstoneWADOImageLoader","Hammer","globalToolSyncEnabled","DicomViewer","visibleOpenUrlDlg","visibleCinePlayer","errorOnOpenImage","errorOnCors","frame","viewport","handlerMouseScroll","shouldScroll","deltaY","listOpenFilesNextFrame","listOpenFilesPreviousFrame","onOpenUrl","eventData","detail","percentComplete","showOpenUrlDlg","addEventListener","loadImage","hideOpenUrlDlg","measurementSave","measure","measurementClear","splice","measurementRemove","getTransferSyntax","getSopClass","getSopInstanceUID","getPixelRepresentation","uint16","getPlanarConfiguration","getDicomViewerElement","getElementsByClassName","onImageLoaded","onLoadedImage","onImageRendered","str","zoom","scale","toFixed","getElementById","textContent","mprIsOrthogonalView","mprPlane","charAt","toUpperCase","PatientsName","displayedArea","brhc","voi","windowWidth","windowCenter","referenceLines","isScoutDraw","referenceLinesDraw","mpr","isSliceLocation","mprSliceLocationDraw","isDicom","numberOfFrames","onRenderedImage","onMeasurementModified","onMeasurementAdded","note","measurementData","setActiveMeasurements","onMeasurementCompleted","setTimeout","onErrorOpenImageClose","onErrorCorsClose","updateImage","dicomImage","displayImageFromFiles","imageId","sliceIndex","onNewImage","sopInstanceUid","stack","currentImageIdIndex","imageIds","intString","mprPlanePosition","enableTool","equals","each","runTool","then","setActiveDcm","setIsOpenStore","loadImageFromCanvas","canvas","addCanvas","loadImageFromCustomObject","pixelData","customObj","originImage","addCustom","localfile","localurl","isOpenStore","addBuffer","fileManager","error","pos","indexOf","toolName","mouseButtonNumber","WwwcTool","LengthTool","PanTool","ZoomTouchPinchTool","ZoomTool","ProbeTool","EllipticalRoiTool","RectangleRoiTool","FreehandRoiTool","AngleTool","MagnifyTool","StackScrollMouseWheelTool","setDcmEnableToolStore","disableAllTools","opt","sliceMax","mouseButtonMask","isTouchActive","invert","activeDcmIndex","myCanvas","cropCanvas","toDataURL","download","body","appendChild","click","blobUtil","blob","newName","counter","done","fsCurrentList","transaction","byteLength","makeFsRefresh","reset","delete","sopinstanceuid","newCanvas","getContext","drawImage","changeTool","cmdName","defaultViewport","imageOrientation","matrix","Object","keys","colNumber","rowNumber","mprRenderYZPlane","mprData","volume","xSize","ySize","zSize","zDim","xoffset","floor","plane","Int16Array","yzPlane","mprBuildYZPlane","mprRenderXZPlane","trunc","xzPlane","mprBuildXZPlane","layout","mprReferenceLines","fromPlane","toPlane","offset","instanceNumberOrder","zStep","indexMax","sliceLocation","p0","start","mprReferenceLines2","mprReferenceLines3","ctx","beginPath","setLineDash","lineWidth","strokeStyle","moveTo","lineTo","stroke","referenceLinesBuild","srcImage","dst","src","isReferenceLine","referenceLinesBuildLine","nP","dotProduct","nA","nB","nC","nD","startPoint","transformDstPatientPointToImage","endPoint","transformed","multiply","referenceLinesBuildPlane","pixel","rotation","toArray","toMatrix","ctxH","max","line0","line1","line2","line3","min","dicomImageRef","el","onImageClick","isLocalizer","values","findFirstSliceWithIppValue","ippValue","ippPos","increasing","sliceDistance","explorerIndex","layoutIndex","dcmRef","previousProps","isOpen","visible","styleContainer","border","position","DialogContentText","textShadow","visibility","onContextMenu","ref","top","left","display","right","bottom","marginLeft","marginRight","textAlign","backgroundColor","React","Component","clearingStore","toolStore","DicomHeader","dcmViewer","header","minPixelValue","maxPixelValue","listItems","Toolbar","title","grow","exportAs","fileData","objArray","cDelimiter","l","nl","names","sDelimiter","hasOwnProperty","toCsv","o","JSON","stringify","Blob","URL","createObjectURL","mdiContentSaveOutline","source","axios","CancelToken","DownloadZipDlg","loading","requestDownloadZip","responseType","cancelToken","token","onDownloadProgress","progressEvent","percentCompleted","loaded","total","response","setFsZippedFile","catch","DicomPreviewer","getSeriesNumber","seriesList","seriesKeys","seriesNumber","getSeriesLength","getSeriesDescription","seriesDescription","padding","styleDicomViewerStack","styleDicomViewer","Explorer","patientName","explorer","studies","seriesActiveIndex","setDcmViewer","dicomViewersRefs","getDcmViewerRef","getDcmViewer","dicomViewers","buildPreviewStack","dicomviewers","previewStackClick","onTouchStart","previewStackTouch","gridTemplateRows","gridTemplateColumns","handlePatientChange","event","patientIndex","filesListForPatient","allFiles","filter","studyList","studyDateTime","studyKeys","setSeriesStore","setExplorerActivePatientIndex","handleStudyChange","studyIndex","studyDate","studyDescription","setExplorerActiveSeriesIndex","onSelectSeries","clear","explorerActivePatientIndex","explorerActiveStudyIndex","seriesIndex","sort","FormControl","formControl","InputLabel","Select","selectText","labelId","onChange","MenuItem","menuItemText","setFilesStore","setExplorer","setExplorerActiveStudyIndex","seriesStore","minWidth","selectEmpty","OpenMultipleFilesDlg","close","count","step","nextProgress","t0","performance","now","getDicomPatientName","studyId","getDicomStudyDate","studyTime","getDicomStudyTime","getDicomStudyDescription","seriesDate","getDicomSeriesDate","seriesTime","getDicomSeriesTime","getDicomSeriesDescription","getDicomSeriesNumber","instanceNumber","getDicomInstanceNumber","topLeftCorner","dist","getDicomSliceDistance","echoNumber","getDicomColumns","getDicomRows","dateTime","date","time","localeDate","dicomDateTimeToLocale","t1","FsUI","textFieldLabel","textFieldValue","selected","selectedCopy","visibleTextField","visibleDeleteDlg","visibleOthers","visibleAlreadyExistDlg","visibleOSaveAsDlg","visibleWaiting","visibleOpenMultipleFilesDlg","doSelectUnselect","newSelected","openSelectedFilesRetrieveItems","startsWithIgnoreCase","openSelectedFiles","hideOpenMultipleFilesDlg","onOpenMultipleFilesCompleted","onOpenImage","createDir","renameItem","lastSelected","previousDir","nextDir","setCurrentDir","fsListDir","confirmText","oldParent","fsBuildParent","newParent","fsCreateDir","cancelDir","saveItem","localFileStore","buffer","copyItem","newSelectedCopy","cutItem","cut","pasteItem","deleteItem","showOthers","exportItem","itemClick","selectedIndex","concat","itemDoubleClick","onOpenDicomdir","onOpen","showDeleteDlg","hideDeleteDlg","confirmDeleteDlg","hideAlreadyExistDlg","hideSaveAs","closeSaveAs","saveAsField","zip","JSZip","folder","generateAsync","saveAs","mouseDown","timer","mouseUp","clearTimeout","itemsCount","createRef","loadAsync","contents","relativePath","zipEntry","dir","async","content","fsAddItem","put","create","sortBy","and","setCurrentList","totalItemsCount","Paper","textPaper","InputBase","textInput","placeholder","defaultValue","textButton","mdiCheck","mdiClose","leftButtons","CircularProgress","Tooltip","mdiChevronLeft","toolbarButtons","mdiCheckBoxOutline","mdiFolderOutline","mdiFolderPlusOutline","mdiSquareEditOutline","mdiDotsHorizontal","mdiContentCut","mdiContentCopy","mdiContentPaste","mdiDeleteOutline","mdiExportVariant","float","TableContainer","Table","table","TableHead","TableRow","TableCell","align","TableBody","isItemSelected","role","hover","onDoubleClick","onTouchEnd","onMouseDown","onMouseUp","scope","tableCellText","bytes","decimals","k","dm","sizes","formatBytes","TextField","inputRef","input","fullWidth","localFile","fsRefresh","setFsCurrentDir","setFsCurrentList","alignItems","flex","styleSlider","styleCanvasGradient","styleTable","borderCollapse","fontFamily","styleTableTd","tableLayout","Histogram","activeDrags","deltaPosition","controlledPosition","histCount","valueScale","minHist","maxHist","mean","stdDev","indexDcm","handleChangeValue","newValue","binSize","hist256","onDrag","ui","deltaX","onStart","onStop","canvasHistogram","canvasGradient","canvasH","current","translate","updateCanvas","evt","rect","getBoundingClientRect","clientX","clientY","getPixelData","storedPixelData","spIndex","red","green","blue","alpha","getRGBPixelsImage","getPixelsImage","intercept","lenHist","zero256","stepWW","stepWC","hist","mo","getPixel","slope","s","binStep","iHist","clearRect","mousePos","getMousePos","fillStyle","fillRect","h","lowX","highX","ctxG","grd","createLinearGradient","addColorStop","cursor","Slider","LayoutTool","initTable","col","tableRef","cells","bgColor","cellClick","parentNode","rowIndex","cellIndex","renderTable","ToolsPanel","colorIcon","toolActive","toolExecute","mdiCursorDefault","mdiArrowSplitHorizontal","mdiVectorLink","seriesLink","mdiArrowAll","mdiCursorPointer","mdiMagnify","mdiCheckboxIntermediate","mdiRuler","mdiEyedropper","mdiAngleAcute","mdiEllipse","mdiRectangle","mdiGesture","MeasureItem","visibleDlgNote","visibleDlgDelete","showDlgNote","hideDlgNote","showDlgDelete","hideDlgDelete","handleOnChangeNote","confirmNote","noteField","confirmDelete","toolRemove","onEdit","onDelete","pText","sText","unit","rAngle","cachedStats","area","meanStdDev","edge","Measurements","visibleClearMeasureDlg","showClearMeasureDlg","hideClearMeasureDlg","confirmClearMeasureDlg","useStyles","makeStyles","appBar","formLabel","radioControl","Settings","getSettingsSaveAs","getSettingsDcmHeader","fsView","dicomdirView","mprInterpolation","useState","fullScreen","AppBar","elevation","aria-label","FormControlLabel","control","Checkbox","checked","label","FormLabel","RadioGroup","Radio","App","anchorElLayout","anchorElToolsPanel","openMenu","openImageEdit","openTools","mprMenu","mprMode","textMessage","titleMessage","visibleMainMenu","visibleHeader","visibleSettings","visibleToolbar","visibleOpenUrl","visibleToolbox","visibleTools","visibleMeasure","visibleAbout","visibleDicomdir","visibleFileManager","visibleZippedFileDlg","visibleDownloadZipDlg","toolState","listOpenFilesScrolling","visibleVolumeBuilding","visibleMpr3D","visibleMprOrthogonal","visibleMprCoronal","visibleMprSagittal","visibleMprAxial","visibleExplorer","visibleMessage","visibleReferenceLines","visibleSeriesLink","dicomViewersRef","crossViewer","isSliceChange","referenceLinesShow","getActiveDcmViewer","handleOpenLocalFs","filesSelected","changeLayout","setLocalFileStore","handleOpenSandboxFs","handleOpenImage","isArray","getOwnPropertyNames","activeDcmViewersNum","getActiveDcmViewers","getActiveDcmViewersSameStudy","getActiveDcmViewersSamePlane","dicomViewersActive","handleOpenFileDicomdir","handleOpenFolder","handleOpenFolderDo","webkitRelativePath","handleOpenDicomdir","datafiles","setDicomdirStore","toggleDicomdir","handleOpenFsDicomdir","showAppBar","scrollTo","toggleMainMenu","showMainMenu","hideMainMenu","handleVisibility","toggleFileManager","toggleExplorer","toggleHeader","toggleToolbox","saveMeasure","toggleMeasure","hideMeasure","handleVisibilityMeasure","clearMeasure","showZippedFileDlg","hideZippedFileDlg","confirmZippedFileDlg","showAbout","showSettings","hideSettings","handleVisibilitySettings","hideDownloadZipDlg","openMultipleFilesCompleted","patientList","patientKeys","showOpenUrl","hideOpenUrl","openDlg","openUrlField","downloadOpenUrl","resetImage","saveShot","cinePlayer","layoutGridClick","handleLayout","currentTarget","closeLayout","isMultipleFiles","setLayoutStore","handleToolsPanel","closeToolsPanel","referenceLinesToggle","seriesLinkToggle","toolChange","toggleOpenMenu","toggleImageEdit","toggleTools","toggleMpr","setActiveDcmIndex","scoutViewer","layoutGridTouch","buildLayoutGrid","styleLayoutGrid","getStringVisiblePlane","appBarTitle","referenceLinesHide","crossMprPlane","openViewers","mprBuildVolume","xPixelSpacing","getDicomPixelSpacing","spacingBetweenSlice","getDicomSpacingBetweenSlice","sliceThickness","getDicomSliceThickness","zDimMethod2","len","emptyPlane","order","iFile","previous","object","isOnRows","getDicomImageXOnRows","sign","intervals","ceil","interpolationMethod","w","changeToOrthogonalView","changeToSagittalView","changeToCoronalView","changeToAxialView","xzIndex","yzIndex","force","mpr3D","mprOrthogonal","from","to","mprSagittal","mprCoronal","mprAxial","listOpenFilesFirstFrame","syncActiveDcmViewersSamePlane","listOpenFilesLastFrame","scrolling","clearInterval","timerScrolling","setInterval","handleSliceChange","explorerOnSelectSeries","dicomViewersActiveSameStudy","dicomViewersActiveSamePlane","direction","ippX","ippY","ippZ","fileOpen","showFileOpen","bind","showOpenDicomdir","openFolder","showOpenFolder","primaryClass","isDicomdir","visibleLayout","Boolean","visibleToolsPanel","backgroundImage","borderRadius","menuButton","mdiVideo","mdiRefresh","mdiTools","mdiCamera","mdiFileCad","mdiFileDocument","mdiFolderOpen","mdiAnimationOutline","mdiFileCabinet","Drawer","zIndex","toolbar","ListItemIcon","mdiFolderMultiple","timeout","unmountOnExit","mdiFolder","mdiDelete","mdiViewGridPlusOutline","mdiCog","Divider","disabled","mdiChartHistogram","mdiAxisArrow","mdiImageEdit","mdiInvertColors","anchor","mdiTrashCanOutline","Popover","anchorEl","anchorOrigin","vertical","horizontal","transformOrigin","Snackbar","autoHideDuration","message","multiple","webkitdirectory","mozdirectory","directory","setLayout","setDicomdir","setVolumeStore","palette","common","black","flexGrow","root","BorderRadius","drawer","transition","transitions","easing","sharp","duration","leavingScreen","appBarShift","enteringScreen","flexShrink","whiteSpace","drawerOpen","drawerClose","overflowX","breakpoints","up","mixins","isLocalhost","location","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","initialState","store","createStore","action","__REDUX_DEVTOOLS_EXTENSION__","WebFontLoader","load","google","families","createMuiTheme","overrides","MuiFormControlLabel","MuiFormLabel","main","ReactDOM","render","process","fetch","contentType","headers","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.5b683753.chunk.js","sourcesContent":["import React from 'react'\r\nimport Button from '@material-ui/core/Button'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport DialogContent from '@material-ui/core/DialogContent'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport Link from '@material-ui/core/Link'\r\nimport List from '@material-ui/core/List'\r\nimport ListItem from '@material-ui/core/ListItem'\r\nimport ListItemText from '@material-ui/core/ListItemText'\r\nimport Typography from '@material-ui/core/Typography'\r\nimport packageJson from '../../package.json'\r\n\r\nconst AboutDlg = ({ onClose }) => {\r\n\r\n    const urlRepository = \"https://bdemr.com/\"\r\n\r\n    const linkRepository = (\r\n        <Typography variant='body2'>\r\n            <Link \r\n                href={urlRepository} \r\n                target='_blank'\r\n                style={{ color: '#999999' }}\r\n            >\r\n                https://bdemr.com/\r\n            </Link>\r\n        </Typography>\r\n    )\r\n\r\n    const version = (\r\n        <Typography variant='body2' style={{ color: '#999999' }}>\r\n            {packageJson.version}\r\n        </Typography>        \r\n    )\r\n\r\n    return (\r\n      <div>\r\n        <Dialog onClose={onClose} open={true}>\r\n            <DialogTitle onClose={onClose} disableTypography={true}>\r\n                <Typography variant='h6'>\r\n                    About <strong>D</strong>icom <strong>V</strong>iewer\r\n                </Typography>\r\n            </DialogTitle>\r\n            <DialogContent>\r\n                <List>\r\n                    <ListItem>\r\n                        <ListItemText \r\n                            primary='Repository URL:' \r\n                            secondary={linkRepository} \r\n                        />\r\n                    </ListItem>    \r\n                    <ListItem>\r\n                        <ListItemText \r\n                            primary='Version:' \r\n                            secondary={version} \r\n                        />\r\n                    </ListItem>                        \r\n                </List>        \r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button autoFocus onClick={onClose}>\r\n                    Close\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n      </div>\r\n    )\r\n}\r\n\r\nexport default AboutDlg\r\n","import Dexie from 'dexie'\r\n\r\nconst fs = new Dexie('fsDB')\r\n\r\nfs.version(1).stores({ \r\n    files: '[parent+name], parent, name, type' \r\n})\r\n\r\nfs.open()\r\n\r\nexport default fs\r\n","import { EPSILON } from './constants'\r\n\r\nexport const areEqual = (one, other, epsilon = EPSILON) => Math.abs(one - other) < epsilon\r\nexport const isNearlyZero = (v) => Math.abs(v) < EPSILON\r\nexport const toDegrees = radians => (radians * 180) / Math.PI\r\nexport const toRadians = degrees => (degrees * Math.PI) / 180\r\nexport const sum = arr => arr.reduce((acc, value) => acc + value, 0)\r\nexport const withoutElementAtIndex = (arr, index) => [ ...arr.slice(0, index), ...arr.slice(index + 1) ]\r\n\r\n\r\n","export const EPSILON = 0.000000001\r\n\r\n","import { isNearlyZero } from './utils'\r\n\r\nexport default class Vector {\r\n    \r\n    constructor(...components) {\r\n      this.components = components\r\n    }\r\n\r\n    static get zero() {\r\n        return new Vector(0, 0, 0)\r\n    }\r\n    \r\n    get x() {\r\n        return this.components[0]\r\n    }\r\n    \r\n    set x(n) {\r\n        this.components[0] = n\r\n    }\r\n\r\n    get y() {\r\n        return this.components[1]\r\n    } \r\n\r\n    set y(n) {\r\n        this.components[1] = n\r\n    } \r\n\r\n    get z() {\r\n        return this.components[2]\r\n    } \r\n\r\n    set z(n) {\r\n        this.components[2] = n\r\n    } \r\n\r\n    length() {\r\n        return Math.hypot(...this.components)\r\n    }\r\n\r\n    isZero() {\r\n        return this.components.reduce((acc, _, index) => acc && isNearlyZero(this.components[index]), true)\r\n    }\r\n\r\n    abs() {\r\n        return new Vector(\r\n            ...this.components.map(component => Math.abs(component))\r\n        )\r\n    }\r\n\r\n    round() {\r\n        return new Vector(\r\n            ...this.components.map(component => Math.round(component))\r\n        )\r\n    }\r\n\r\n    nearestAxis() {\r\n        const b = Vector.zero\r\n        const xabs = Math.abs(this.components[0])\r\n        const yabs = Math.abs(this.components[1])\r\n        const zabs = Math.abs(this.components[2])\r\n\r\n        if (xabs >= yabs && xabs >= zabs) b.x = (this.components[0] > 0.0) ? 1.0 : -1.0\r\n        else if (yabs >= zabs) b.y = (this.components[1] > 0.0) ? 1.0 : -1.0\r\n        else b.z = (this.components[2] > 0.0) ? 1.0 : -1.0\r\n\r\n        return b\r\n    }\r\n\r\n    toArray() {\r\n        return this.components\r\n    }\r\n\r\n    mul(number) {\r\n        return new Vector(\r\n            ...this.components.map(component => component * number)\r\n        )\r\n    }\r\n\r\n    add({ components }) {\r\n        return new Vector(\r\n            ...components.map((component, index) => this.components[index] + component)\r\n        )\r\n    }\r\n\r\n    sub({ components }) {\r\n        return new Vector(\r\n            ...components.map((component, index) => this.components[index] - component)\r\n        )\r\n    }\r\n\r\n    crossProduct({ components }) {\r\n        if (this.components.length !== 3) return // 3D vectors only\r\n        return new Vector(\r\n            this.components[1] * components[2] - this.components[2] * components[1],\r\n            this.components[2] * components[0] - this.components[0] * components[2],\r\n            this.components[0] * components[1] - this.components[1] * components[0]\r\n        )\r\n    }\r\n\r\n    dotProduct({ components }) {\r\n        return components.reduce((acc, component, index) => acc + component * this.components[index], 0)\r\n    }\r\n    \r\n}\r\n\r\n","import Vector from './LinearAlgebra/Vector'\r\nimport { \r\n    isAndroid,\r\n    isFirefox,\r\n    isMobile, \r\n    isTablet \r\n  } from 'react-device-detect'\r\nimport { \r\n    SETTINGS_SAVEAS, \r\n    SETTINGS_SAVEINTO,\r\n    SETTINGS_DCMHEADER, \r\n    SETTINGS_OVERLAY, \r\n    SETTINGS_MEASUREMENT,\r\n    SETTINGS_FSVIEW,\r\n    SETTINGS_DICOMDIRVIEW,    \r\n    SETTINGS_MPRINTERPOLATION,\r\n} from './constants/settings'\r\n\r\n\r\n//  DICOM\r\n//#region DICOM\r\n\r\nexport function getDicomPatientName(image) {\r\n    const value = image.data.string('x00100010')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value\r\n}\r\n\r\nexport function getDicomStudyId(image) {\r\n    if (image === null) return null\r\n    const value = image.data.string('x00200010')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value\r\n}\t\r\n\r\nexport function getDicomStudyDate(image) {\r\n    const value = image.data.string('x00080020')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value\r\n}\t\r\n\r\nexport function getDicomStudyTime(image) {\r\n    const value = image.data.string('x00080030')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value\r\n}\t\r\n\r\nexport function getDicomStudyDescription(image) {\r\n    const value = image.data.string('x00081030')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value\r\n}\t\r\n\r\nexport function getDicomSeriesDate(image) {\r\n    const value = image.data.string('x00080021')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value\r\n}\t\r\n\r\nexport function getDicomSeriesTime(image) {\r\n    const value = image.data.string('x00080031')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value\r\n}\t\r\n\r\nexport function getDicomSeriesDescription(image) {\r\n    const value = image.data.string('x0008103e')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value\r\n}\r\n\r\nexport function getDicomSeriesNumber(image) {\r\n    const value = image.data.string('x00200011')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return parseFloat(value)\r\n}\r\n\r\nexport function getDicomModality(image) {\r\n    const value = image.data.string('x00080060')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value\r\n}\r\n\r\nexport function getDicomIpp(image, index) {\r\n    const value = image.data.string('x00200032')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    const ipp = value.split('\\\\')\r\n    return parseFloat(ipp[index])\r\n}\r\n\r\nexport function getDicomFrameOfReferenceUID(image) {\r\n    const value = image.data.string('x00200052')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value\r\n}\r\n\r\nexport function getDicomPixelSpacing(image, index) {\r\n    const value = image.data.string('x00280030')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    const pixelSpacing = value.split('\\\\')\r\n    return pixelSpacing[index]\r\n}\r\n\r\nexport function getDicomSpacingBetweenSlice(image) {\r\n    const value = image.data.string('x00180088')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return parseFloat(value)\r\n}\r\n\r\nexport function getDicomSliceThickness(image) {\r\n    const value = image.data.string('x00180050')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return parseFloat(value)\r\n}\r\n\r\nexport function getDicomEchoNumber(image) {\r\n    const value = image.data.string('x00180086')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return parseFloat(value)\r\n}\r\n\r\n\r\nexport function getDicomPatientPosition(image) {\r\n    const value = image.data.string('x00185100')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return parseFloat(value)\r\n}\r\n\r\nexport function getDicomSliceLocation(image) {\r\n    const value = image.data.string('x00201041')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return parseFloat(value)\r\n}\t\r\n\r\nexport function getDicomInstanceNumber(image) {\r\n    const value = image.data.string('x00200013')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value\r\n}\t\r\n\r\nexport function getDicomRows(image) {\r\n    const value = image.data.uint16('x00280010')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value    \r\n}\r\n\r\nexport function getDicomColumns(image) {\r\n    const value = image.data.uint16('x00280011')\r\n    if (value === undefined) {\r\n        return\r\n    }\r\n    return value    \r\n} \r\n\r\nexport function isLocalizer(image) {\r\n    const values = image.data.string('x00080008').split('\\\\')\r\n    console.log('Localizer: ', values)\r\n    return values.length === 3 && values[2] === 'LOCALIZER'\r\n}\r\n\r\nexport function getDicomNearestAxis(image) {\r\n    const ipp = image.data.string('x00200032').split('\\\\').map(v => parseFloat(v)) // Image Position Patient - x, y, z of top hand corner\r\n    const xabs = Math.abs(ipp[0])\r\n    const yabs = Math.abs(ipp[1])\r\n    const zabs = Math.abs(ipp[2])\r\n    let axes = Vector.zero\r\n    if (xabs >= yabs && xabs >= zabs) \r\n        axes.x = (ipp[0] > 0.0) ? 1.0 : -1.0\r\n    else if (yabs >= zabs) \r\n        axes.y = (ipp[1] > 0.0) ? 1.0 : -1.0\r\n    else \r\n        axes.z = (ipp[2] > 0.0) ? 1.0 : -1.0\r\n    return axes\r\n}\r\n\r\nexport function getDicomImageXOnRows(image) {\r\n    const iop = image.data.string('x00200037').split('\\\\').map(v => parseFloat(v))\r\n    if (iop[0] > iop[1]) return true\r\n    else return false\r\n}\r\n\r\n\r\nexport function getDicomSliceDistance(image) {\r\n    try {\r\n        const ipp = image.data.string('x00200032').split('\\\\') // Image Position Patient\r\n\r\n        let topLeftCorner = new Array(3).fill(0)\r\n        topLeftCorner[0] = parseFloat(ipp[0]) // X pos of frame (Top left) in real space\r\n        topLeftCorner[1] = parseFloat(ipp[1]) // Y pos of frame (Top left) in real space\r\n        topLeftCorner[2] = parseFloat(ipp[2]) // Z pos of frame (Top left) in real space\r\n\r\n        const iop = image.data.string('x00200037').split('\\\\') // Image Orientation Patient\r\n        let v = new Array(3).fill(0).map(() => new Array(3).fill(0))\r\n\r\n        v[0][0] = parseFloat(iop[0]) // the x direction cosines of the first row X\r\n        v[0][1] = parseFloat(iop[1]) // the y direction cosines of the first row X\r\n        v[0][2] = parseFloat(iop[2]) // the z direction cosines of the first row X\r\n        v[1][0] = parseFloat(iop[3]) // the x direction cosines of the first column Y\r\n        v[1][1] = parseFloat(iop[4]) // the y direction cosines of the first column Y\r\n        v[1][2] = parseFloat(iop[5]) // the z direction cosines of the first column Y \r\n\r\n        // calculate the slice normal from IOP\r\n        v[2][0] = v[0][1] * v[1][2] - v[0][2] * v[1][1]\r\n        v[2][1] = v[0][2] * v[1][0] - v[0][0] * v[1][2]\r\n        v[2][2] = v[0][0] * v[1][1] - v[0][1] * v[1][0]\r\n        \r\n        //console.log(\"slice normal from IOP: \", v[2])\r\n\r\n        let dist = 0\r\n        for (let i = 0; i < 3; ++i) \r\n            dist += v[2][i] * topLeftCorner[i]\r\n        \r\n        return dist\r\n    } catch(error) {\r\n        return 0\r\n    }\r\n}\r\n\r\nexport function dicomDateToLocale(dcmDate) {\r\n    const date = new Date(dcmDate.substring(0, 4)+'-'+dcmDate.substring(4, 6)+'-'+dcmDate.substring(6))\r\n    const localeDate = date.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' })\r\n    return localeDate\r\n}\r\n\r\nexport function dicomTimeToStr(dcmTime) {\r\n    const time = dcmTime.substring(0, 2)+':'+dcmTime.substring(2, 4)+':'+dcmTime.substring(4, 6)\r\n    return time\r\n}\r\n\r\nexport function dicomDateTimeToLocale(dateTime) {\r\n    const date = new Date(dateTime.substring(0, 4)+'-'+dateTime.substring(4, 6)+'-'+dateTime.substring(6, 8))\r\n    const time = dateTime.substring(9, 11)+':'+dateTime.substring(11, 13)+':'+dateTime.substring(13, 15)\r\n    const localeDate = date.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' })\r\n    return `${localeDate} - ${time}`\r\n}\r\n\r\n//#endregion  \r\n\r\nexport function groupBy(list, keyGetter) {\r\n    const map = new Map()\r\n    list.forEach((item) => {\r\n        const key = keyGetter(item)\r\n        const collection = map.get(key)\r\n        if (!collection) {\r\n            map.set(key, [item])\r\n        } else {\r\n            collection.push(item)\r\n        }\r\n    })\r\n    return map\r\n}\r\n\r\nexport function objectIsEmpty(obj) {\r\n    if (obj === null || obj === undefined || Array.isArray(obj) || typeof obj !== 'object') {\r\n        return true\r\n    }\r\n    return Object.getOwnPropertyNames(obj).length === 0\r\n}\r\n\r\nexport function capitalize(str) {\r\n    if (str === undefined) \r\n        return ''\r\n    else \r\n        return str.charAt(0).toUpperCase() + str.slice(1)\r\n}\r\n\r\n\r\nexport function log() {\r\n    let log = localStorage.getItem('debug-u-dicom-viewer')\r\n    if (log === null) {\r\n        console.log = function(){}\r\n    }\r\n}\r\n\r\nexport function isInputDirSupported() {\r\n    var tmpInput = document.createElement('input')\r\n    if ('webkitdirectory' in tmpInput \r\n        || 'mozdirectory' in tmpInput \r\n        || 'odirectory' in tmpInput \r\n        || 'msdirectory' in tmpInput \r\n        || 'directory' in tmpInput) return true\r\n    return false\r\n}\r\n\r\nexport function isUrlImage(url) {\r\n    if (url === undefined || url === null) return false\r\n    return(url.match(/\\.(jpeg|jpg|png)$/) != null)\r\n}\r\n\r\nexport function isFileImage(file) {\r\n    if (file === undefined || file === null) return false \r\n    const acceptedImageTypes = ['image/jpeg', 'image/png'] // 'image/gif', \r\n    return file && acceptedImageTypes.includes(file['type'])\r\n}\r\n\r\nexport function isFsFileImage(fsItem) {\r\n    console.log('isFsFileImage: ', fsItem)\r\n    if (fsItem === undefined || fsItem === null) return false\r\n    return fsItem.type.toLowerCase() === 'jpeg' || fsItem.type.toLowerCase() === 'png'\r\n}\r\n\r\nexport function getFileNameCorrect(filename) {\r\n    if (isAndroid && isFirefox) { // possible uncorrect .null extension is found in Android Firefox, it's a bug? CHECK IT\r\n        const ext = getFileExt(filename)\r\n        if (ext === 'null') {\r\n            return getFileName(filename)\r\n        }\r\n    }\r\n    return filename \r\n}\r\n\r\nexport function getFileExt(file) {\r\n    const re = /(?:\\.([^.]+))?$/\r\n    const ext = re.exec(file)[1]\r\n    if (ext === undefined) {\r\n        return 'dcm'\r\n    }\r\n    return ext\r\n}\r\n\r\nexport function getFileExtReal(file) {\r\n    const re = /(?:\\.([^.]+))?$/\r\n    const ext = re.exec(file)[1]\r\n    if (ext === undefined) {\r\n        return ''\r\n    }\r\n    return ext\r\n}\r\n\r\nexport function getFileName(file) {\r\n    const name = file.replace(/\\.[^.$]+$/, '')\r\n    if (name === undefined) {\r\n        return ''\r\n    }\r\n    return name    \r\n}\r\n\r\nexport function formatBytes(bytes, decimals = 2) {\r\n    if (bytes === '') return ''\r\n    if (bytes === 0) return '0 Bytes'\r\n    const k = 1024\r\n    const dm = decimals < 0 ? 0 : decimals\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i]\r\n}\r\n\r\n\r\n//  SETTINGS \r\n//#region  SETTINGS\r\n\r\nexport function getSettingsSaveAs() {\r\n    let saveAs = localStorage.getItem(SETTINGS_SAVEAS)\r\n    if (saveAs === null) {\r\n      saveAs = \"png\"\r\n      localStorage.setItem(SETTINGS_SAVEAS, saveAs)\r\n    }\r\n    return saveAs\r\n}\r\n\r\nexport function setSettingsSaveAs(value) {\r\n    localStorage.setItem(SETTINGS_SAVEAS, value)  \r\n}\r\n\r\nexport function getSettingsSaveInto() {\r\n    let saveInto = localStorage.getItem(SETTINGS_SAVEINTO)\r\n    if (saveInto === null) {\r\n        saveInto = \"local\"\r\n      localStorage.setItem(SETTINGS_SAVEINTO, saveInto)\r\n    }\r\n    return saveInto\r\n}\r\n\r\nexport function setSettingsSaveInto(value) {\r\n    localStorage.setItem(SETTINGS_SAVEINTO, value)  \r\n}\r\n\r\nexport function getSettingsDcmHeader() {\r\n    let exportAs = localStorage.getItem(SETTINGS_DCMHEADER)\r\n    if (exportAs === null) {\r\n      exportAs = \"json\"\r\n      localStorage.setItem(SETTINGS_DCMHEADER, exportAs)\r\n    }  \r\n    return exportAs\r\n}\r\n\r\nexport function setSettingsDcmHeader(value) {\r\n    localStorage.setItem(SETTINGS_DCMHEADER, value)  \r\n}\r\n\r\nexport function getSettingsOverlay() {\r\n    let overlay = localStorage.getItem(SETTINGS_OVERLAY)\r\n    if (overlay === null) {\r\n      overlay = \"1\"\r\n      localStorage.setItem(SETTINGS_OVERLAY, overlay)\r\n    }\r\n    return overlay === '1'\r\n}\r\n\r\nexport function setSettingsOverlay(value) {\r\n    localStorage.setItem(SETTINGS_OVERLAY, value ? '1' : '0')  \r\n}\r\n\r\nexport function getSettingsMeasurement() {\r\n    let measurement = localStorage.getItem(SETTINGS_MEASUREMENT)\r\n    if (measurement === null) {\r\n        measurement = '1'\r\n        localStorage.setItem(SETTINGS_MEASUREMENT, measurement)\r\n    }\r\n    return measurement\r\n}\r\n\r\nexport function setSettingsMeasurement(value) {\r\n    localStorage.setItem(SETTINGS_MEASUREMENT, value)  \r\n}\r\n\r\nexport function getSettingsFsView() {\r\n    let view = localStorage.getItem(SETTINGS_FSVIEW)\r\n    if (view === null) {\r\n        view = isMobile && !isTablet ? 'bottom' : 'right'\r\n        localStorage.setItem(SETTINGS_FSVIEW, view)\r\n    }\r\n    return view\r\n}\r\n\r\nexport function setSettingsFsView(value) {\r\n    localStorage.setItem(SETTINGS_FSVIEW, value)  \r\n}\r\n\r\nexport function getSettingsDicomdirView() {\r\n    let view = localStorage.getItem(SETTINGS_DICOMDIRVIEW)\r\n    if (view === null) {\r\n        view = isMobile && !isTablet ? 'bottom' : 'right'\r\n        localStorage.setItem(SETTINGS_DICOMDIRVIEW, view)\r\n    }\r\n    return view\r\n}\r\n\r\nexport function setSettingsDicomdirView(value) {\r\n    localStorage.setItem(SETTINGS_DICOMDIRVIEW, value)  \r\n}\r\n\r\nexport function getSettingsMprInterpolation() {\r\n    let method = localStorage.getItem(SETTINGS_MPRINTERPOLATION)\r\n    if (method === null) {\r\n        method = 'weightedlinear'\r\n        localStorage.setItem(SETTINGS_MPRINTERPOLATION, method)\r\n    }\r\n    return method\r\n}\r\n\r\nexport function setSettingsMprInterpolation(value) {\r\n    localStorage.setItem(SETTINGS_MPRINTERPOLATION, value)  \r\n}\r\n\r\n//#endregion\r\n\r\n\r\nfunction toCsvValue(theValue) {\r\n    let t = typeof theValue,\r\n        output\r\n\r\n    let sDelimiter = '\"'\r\n\r\n    if (t === 'undefined' || t === null) {\r\n        output = ''\r\n    } else if (t === 'string') {\r\n        output = sDelimiter + theValue.replace(/\"/g, '\"\"') + sDelimiter\r\n    } else {\r\n        output = sDelimiter + String(theValue).replace(/\"/g, '\"\"') + sDelimiter\r\n    }\r\n\r\n    return output\r\n}\r\n\r\n\r\nexport function toCsv(objArray, cDelimiter) {\r\n    var i,\r\n        l,\r\n        names = [],\r\n        name,\r\n        value,\r\n        obj,\r\n        row,\r\n        output = '',\r\n        n,\r\n        nl\r\n\r\n    // Initialize default parameters.\r\n\r\n    let sDelimiter = '\"'\r\n    if (typeof cDelimiter === 'undefined' || cDelimiter === null) {\r\n        cDelimiter = ','\r\n    }\r\n\r\n    for (i = 0, l = objArray.length; i < l; i += 1) {\r\n        // Get the names of the properties.\r\n        obj = objArray[i]\r\n        row = ''\r\n        if (i === 0) {\r\n            // Loop through the names\r\n            for (name in obj) {\r\n                if (obj.hasOwnProperty(name)) {\r\n                    names.push(name)\r\n                    row += [\r\n                        sDelimiter,\r\n                        name.replace(/\"/g, '\"\"'),\r\n                        sDelimiter,\r\n                        cDelimiter,\r\n                    ].join('')\r\n                }\r\n            }\r\n            row = row.substring(0, row.length - 1)\r\n            output += row\r\n        }\r\n\r\n        output += '\\n'\r\n        row = ''\r\n        for (n = 0, nl = names.length; n < nl; n += 1) {\r\n            name = names[n]\r\n            value = obj[name]\r\n            if (n > 0) {\r\n                row += cDelimiter\r\n            }\r\n            row += toCsvValue(value)\r\n        }\r\n        output += row\r\n    }\r\n\r\n    return output\r\n}\r\n\r\n","\r\nexport const SETTINGS_SAVEAS = 'saveAs'\r\nexport const SETTINGS_SAVEINTO = 'saveInto'\r\nexport const SETTINGS_DCMHEADER = 'exportAs'\r\nexport const SETTINGS_OVERLAY = 'overlay'\r\nexport const SETTINGS_MEASUREMENT = 'measurement'\r\nexport const SETTINGS_FSVIEW = 'fsView'\r\nexport const SETTINGS_DICOMDIRVIEW = 'dicomdirView'\r\nexport const SETTINGS_MPRINTERPOLATION = 'mprInterpolation'\r\n","export const CLEAR_STORE = 'CLEAR_STORE'\r\nexport const LOCALFILE_STORE = 'LOCALFILE_STORE'\r\nexport const FSFILE_STORE = 'LOCALFILE_STORE'\r\nexport const FILES_STORE = 'FILES_STORE'\r\nexport const SERIES_STORE = 'SERIES_STORE'\r\nexport const DCM_IS_OPEN = 'DCM_IS_OPEN'\r\nexport const DCM_TOOL = 'DCM_TOOL'\r\nexport const ACTIVE_DCM_INDEX = 'ACTIVE_DCM_INDEX'\r\nexport const ACTIVE_DCM = 'ACTIVE_DCM'\r\nexport const ACTIVE_MEASUREMENTS = 'ACTIVE_MEASUREMENTS'\r\nexport const EXPLORER_STORE = 'EXPLORER_STORE'\r\nexport const EXPLORER_ACTIVE_PATIENT_INDEX = 'EXPLORER_ACTIVE_PATIENT_INDEX'\r\nexport const EXPLORER_ACTIVE_STUDY_INDEX = 'EXPLORER_ACTIVE_STUDY_INDEX'\r\nexport const EXPLORER_ACTIVE_SERIES_INDEX = 'EXPLORER_ACTIVE_SERIES_INDEX'\r\nexport const LAYOUT = 'LAYOUT'\r\nexport const DICOMDIR = 'DICOMDIR'\r\nexport const FSCURRENTDIR = 'FSCURRENTDIR'\r\nexport const FSCURRENTLIST = 'FSCURRENTLIST'\r\nexport const FSZIPPEDFILE = 'FSZIPPEDFILE'\r\nexport const FSREFRESH = 'FSREFRESH'\r\nexport const VOLUME_STORE = 'VOLUME_STORE'\r\nexport const DCMENABLETOOL_STORE = 'DCMENABLETOOL_STORE'\r\n\r\nexport const clearStore = () => {\r\n    return { \r\n        type: CLEAR_STORE, \r\n    }\r\n}\r\n\r\nexport const localFileStore = (file) => {\r\n    return { \r\n        type: LOCALFILE_STORE, \r\n        localFile: file\r\n    }\r\n}\r\n\r\nexport const fsFileStore = (file) => {\r\n    return { \r\n        type: FSFILE_STORE, \r\n        fsFile: file\r\n    }\r\n}\r\nexport const filesStore = (files) => {\r\n    return { \r\n        type: FILES_STORE, \r\n        files: files\r\n    }\r\n}\r\n\r\nexport const seriesStore = (series) => {\r\n    return { \r\n        type: SERIES_STORE, \r\n        series: series\r\n    }\r\n}\r\n\r\nexport const dcmIsOpen = (value) => {\r\n    return { \r\n        type: DCM_IS_OPEN, \r\n        value: value\r\n    }\r\n}\r\n\r\nexport const dcmTool = (tool) => {\r\n    return { \r\n        type: DCM_TOOL, \r\n        tool: tool \r\n    }\r\n}\r\n\r\nexport const activeDcmIndex = (index) => {\r\n    return { \r\n        type: ACTIVE_DCM_INDEX, \r\n        activeDcmIndex: index \r\n    }\r\n}\r\n\r\nexport const activeDcm = (dcm) => {\r\n    return { \r\n        type: ACTIVE_DCM, \r\n        activeDcm: dcm \r\n    }\r\n}\r\n\r\nexport const activeMeasurements = (measurements) => {\r\n    return { \r\n        type: ACTIVE_MEASUREMENTS, \r\n        measurements: measurements \r\n    }\r\n}\r\n\r\nexport const explorer = (data) => {\r\n    return { \r\n        type: EXPLORER_STORE, \r\n        explorer: data \r\n    }\r\n}\r\n\r\nexport const explorerActivePatientIndex = (index) => {\r\n    return { \r\n        type: EXPLORER_ACTIVE_PATIENT_INDEX, \r\n        explorerActivePatientIndex: index \r\n    }\r\n}\r\n\r\nexport const explorerActiveStudyIndex = (index) => {\r\n    return { \r\n        type: EXPLORER_ACTIVE_STUDY_INDEX, \r\n        explorerActiveStudyIndex: index \r\n    }\r\n}\r\n\r\nexport const explorerActiveSeriesIndex = (index) => {\r\n    return { \r\n        type: EXPLORER_ACTIVE_SERIES_INDEX, \r\n        explorerActiveSeriesIndex: index \r\n    }\r\n}\r\n\r\nexport const setLayout = (row, col) => {\r\n    return { \r\n        type: LAYOUT, \r\n        layout: [row, col]\r\n    }\r\n}\r\n\r\nexport const setDicomdir = (dicomdir) => {\r\n    return { \r\n        type: DICOMDIR, \r\n        dicomdir: dicomdir\r\n    }\r\n}\r\n\r\nexport const setFsCurrentDir = (dir) => {\r\n    return { \r\n        type: FSCURRENTDIR, \r\n        fsCurrentDir: dir\r\n    }\r\n}\r\n\r\nexport const setFsCurrentList = (list) => {\r\n    return { \r\n        type: FSCURRENTLIST, \r\n        fsCurrentList: list\r\n    }\r\n}\r\n\r\nexport const setZippedFile = (file) => {\r\n    return { \r\n        type: FSZIPPEDFILE, \r\n        fsZippedFile: file\r\n    }\r\n}\r\n\r\nexport const doFsRefresh = () => {\r\n    return { \r\n        type: FSREFRESH,\r\n    }\r\n}\r\n\r\nexport const setVolume = (volume) => {\r\n    return { \r\n        type: VOLUME_STORE,\r\n        volume: volume,\r\n    }\r\n}\r\n\r\nexport const setDcmEnableTool = (value) => {\r\n    return { \r\n        type: DCMENABLETOOL_STORE,\r\n        dcmEnableTool: value,\r\n    }\r\n}\r\n","import React, { Fragment, PureComponent } from 'react'\r\nimport {connect} from 'react-redux'\r\nimport { withStyles } from '@material-ui/core/styles'\r\nimport List from '@material-ui/core/List'\r\nimport ListItem from '@material-ui/core/ListItem'\r\nimport ListItemText from '@material-ui/core/ListItemText'\r\nimport Collapse from '@material-ui/core/Collapse'\r\nimport * as dicomParser from 'dicom-parser'\r\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess'\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\r\nimport 'react-perfect-scrollbar/dist/css/styles.css'\r\nimport PerfectScrollbar from 'react-perfect-scrollbar'\r\nimport fs from '../fs/fs'\r\nimport {\r\n  dicomDateToLocale,\r\n  dicomTimeToStr,\r\n  getSettingsDicomdirView,\r\n} from '../functions'\r\nimport {\r\n  fsFileStore,\r\n} from '../actions'\r\n\r\nconst styles = theme => ({\r\n  study: { \r\n    paddingLeft: theme.spacing(3) \r\n  },\r\n  series: { \r\n    paddingLeft: theme.spacing(5) \r\n  },\r\n  images: { \r\n    paddingLeft: theme.spacing(7) \r\n  },  \r\n  listItemText:{\r\n    fontSize:'0.80em',\r\n  }\r\n})\r\n\r\nconst styleScrollbar = {\r\n  height: 'calc(100vh - 48px)',\r\n}\r\n\r\nconst ExpandIcon = ({ expanded }) => expanded ? <ExpandLessIcon /> : <ExpandMoreIcon />\r\n\r\nclass Dicomdir extends PureComponent {\r\n    constructor(props) {\r\n      super(props)\r\n      this.output = null\r\n    }\r\n\r\n    state = {\r\n      data: [],\r\n      expanded: [],\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (this.props.dicomdir.origin === 'local')\r\n          this.openDicomdir(this.props.dicomdir.dicomdir)   \r\n        else \r\n          this.openDicomdirFs(this.props.dicomdir.dicomdir)               \r\n    }\r\n\r\n    buildData = (id = null) => {\r\n      let output = this.output\r\n      if (id !== null) {\r\n        output[id].expanded = !output[id].expanded\r\n      }\r\n      let images = []\r\n      let series = []\r\n      let study = []\r\n      let patient = []\r\n      output.slice().reverse().forEach((obj, i) => {\r\n        if (obj.key === 'image') {\r\n          images.unshift({id: obj.id, key: obj.key, path: obj.path, value: obj.value})\r\n        } else if (obj.key === 'series') {\r\n          series.unshift({id: obj.id, key: obj.key, number: obj.number, value: obj.value, expanded: obj.expanded, children: images})\r\n          images = []\r\n        } else if (obj.key === 'study') {\r\n          study.unshift({id: obj.id, key: obj.key, value: obj.value, expanded: obj.expanded, children: series})\r\n          series = []\r\n        } else if (obj.key === 'patient') {\r\n          patient.unshift({id: obj.id, key: obj.key, value: obj.value, expanded: obj.expanded, children: study})\r\n          study = []\r\n        }\r\n      })\r\n      this.setState({data: patient})\r\n    }\r\n\r\n    buildOutput = (dataset) => {\r\n      let data = dataset.elements.x00041220.items\r\n      let output = []\r\n      if (data) {\r\n          data.forEach((e, index) => {\r\n            const id = index.toString()\r\n            if (e.dataSet.string('x00041430') === 'PATIENT') {\r\n                output.push({id: id, key: 'patient', value: e.dataSet.string('x00100010'), expanded: true})\r\n            } else if (e.dataSet.string('x00041430') === 'STUDY') {\r\n                const value = `${dicomDateToLocale(e.dataSet.string('x00080020'))} - ${dicomTimeToStr(e.dataSet.string('x00080030'))}`\r\n                output.push({id: id, key: 'study', value: value, expanded: true})\r\n            } else if (e.dataSet.string('x00041430') === 'SERIES') {\r\n                output.push({id: id, key: 'series', number: e.dataSet.string('x00200011'), value: e.dataSet.string('x00080060'), expanded: true})\r\n            } else if (e.dataSet.string('x00041430') === 'IMAGE') {\r\n                output.push({id: id, key: 'image', path: e.dataSet.string('x00041500').replace(/\\\\/g, '/'), value: e.dataSet.string('x00041500').split('\\\\').pop(), expanded: true})\r\n            }              \r\n          })\r\n      }\r\n      return output\r\n    }\r\n\r\n    openDicomdir = (file) => {\r\n        var reader = new FileReader()\r\n        reader.onload = (file) => {\r\n          let arrayBuffer = reader.result\r\n          let byteArray = new Uint8Array(arrayBuffer)\r\n          let dataset = null\r\n          let output = []\r\n          try {\r\n              dataset = dicomParser.parseDicom(byteArray)\r\n              output = this.buildOutput(dataset)\r\n          } catch(err) {\r\n              if (typeof err.dataSet != 'undefined') {\r\n                  output = this.buildOutput(err.dataSet)\r\n              }\r\n          }\r\n          this.output = output\r\n          this.buildData()\r\n        }\r\n\r\n        reader.readAsArrayBuffer(file)\r\n    }\r\n\r\n    openDicomdirFs = (fsItem) => {\r\n      let byteArray = new Uint8Array(fsItem.data)\r\n      let dataset = null\r\n      let output = []\r\n      try {\r\n        dataset = dicomParser.parseDicom(byteArray)\r\n        output = this.buildOutput(dataset)\r\n      } catch(err) {\r\n        if (typeof err.dataSet != 'undefined') {\r\n          output = this.buildOutput(err.dataSet)\r\n        }\r\n      }\r\n      this.output = output\r\n      this.buildData()\r\n    }\r\n\r\n    onClick = (id) => {\r\n      const obj = this.output.find(x => x.id === id)\r\n      if (obj.key === 'image') {\r\n        if (this.props.dicomdir.origin === 'local') { // load it from local\r\n          const file = this.props.dicomdir.files.find(x => x.name === obj.value)\r\n          this.props.onOpenFile(file)\r\n        } else { // load it from sandboxed file system\r\n          let components = obj.path.split('/')\r\n          const name = components.pop()\r\n          components.unshift(this.props.fsCurrentDir)\r\n          const parent = components.join('/')\r\n          fs.files.where({parent: parent, name: name}).first((item) => {\r\n            this.props.setFsFileStore(item)\r\n            this.props.onOpenFs(item)\r\n          })\r\n        }\r\n      } else {\r\n        this.buildData(id)\r\n      }\r\n    }\r\n\r\n    studyText = (study) => {\r\n     \r\n      return study.value\r\n    }\r\n\r\n    render() {   \r\n      const { classes } = this.props\r\n\r\n      let styleComponent = null\r\n      if (getSettingsDicomdirView() === 'bottom') {\r\n          styleComponent = {marginTop: '0px', height: '275px'}\r\n      } else {\r\n          styleComponent = {marginTop: '48px', width: '350px'}\r\n      }\r\n\r\n      return (\r\n        <PerfectScrollbar>\r\n        <div style={styleScrollbar}>  \r\n        <div style={styleComponent}>\r\n          \r\n          <List>\r\n            {this.state.data.map(({ ...patient }, index) => (\r\n              <Fragment key={index}>\r\n                <ListItem button onClick={() => this.onClick(patient.id)}>\r\n                  <ListItemText primary={patient.value} secondary={patient.key} classes={{primary:classes.listItemText, secondary:classes.listItemText}} />\r\n                  <ExpandIcon expanded={patient.expanded} />\r\n                </ListItem>\r\n                <Collapse in={patient.expanded}>\r\n                  {patient.children.map(study => (\r\n                    <Fragment key={study.id}>\r\n                      <ListItem key={study.id} button dense onClick={() => this.onClick(study.id)} className={classes.study}>\r\n                        <ListItemText primary={this.studyText(study)} secondary={study.key} classes={{primary:classes.listItemText, secondary:classes.listItemText}} />\r\n                        <ExpandIcon expanded={study.expanded} />\r\n                      </ListItem>\r\n                      <Collapse in={study.expanded}>\r\n                        {study.children.map(series => (\r\n                          <Fragment key={series.id}>\r\n                            <ListItem key={series.id} button dense onClick={() => this.onClick(series.id)} className={classes.series}>\r\n                              <ListItemText primary={`${series.value} (${series.number})`} secondary={series.key} classes={{primary:classes.listItemText, secondary:classes.listItemText}} />\r\n                              <ExpandIcon expanded={study.expanded} />\r\n                            </ListItem>\r\n                            <Collapse in={series.expanded}>\r\n                              {series.children.map(images => (\r\n                                <ListItem key={images.id} button dense onClick={() => this.onClick(images.id)} className={classes.images}>\r\n                                  <ListItemText primary={images.value} secondary={images.key} classes={{primary:classes.listItemText, secondary:classes.listItemText}} />\r\n                                </ListItem>\r\n                              ))}\r\n                            </Collapse>\r\n                          </Fragment>\r\n                        ))}\r\n                      </Collapse>\r\n                    </Fragment>\r\n                  ))}\r\n                </Collapse>\r\n              </Fragment>\r\n            ))}\r\n          </List>\r\n        </div>\r\n        </div>\r\n        </PerfectScrollbar>\r\n      )\r\n    }\r\n}   \r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n      dicomdir: state.dicomdir,\r\n      fsCurrentDir: state.fsCurrentDir,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    setFsFileStore: (file) => dispatch(fsFileStore(file))\r\n  }\r\n}\r\n  \r\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(Dicomdir))\r\n","\r\nexport const uids = {\r\n  '1.2.840.10008.1.1':'Verification SOP Class',\r\n  '1.2.840.10008.1.2':'Implicit VR Little Endian: Default Transfer Syntax for DICOM',\r\n  '1.2.840.10008.1.2.1':'Explicit VR Little Endian',\r\n  '1.2.840.10008.1.2.1.99':'Deflated Explicit VR Little Endian',\r\n  '1.2.840.10008.1.2.2':'Explicit VR Big Endian (Retired)',\r\n  '1.2.840.10008.1.2.4.50':'JPEG Baseline (Process 1): Default Transfer Syntax for Lossy JPEG 8 Bit Image Compression',\r\n  '1.2.840.10008.1.2.4.51':'JPEG Extended (Process 2 & 4): Default Transfer Syntax for Lossy JPEG 12 Bit Image Compression (Process 4 only)',\r\n  '1.2.840.10008.1.2.4.52':'JPEG Extended (Process 3 & 5) (Retired)',\r\n  '1.2.840.10008.1.2.4.53':'JPEG Spectral Selection, Non-Hierarchical (Process 6 & 8) (Retired)',\r\n  '1.2.840.10008.1.2.4.54':'JPEG Spectral Selection, Non-Hierarchical (Process 7 & 9) (Retired)',\r\n  '1.2.840.10008.1.2.4.55':'JPEG Full Progression, Non-Hierarchical (Process 10 & 12) (Retired)',\r\n  '1.2.840.10008.1.2.4.56':'JPEG Full Progression, Non-Hierarchical (Process 11 & 13) (Retired)',\r\n  '1.2.840.10008.1.2.4.57':'JPEG Lossless, Non-Hierarchical (Process 14)',\r\n  '1.2.840.10008.1.2.4.58':'JPEG Lossless, Non-Hierarchical (Process 15) (Retired)',\r\n  '1.2.840.10008.1.2.4.59':'JPEG Extended, Hierarchical (Process 16 & 18) (Retired)',\r\n  '1.2.840.10008.1.2.4.60':'JPEG Extended, Hierarchical (Process 17 & 19) (Retired)',\r\n  '1.2.840.10008.1.2.4.61':'JPEG Spectral Selection, Hierarchical (Process 20 & 22) (Retired)',\r\n  '1.2.840.10008.1.2.4.62':'JPEG Spectral Selection, Hierarchical (Process 21 & 23) (Retired)',\r\n  '1.2.840.10008.1.2.4.63':'JPEG Full Progression, Hierarchical (Process 24 & 26) (Retired)',\r\n  '1.2.840.10008.1.2.4.64':'JPEG Full Progression, Hierarchical (Process 25 & 27) (Retired)',\r\n  '1.2.840.10008.1.2.4.65':'JPEG Lossless, Hierarchical (Process 28) (Retired)',\r\n  '1.2.840.10008.1.2.4.66':'JPEG Lossless, Hierarchical (Process 29) (Retired)',\r\n  '1.2.840.10008.1.2.4.70':'JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1]): Default Transfer Syntax for Lossless JPEG Image Compression',\r\n  '1.2.840.10008.1.2.4.80':'JPEG-LS Lossless Image Compression',\r\n  '1.2.840.10008.1.2.4.81':'JPEG-LS Lossy (Near-Lossless) Image Compression',\r\n  '1.2.840.10008.1.2.4.90':'JPEG 2000 Image Compression (Lossless Only)',\r\n  '1.2.840.10008.1.2.4.91':'JPEG 2000 Image Compression',\r\n  '1.2.840.10008.1.2.4.92':'JPEG 2000 Part 2 Multi-component Image Compression (Lossless Only)',\r\n  '1.2.840.10008.1.2.4.93':'JPEG 2000 Part 2 Multi-component Image Compression',\r\n  '1.2.840.10008.1.2.4.94':'JPIP Referenced',\r\n  '1.2.840.10008.1.2.4.95':'JPIP Referenced Deflate',\r\n  '1.2.840.10008.1.2.4.100':'MPEG2 Main Profile @ Main Level',\r\n  '1.2.840.10008.1.2.4.101':'MPEG2 Main Profile @ High Level',\r\n  '1.2.840.10008.1.2.4.102':'MPEG-4 AVC/H.264 High Profile / Level 4.1',\r\n  '1.2.840.10008.1.2.4.103':'MPEG-4 AVC/H.264 BD-compatible High Profile / Level 4.1',\r\n  '1.2.840.10008.1.2.4.104':'MPEG-4 AVC/H.264 High Profile / Level 4.2 For 2D Video',\r\n  '1.2.840.10008.1.2.4.105':'MPEG-4 AVC/H.264 High Profile / Level 4.2 For 3D Video',\r\n  '1.2.840.10008.1.2.4.106':'MPEG-4 AVC/H.264 Stereo High Profile / Level 4.2',\r\n  '1.2.840.10008.1.2.5':'RLE Lossless',\r\n  '1.2.840.10008.1.2.6.1':'RFC 2557 MIME encapsulation',\r\n  '1.2.840.10008.1.2.6.2':'XML Encoding',\r\n  '1.2.840.10008.1.3.10':'Media Storage Directory Storage',\r\n  '1.2.840.10008.1.4.1.1':'Talairach Brain Atlas Frame of Reference',\r\n  '1.2.840.10008.1.4.1.2':'SPM2 T1 Frame of Reference',\r\n  '1.2.840.10008.1.4.1.3':'SPM2 T2 Frame of Reference',\r\n  '1.2.840.10008.1.4.1.4':'SPM2 PD Frame of Reference',\r\n  '1.2.840.10008.1.4.1.5':'SPM2 EPI Frame of Reference',\r\n  '1.2.840.10008.1.4.1.6':'SPM2 FIL T1 Frame of Reference',\r\n  '1.2.840.10008.1.4.1.7':'SPM2 PET Frame of Reference',\r\n  '1.2.840.10008.1.4.1.8':'SPM2 TRANSM Frame of Reference',\r\n  '1.2.840.10008.1.4.1.9':'SPM2 SPECT Frame of Reference',\r\n  '1.2.840.10008.1.4.1.10':'SPM2 GRAY Frame of Reference',\r\n  '1.2.840.10008.1.4.1.11':'SPM2 WHITE Frame of Reference',\r\n  '1.2.840.10008.1.4.1.12':'SPM2 CSF Frame of Reference',\r\n  '1.2.840.10008.1.4.1.13':'SPM2 BRAINMASK Frame of Reference',\r\n  '1.2.840.10008.1.4.1.14':'SPM2 AVG305T1 Frame of Reference',\r\n  '1.2.840.10008.1.4.1.15':'SPM2 AVG152T1 Frame of Reference',\r\n  '1.2.840.10008.1.4.1.16':'SPM2 AVG152T2 Frame of Reference',\r\n  '1.2.840.10008.1.4.1.17':'SPM2 AVG152PD Frame of Reference',\r\n  '1.2.840.10008.1.4.1.18':'SPM2 SINGLESUBJT1 Frame of Reference',\r\n  '1.2.840.10008.1.4.2.1':'ICBM 452 T1 Frame of Reference',\r\n  '1.2.840.10008.1.4.2.2':'ICBM Single Subject MRI Frame of Reference',\r\n  '1.2.840.10008.1.5.1':'Hot Iron Color Palette SOP Instance',\r\n  '1.2.840.10008.1.5.2':'PET Color Palette SOP Instance',\r\n  '1.2.840.10008.1.5.3':'Hot Metal Blue Color Palette SOP Instance',\r\n  '1.2.840.10008.1.5.4':'PET 20 Step Color Palette SOP Instance',\r\n  '1.2.840.10008.1.9':'Basic Study Content Notification SOP Class (Retired)',\r\n  '1.2.840.10008.1.20.1':'Storage Commitment Push Model SOP Class',\r\n  '1.2.840.10008.1.20.1.1':'Storage Commitment Push Model SOP Instance',\r\n  '1.2.840.10008.1.20.2':'Storage Commitment Pull Model SOP Class (Retired)',\r\n  '1.2.840.10008.1.20.2.1':'Storage Commitment Pull Model SOP Instance (Retired)',\r\n  '1.2.840.10008.1.40':'Procedural Event Logging SOP Class',\r\n  '1.2.840.10008.1.40.1':'Procedural Event Logging SOP Instance',\r\n  '1.2.840.10008.1.42':'Substance Administration Logging SOP Class',\r\n  '1.2.840.10008.1.42.1':'Substance Administration Logging SOP Instance',\r\n  '1.2.840.10008.2.6.1':'DICOM UID Registry',\r\n  '1.2.840.10008.2.16.4':'DICOM Controlled Terminology',\r\n  '1.2.840.10008.3.1.1.1':'DICOM Application Context Name',\r\n  '1.2.840.10008.3.1.2.1.1':'Detached Patient Management SOP Class (Retired)',\r\n  '1.2.840.10008.3.1.2.1.4':'Detached Patient Management Meta SOP Class (Retired)',\r\n  '1.2.840.10008.3.1.2.2.1':'Detached Visit Management SOP Class (Retired)',\r\n  '1.2.840.10008.3.1.2.3.1':'Detached Study Management SOP Class (Retired)',\r\n  '1.2.840.10008.3.1.2.3.2':'Study Component Management SOP Class (Retired)',\r\n  '1.2.840.10008.3.1.2.3.3':'Modality Performed Procedure Step SOP Class',\r\n  '1.2.840.10008.3.1.2.3.4':'Modality Performed Procedure Step Retrieve SOP Class',\r\n  '1.2.840.10008.3.1.2.3.5':'Modality Performed Procedure Step Notification SOP Class',\r\n  '1.2.840.10008.3.1.2.5.1':'Detached Results Management SOP Class (Retired)',\r\n  '1.2.840.10008.3.1.2.5.4':'Detached Results Management Meta SOP Class (Retired)',\r\n  '1.2.840.10008.3.1.2.5.5':'Detached Study Management Meta SOP Class (Retired)',\r\n  '1.2.840.10008.3.1.2.6.1':'Detached Interpretation Management SOP Class (Retired)',\r\n  '1.2.840.10008.4.2':'Storage Service Class',\r\n  '1.2.840.10008.5.1.1.1':'Basic Film Session SOP Class',\r\n  '1.2.840.10008.5.1.1.2':'Basic Film Box SOP Class',\r\n  '1.2.840.10008.5.1.1.4':'Basic Grayscale Image Box SOP Class',\r\n  '1.2.840.10008.5.1.1.4.1':'Basic Color Image Box SOP Class',\r\n  '1.2.840.10008.5.1.1.4.2':'Referenced Image Box SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.1.9':'Basic Grayscale Print Management Meta SOP Class',\r\n  '1.2.840.10008.5.1.1.9.1':'Referenced Grayscale Print Management Meta SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.1.14':'Print Job SOP Class',\r\n  '1.2.840.10008.5.1.1.15':'Basic Annotation Box SOP Class',\r\n  '1.2.840.10008.5.1.1.16':'Printer SOP Class',\r\n  '1.2.840.10008.5.1.1.16.376':'Printer Configuration Retrieval SOP Class',\r\n  '1.2.840.10008.5.1.1.17':'Printer SOP Instance',\r\n  '1.2.840.10008.5.1.1.17.376':'Printer Configuration Retrieval SOP Instance',\r\n  '1.2.840.10008.5.1.1.18':'Basic Color Print Management Meta SOP Class',\r\n  '1.2.840.10008.5.1.1.18.1':'Referenced Color Print Management Meta SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.1.22':'VOI LUT Box SOP Class',\r\n  '1.2.840.10008.5.1.1.23':'Presentation LUT SOP Class',\r\n  '1.2.840.10008.5.1.1.24':'Image Overlay Box SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.1.24.1':'Basic Print Image Overlay Box SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.1.25':'Print Queue SOP Instance (Retired)',\r\n  '1.2.840.10008.5.1.1.26':'Print Queue Management SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.1.27':'Stored Print Storage SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.1.29':'Hardcopy Grayscale Image Storage SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.1.30':'Hardcopy Color Image Storage SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.1.31':'Pull Print Request SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.1.32':'Pull Stored Print Management Meta SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.1.33':'Media Creation Management SOP Class UID',\r\n  '1.2.840.10008.5.1.1.40':'Display System SOP Class',\r\n  '1.2.840.10008.5.1.1.40.1':'Display System SOP Instance',\r\n  '1.2.840.10008.5.1.4.1.1.1':'Computed Radiography Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.1.1':'Digital X-Ray Image Storage - For Presentation',\r\n  '1.2.840.10008.5.1.4.1.1.1.1.1':'Digital X-Ray Image Storage - For Processing',\r\n  '1.2.840.10008.5.1.4.1.1.1.2':'Digital Mammography X-Ray Image Storage - For Presentation',\r\n  '1.2.840.10008.5.1.4.1.1.1.2.1':'Digital Mammography X-Ray Image Storage - For Processing',\r\n  '1.2.840.10008.5.1.4.1.1.1.3':'Digital Intra-Oral X-Ray Image Storage - For Presentation',\r\n  '1.2.840.10008.5.1.4.1.1.1.3.1':'Digital Intra-Oral X-Ray Image Storage - For Processing',\r\n  '1.2.840.10008.5.1.4.1.1.2':'CT Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.2.1':'Enhanced CT Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.2.2':'Legacy Converted Enhanced CT Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.3':'Ultrasound Multi-frame Image Storage (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.3.1':'Ultrasound Multi-frame Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.4':'MR Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.4.1':'Enhanced MR Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.4.2':'MR Spectroscopy Storage',\r\n  '1.2.840.10008.5.1.4.1.1.4.3':'Enhanced MR Color Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.4.4':'Legacy Converted Enhanced MR Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.5':'Nuclear Medicine Image Storage (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.6':'Ultrasound Image Storage (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.6.1':'Ultrasound Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.6.2':'Enhanced US Volume Storage',\r\n  '1.2.840.10008.5.1.4.1.1.7':'Secondary Capture Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.7.1':'Multi-frame Single Bit Secondary Capture Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.7.2':'Multi-frame Grayscale Byte Secondary Capture Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.7.3':'Multi-frame Grayscale Word Secondary Capture Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.7.4':'Multi-frame True Color Secondary Capture Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.8':'Standalone Overlay Storage (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.9':'Standalone Curve Storage (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.9.1':'Waveform Storage - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.9.1.1':'12-lead ECG Waveform Storage',\r\n  '1.2.840.10008.5.1.4.1.1.9.1.2':'General ECG Waveform Storage',\r\n  '1.2.840.10008.5.1.4.1.1.9.1.3':'Ambulatory ECG Waveform Storage',\r\n  '1.2.840.10008.5.1.4.1.1.9.2.1':'Hemodynamic Waveform Storage',\r\n  '1.2.840.10008.5.1.4.1.1.9.3.1':'Cardiac Electrophysiology Waveform Storage',\r\n  '1.2.840.10008.5.1.4.1.1.9.4.1':'Basic Voice Audio Waveform Storage',\r\n  '1.2.840.10008.5.1.4.1.1.9.4.2':'General Audio Waveform Storage',\r\n  '1.2.840.10008.5.1.4.1.1.9.5.1':'Arterial Pulse Waveform Storage',\r\n  '1.2.840.10008.5.1.4.1.1.9.6.1':'Respiratory Waveform Storage',\r\n  '1.2.840.10008.5.1.4.1.1.10':'Standalone Modality LUT Storage (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.11':'Standalone VOI LUT Storage (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.11.1':'Grayscale Softcopy Presentation State Storage SOP Class',\r\n  '1.2.840.10008.5.1.4.1.1.11.2':'Color Softcopy Presentation State Storage SOP Class',\r\n  '1.2.840.10008.5.1.4.1.1.11.3':'Pseudo-Color Softcopy Presentation State Storage SOP Class',\r\n  '1.2.840.10008.5.1.4.1.1.11.4':'Blending Softcopy Presentation State Storage SOP Class',\r\n  '1.2.840.10008.5.1.4.1.1.11.5':'XA/XRF Grayscale Softcopy Presentation State Storage',\r\n  '1.2.840.10008.5.1.4.1.1.12.1':'X-Ray Angiographic Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.12.1.1':'Enhanced XA Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.12.2':'X-Ray Radiofluoroscopic Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.12.2.1':'Enhanced XRF Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.12.3':'X-Ray Angiographic Bi-Plane Image Storage (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.13.1.1':'X-Ray 3D Angiographic Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.13.1.2':'X-Ray 3D Craniofacial Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.13.1.3':'Breast Tomosynthesis Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.13.1.4':'Breast Projection X-Ray Image Storage - For Presentation',\r\n  '1.2.840.10008.5.1.4.1.1.13.1.5':'Breast Projection X-Ray Image Storage - For Processing',\r\n  '1.2.840.10008.5.1.4.1.1.14.1':'Intravascular Optical Coherence Tomography Image Storage - For Presentation',\r\n  '1.2.840.10008.5.1.4.1.1.14.2':'Intravascular Optical Coherence Tomography Image Storage - For Processing',\r\n  '1.2.840.10008.5.1.4.1.1.20':'Nuclear Medicine Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.30':'Parametric Map Storage',\r\n  '1.2.840.10008.5.1.4.1.1.66':'Raw Data Storage',\r\n  '1.2.840.10008.5.1.4.1.1.66.1':'Spatial Registration Storage',\r\n  '1.2.840.10008.5.1.4.1.1.66.2':'Spatial Fiducials Storage',\r\n  '1.2.840.10008.5.1.4.1.1.66.3':'Deformable Spatial Registration Storage',\r\n  '1.2.840.10008.5.1.4.1.1.66.4':'Segmentation Storage',\r\n  '1.2.840.10008.5.1.4.1.1.66.5':'Surface Segmentation Storage',\r\n  '1.2.840.10008.5.1.4.1.1.67':'Real World Value Mapping Storage',\r\n  '1.2.840.10008.5.1.4.1.1.68.1':'Surface Scan Mesh Storage',\r\n  '1.2.840.10008.5.1.4.1.1.68.2':'Surface Scan Point Cloud Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1':'VL Image Storage - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.77.2':'VL Multi-frame Image Storage - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.1':'VL Endoscopic Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.1.1':'Video Endoscopic Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.2':'VL Microscopic Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.2.1':'Video Microscopic Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.3':'VL Slide-Coordinates Microscopic Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.4':'VL Photographic Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.4.1':'Video Photographic Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.1':'Ophthalmic Photography 8 Bit Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.2':'Ophthalmic Photography 16 Bit Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.3':'Stereometric Relationship Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.4':'Ophthalmic Tomography Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.5':'Wide Field Ophthalmic Photography Stereographic Projection Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.5.6':'Wide Field Ophthalmic Photography 3D Coordinates Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.77.1.6':'VL Whole Slide Microscopy Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.78.1':'Lensometry Measurements Storage',\r\n  '1.2.840.10008.5.1.4.1.1.78.2':'Autorefraction Measurements Storage',\r\n  '1.2.840.10008.5.1.4.1.1.78.3':'Keratometry Measurements Storage',\r\n  '1.2.840.10008.5.1.4.1.1.78.4':'Subjective Refraction Measurements Storage',\r\n  '1.2.840.10008.5.1.4.1.1.78.5':'Visual Acuity Measurements Storage',\r\n  '1.2.840.10008.5.1.4.1.1.78.6':'Spectacle Prescription Report Storage',\r\n  '1.2.840.10008.5.1.4.1.1.78.7':'Ophthalmic Axial Measurements Storage',\r\n  '1.2.840.10008.5.1.4.1.1.78.8':'Intraocular Lens Calculations Storage',\r\n  '1.2.840.10008.5.1.4.1.1.79.1':'Macular Grid Thickness and Volume Report Storage',\r\n  '1.2.840.10008.5.1.4.1.1.80.1':'Ophthalmic Visual Field Static Perimetry Measurements Storage',\r\n  '1.2.840.10008.5.1.4.1.1.81.1':'Ophthalmic Thickness Map Storage',\r\n  '1.2.840.10008.5.1.4.1.1.82.1':'Corneal Topography Map Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.1':'Text SR Storage - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.88.2':'Audio SR Storage - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.88.3':'Detail SR Storage - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.88.4':'Comprehensive SR Storage - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.88.11':'Basic Text SR Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.22':'Enhanced SR Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.33':'Comprehensive SR Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.34':'Comprehensive 3D SR Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.35':'Extensible SR Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.40':'Procedure Log Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.50':'Mammography CAD SR Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.59':'Key Object Selection Document Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.65':'Chest CAD SR Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.67':'X-Ray Radiation Dose SR Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.68':'Radiopharmaceutical Radiation Dose SR Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.69':'Colon CAD SR Storage',\r\n  '1.2.840.10008.5.1.4.1.1.88.70':'Implantation Plan SR Storage',\r\n  '1.2.840.10008.5.1.4.1.1.104.1':'Encapsulated PDF Storage',\r\n  '1.2.840.10008.5.1.4.1.1.104.2':'Encapsulated CDA Storage',\r\n  '1.2.840.10008.5.1.4.1.1.128':'Positron Emission Tomography Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.128.1':'Legacy Converted Enhanced PET Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.129':'Standalone PET Curve Storage (Retired)',\r\n  '1.2.840.10008.5.1.4.1.1.130':'Enhanced PET Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.131':'Basic Structured Display Storage',\r\n  '1.2.840.10008.5.1.4.1.1.481.1':'RT Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.481.2':'RT Dose Storage',\r\n  '1.2.840.10008.5.1.4.1.1.481.3':'RT Structure Set Storage',\r\n  '1.2.840.10008.5.1.4.1.1.481.4':'RT Beams Treatment Record Storage',\r\n  '1.2.840.10008.5.1.4.1.1.481.5':'RT Plan Storage',\r\n  '1.2.840.10008.5.1.4.1.1.481.6':'RT Brachy Treatment Record Storage',\r\n  '1.2.840.10008.5.1.4.1.1.481.7':'RT Treatment Summary Record Storage',\r\n  '1.2.840.10008.5.1.4.1.1.481.8':'RT Ion Plan Storage',\r\n  '1.2.840.10008.5.1.4.1.1.481.9':'RT Ion Beams Treatment Record Storage',\r\n  '1.2.840.10008.5.1.4.1.1.501.1':'DICOS CT Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.501.2.1':'DICOS Digital X-Ray Image Storage - For Presentation',\r\n  '1.2.840.10008.5.1.4.1.1.501.2.2':'DICOS Digital X-Ray Image Storage - For Processing',\r\n  '1.2.840.10008.5.1.4.1.1.501.3':'DICOS Threat Detection Report Storage',\r\n  '1.2.840.10008.5.1.4.1.1.501.4':'DICOS 2D AIT Storage',\r\n  '1.2.840.10008.5.1.4.1.1.501.5':'DICOS 3D AIT Storage',\r\n  '1.2.840.10008.5.1.4.1.1.501.6':'DICOS Quadrupole Resonance (QR) Storage',\r\n  '1.2.840.10008.5.1.4.1.1.601.1':'Eddy Current Image Storage',\r\n  '1.2.840.10008.5.1.4.1.1.601.2':'Eddy Current Multi-frame Image Storage',\r\n  '1.2.840.10008.5.1.4.1.2.1.1':'Patient Root Query/Retrieve Information Model - FIND',\r\n  '1.2.840.10008.5.1.4.1.2.1.2':'Patient Root Query/Retrieve Information Model - MOVE',\r\n  '1.2.840.10008.5.1.4.1.2.1.3':'Patient Root Query/Retrieve Information Model - GET',\r\n  '1.2.840.10008.5.1.4.1.2.2.1':'Study Root Query/Retrieve Information Model - FIND',\r\n  '1.2.840.10008.5.1.4.1.2.2.2':'Study Root Query/Retrieve Information Model - MOVE',\r\n  '1.2.840.10008.5.1.4.1.2.2.3':'Study Root Query/Retrieve Information Model - GET',\r\n  '1.2.840.10008.5.1.4.1.2.3.1':'Patient/Study Only Query/Retrieve Information Model - FIND (Retired)',\r\n  '1.2.840.10008.5.1.4.1.2.3.2':'Patient/Study Only Query/Retrieve Information Model - MOVE (Retired)',\r\n  '1.2.840.10008.5.1.4.1.2.3.3':'Patient/Study Only Query/Retrieve Information Model - GET (Retired)',\r\n  '1.2.840.10008.5.1.4.1.2.4.2':'Composite Instance Root Retrieve - MOVE',\r\n  '1.2.840.10008.5.1.4.1.2.4.3':'Composite Instance Root Retrieve - GET',\r\n  '1.2.840.10008.5.1.4.1.2.5.3':'Composite Instance Retrieve Without Bulk Data - GET',\r\n  '1.2.840.10008.5.1.4.31':'Modality Worklist Information Model - FIND',\r\n  '1.2.840.10008.5.1.4.32':'General Purpose Worklist Management Meta SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.4.32.1':'General Purpose Worklist Information Model - FIND (Retired)',\r\n  '1.2.840.10008.5.1.4.32.2':'General Purpose Scheduled Procedure Step SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.4.32.3':'General Purpose Performed Procedure Step SOP Class (Retired)',\r\n  '1.2.840.10008.5.1.4.33':'Instance Availability Notification SOP Class',\r\n  '1.2.840.10008.5.1.4.34.1':'RT Beams Delivery Instruction Storage - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.34.2':'RT Conventional Machine Verification - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.34.3':'RT Ion Machine Verification - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.34.4':'Unified Worklist and Procedure Step Service Class - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.34.4.1':'Unified Procedure Step - Push SOP Class - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.34.4.2':'Unified Procedure Step - Watch SOP Class - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.34.4.3':'Unified Procedure Step - Pull SOP Class - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.34.4.4':'Unified Procedure Step - Event SOP Class - Trial (Retired)',\r\n  '1.2.840.10008.5.1.4.34.5':'UPS Global Subscription SOP Instance',\r\n  '1.2.840.10008.5.1.4.34.5.1':'UPS Filtered Global Subscription SOP Instance',\r\n  '1.2.840.10008.5.1.4.34.6':'Unified Worklist and Procedure Step Service Class',\r\n  '1.2.840.10008.5.1.4.34.6.1':'Unified Procedure Step - Push SOP Class',\r\n  '1.2.840.10008.5.1.4.34.6.2':'Unified Procedure Step - Watch SOP Class',\r\n  '1.2.840.10008.5.1.4.34.6.3':'Unified Procedure Step - Pull SOP Class',\r\n  '1.2.840.10008.5.1.4.34.6.4':'Unified Procedure Step - Event SOP Class',\r\n  '1.2.840.10008.5.1.4.34.7':'RT Beams Delivery Instruction Storage',\r\n  '1.2.840.10008.5.1.4.34.8':'RT Conventional Machine Verification',\r\n  '1.2.840.10008.5.1.4.34.9':'RT Ion Machine Verification',\r\n  '1.2.840.10008.5.1.4.37.1':'General Relevant Patient Information Query',\r\n  '1.2.840.10008.5.1.4.37.2':'Breast Imaging Relevant Patient Information Query',\r\n  '1.2.840.10008.5.1.4.37.3':'Cardiac Relevant Patient Information Query',\r\n  '1.2.840.10008.5.1.4.38.1':'Hanging Protocol Storage',\r\n  '1.2.840.10008.5.1.4.38.2':'Hanging Protocol Information Model - FIND',\r\n  '1.2.840.10008.5.1.4.38.3':'Hanging Protocol Information Model - MOVE',\r\n  '1.2.840.10008.5.1.4.38.4':'Hanging Protocol Information Model - GET',\r\n  '1.2.840.10008.5.1.4.39.1':'Color Palette Storage',\r\n  '1.2.840.10008.5.1.4.39.2':'Color Palette Information Model - FIND',\r\n  '1.2.840.10008.5.1.4.39.3':'Color Palette Information Model - MOVE',\r\n  '1.2.840.10008.5.1.4.39.4':'Color Palette Information Model - GET',\r\n  '1.2.840.10008.5.1.4.41':'Product Characteristics Query SOP Class',\r\n  '1.2.840.10008.5.1.4.42':'Substance Approval Query SOP Class',\r\n  '1.2.840.10008.5.1.4.43.1':'Generic Implant Template Storage',\r\n  '1.2.840.10008.5.1.4.43.2':'Generic Implant Template Information Model - FIND',\r\n  '1.2.840.10008.5.1.4.43.3':'Generic Implant Template Information Model - MOVE',\r\n  '1.2.840.10008.5.1.4.43.4':'Generic Implant Template Information Model - GET',\r\n  '1.2.840.10008.5.1.4.44.1':'Implant Assembly Template Storage',\r\n  '1.2.840.10008.5.1.4.44.2':'Implant Assembly Template Information Model - FIND',\r\n  '1.2.840.10008.5.1.4.44.3':'Implant Assembly Template Information Model - MOVE',\r\n  '1.2.840.10008.5.1.4.44.4':'Implant Assembly Template Information Model - GET',\r\n  '1.2.840.10008.5.1.4.45.1':'Implant Template Group Storage',\r\n  '1.2.840.10008.5.1.4.45.2':'Implant Template Group Information Model - FIND',\r\n  '1.2.840.10008.5.1.4.45.3':'Implant Template Group Information Model - MOVE',\r\n  '1.2.840.10008.5.1.4.45.4':'Implant Template Group Information Model - GET',\r\n  '1.2.840.10008.7.1.1':'Native DICOM Model',\r\n  '1.2.840.10008.7.1.2':'Abstract Multi-Dimensional Image Model',\r\n  '1.2.840.10008.8.1.1':'DICOM Content Mapping Resource',\r\n  '1.2.840.10008.15.0.3.1':'dicomDeviceName',\r\n  '1.2.840.10008.15.0.3.2':'dicomDescription',\r\n  '1.2.840.10008.15.0.3.3':'dicomManufacturer',\r\n  '1.2.840.10008.15.0.3.4':'dicomManufacturerModelName',\r\n  '1.2.840.10008.15.0.3.5':'dicomSoftwareVersion',\r\n  '1.2.840.10008.15.0.3.6':'dicomVendorData',\r\n  '1.2.840.10008.15.0.3.7':'dicomAETitle',\r\n  '1.2.840.10008.15.0.3.8':'dicomNetworkConnectionReference',\r\n  '1.2.840.10008.15.0.3.9':'dicomApplicationCluster',\r\n  '1.2.840.10008.15.0.3.10':'dicomAssociationInitiator',\r\n  '1.2.840.10008.15.0.3.11':'dicomAssociationAcceptor',\r\n  '1.2.840.10008.15.0.3.12':'dicomHostname',\r\n  '1.2.840.10008.15.0.3.13':'dicomPort',\r\n  '1.2.840.10008.15.0.3.14':'dicomSOPClass',\r\n  '1.2.840.10008.15.0.3.15':'dicomTransferRole',\r\n  '1.2.840.10008.15.0.3.16':'dicomTransferSyntax',\r\n  '1.2.840.10008.15.0.3.17':'dicomPrimaryDeviceType',\r\n  '1.2.840.10008.15.0.3.18':'dicomRelatedDeviceReference',\r\n  '1.2.840.10008.15.0.3.19':'dicomPreferredCalledAETitle',\r\n  '1.2.840.10008.15.0.3.20':'dicomTLSCyphersuite',\r\n  '1.2.840.10008.15.0.3.21':'dicomAuthorizedNodeCertificateReference',\r\n  '1.2.840.10008.15.0.3.22':'dicomThisNodeCertificateReference',\r\n  '1.2.840.10008.15.0.3.23':'dicomInstalled',\r\n  '1.2.840.10008.15.0.3.24':'dicomStationName',\r\n  '1.2.840.10008.15.0.3.25':'dicomDeviceSerialNumber',\r\n  '1.2.840.10008.15.0.3.26':'dicomInstitutionName',\r\n  '1.2.840.10008.15.0.3.27':'dicomInstitutionAddress',\r\n  '1.2.840.10008.15.0.3.28':'dicomInstitutionDepartmentName',\r\n  '1.2.840.10008.15.0.3.29':'dicomIssuerOfPatientID',\r\n  '1.2.840.10008.15.0.3.30':'dicomPreferredCallingAETitle',\r\n  '1.2.840.10008.15.0.3.31':'dicomSupportedCharacterSet',\r\n  '1.2.840.10008.15.0.4.1':'dicomConfigurationRoot',\r\n  '1.2.840.10008.15.0.4.2':'dicomDevicesRoot',\r\n  '1.2.840.10008.15.0.4.3':'dicomUniqueAETitlesRegistryRoot',\r\n  '1.2.840.10008.15.0.4.4':'dicomDevice',\r\n  '1.2.840.10008.15.0.4.5':'dicomNetworkAE',\r\n  '1.2.840.10008.15.0.4.6':'dicomNetworkConnection',\r\n  '1.2.840.10008.15.0.4.7':'dicomUniqueAETitle',\r\n  '1.2.840.10008.15.0.4.8':'dicomTransferCapability',\r\n  '1.2.840.10008.15.1.1':'Universal Coordinated Time',\r\n};\r\n","import React, { PureComponent } from 'react'\r\nimport Button from '@material-ui/core/Button'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport DialogContent from '@material-ui/core/DialogContent'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport LinearProgress from '@material-ui/core/LinearProgress'\r\n\r\nclass OpenUrlDlg extends PureComponent {\r\n\r\n  hide = () => {\r\n    this.props.onClose()\r\n  }\r\n\r\n  cancel = () => {\r\n    window.stop()\r\n    this.hide()\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <Dialog\r\n            open={true}\r\n            onClose={this.hide}\r\n            aria-labelledby=\"alert-dialog-title\"\r\n        >\r\n            <DialogTitle id=\"alert-dialog-title\">{\"Downloading file ...\"}</DialogTitle>\r\n            <DialogContent>\r\n              <LinearProgress variant=\"determinate\" value={this.props.progress} color='secondary' />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={this.cancel}>\r\n                    Cancel\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default OpenUrlDlg\r\n","import React, { PureComponent } from 'react'\r\nimport Icon from '@mdi/react'\r\nimport IconButton from '@material-ui/core/IconButton'\r\n\r\nimport { \r\n    mdiPlay,\r\n    mdiPause,\r\n    mdiSkipBackward,\r\n    mdiSkipForward,\r\n    mdiSkipNext,\r\n    mdiSkipPrevious,\r\n  } from '@mdi/js'\r\n\r\nconst iconColor = '#FFFFFF'\r\n\r\nclass CinePlayer extends PureComponent {\r\n    firstframe = () => {\r\n        this.props.runCinePlayer('firstframe') \r\n    }\r\n\r\n    previousframe = () => {\r\n        this.props.runCinePlayer('previousframe') \r\n    }\r\n\r\n    play = () => {\r\n        this.props.runCinePlayer('play') \r\n    }\r\n\r\n    pause = () => {\r\n        this.props.runCinePlayer('pause') \r\n    }\r\n\r\n    nextframe = () => {\r\n        this.props.runCinePlayer('nextframe') \r\n    }\r\n\r\n    lastframe = () => {\r\n        this.props.runCinePlayer('lastframe') \r\n    }\r\n\r\n    render() {\r\n        let play = null\r\n        if (!this.props.inPlay) {\r\n            play = <IconButton onClick={this.play}>\r\n                        <Icon path={mdiPlay} size={'1.5rem'} color={iconColor} />\r\n                   </IconButton>          \r\n        } else {\r\n            play = <IconButton onClick={this.pause}>\r\n                        <Icon path={mdiPause} size={'1.5rem'} color={iconColor} />\r\n                   </IconButton>  \r\n        }\r\n        return (\r\n            <div style={{ width:240, margin:'0 auto' }}>\r\n                <IconButton onClick={this.firstframe}>\r\n                    <Icon path={mdiSkipBackward} size={'1.5rem'} color={iconColor} />\r\n                </IconButton>\r\n                <IconButton onClick={this.previousframe}>\r\n                    <Icon path={mdiSkipPrevious} size={'1.5rem'} color={iconColor} />\r\n                </IconButton>\r\n                {play}\r\n                <IconButton onClick={this.nextframe}>\r\n                    <Icon path={mdiSkipNext} size={'1.5rem'} color={iconColor} />\r\n                </IconButton>\r\n                <IconButton onClick={this.lastframe}>\r\n                    <Icon path={mdiSkipForward} size={'1.5rem'} color={iconColor} />\r\n                </IconButton>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default CinePlayer\r\n","import Dexie from 'dexie'\r\n\r\nconst db = new Dexie('udvDB')\r\n\r\ndb.version(1).stores({ \r\n    measurement: '++id, sopinstanceuid, tool' \r\n})\r\n\r\ndb.open()\r\n\r\nexport default db\r\n","import { sum, withoutElementAtIndex } from './utils'\r\n\r\nexport default class Matrix {\r\n\r\n    constructor(...rows) {\r\n        this.rows = rows\r\n    }\r\n\r\n    get(i, j) {\r\n        return this.rows[i][j]\r\n    }\r\n\r\n    columns() {\r\n        return this.rows[0].map((_, i) => this.rows.map(r => r[i]))\r\n    }\r\n\r\n    componentWiseOperation(func, { rows }) {\r\n        const newRows = rows.map((row, i) =>\r\n            row.map((element, j) => func(this.rows[i][j], element))\r\n        )\r\n        return new Matrix(...newRows)\r\n    }\r\n\r\n    add(other) {\r\n        return this.componentWiseOperation((a, b) => a + b, other)\r\n    }\r\n\r\n    subtract(other) {\r\n        return this.componentWiseOperation((a, b) => a - b, other)\r\n    }\r\n    \r\n    scaleBy(number) {\r\n        const newRows = this.rows.map(row => \r\n            row.map(element => element * number)\r\n        )\r\n        return new Matrix(...newRows)\r\n    }\r\n\r\n    multiply(other) {\r\n        if (this.rows[0].length !== other.rows.length) {\r\n            throw new Error('The number of columns of this matrix is not equal to the number of rows of the given matrix.')\r\n        }\r\n        const columns = other.columns()\r\n        const newRows = this.rows.map(row => \r\n            columns.map(column => sum(row.map((element, i) => element * column[i])))\r\n        )\r\n        return new Matrix(...newRows)\r\n    }\r\n\r\n    transpose() {\r\n        return new Matrix(...this.columns())\r\n    }\r\n\r\n    determinant() {\r\n        if (this.rows.length !== this.rows[0].length) {\r\n            throw new Error('Only matrices with the same number of rows and columns are supported.')\r\n        }\r\n        if (this.rows.length === 2) {\r\n            return this.rows[0][0] * this.rows[1][1] - this.rows[0][1] * this.rows[1][0]\r\n        }\r\n\r\n        const parts = this.rows[0].map((coef, index) => {\r\n            const matrixRows = this.rows.slice(1).map(row => [ ...row.slice(0, index), ...row.slice(index + 1)])\r\n            const matrix = new Matrix(...matrixRows)\r\n            const result = coef * matrix.determinant()\r\n            return index % 2 === 0 ? result : -result\r\n        })\r\n\r\n        return sum(parts)\r\n    }\r\n\r\n    toDimension(dimension) {\r\n        const zeros = new Array(dimension).fill(0)\r\n        const newRows = zeros.map((_, i) => zeros.map((__, j) => {\r\n            if (this.rows[i] && this.rows[i][j] !== undefined) {\r\n            return this.rows[i][j]\r\n            }\r\n            return i === j ? 1 : 0\r\n        }))\r\n        return new Matrix(...newRows)\r\n    }\r\n\r\n    components() {\r\n        return this.rows.reduce((acc, row) => [ ...acc, ...row], [])\r\n    }\r\n\r\n    map(func) {\r\n        return new Matrix(\r\n            ...this.rows.map((row, i) => row.map((element, j) => func(element, i, j)))\r\n        )\r\n    }\r\n\r\n    minor(i, j) {\r\n        const newRows = withoutElementAtIndex(this.rows, i)\r\n            .map(row => withoutElementAtIndex(row, j))\r\n\r\n        const matrix = new Matrix(...newRows)\r\n        return matrix.determinant()\r\n    }\r\n\r\n    cofactor(i, j) {\r\n        const sign = Math.pow(-1, i + j)\r\n        const minor = this.minor(i, j)\r\n        return sign * minor\r\n    }\r\n\r\n    adjugate() {\r\n        return this\r\n            .map((_, i, j) => this.cofactor(i, j))\r\n            .transpose()\r\n    }\r\n\r\n    inverse() {\r\n        const determinant = this.determinant()\r\n        if (determinant === 0) {\r\n            throw new Error(\"Determinant can't be  zero.\")\r\n        }\r\n        const adjugate = this.adjugate()\r\n        return adjugate.scaleBy(1 / determinant)\r\n    }\r\n\r\n}","import Vector from '../LinearAlgebra/Vector'\r\nimport Matrix from '../LinearAlgebra/Matrix'\r\n\r\nexport default class Point {\r\n    \r\n    constructor(...components) {\r\n      this.components = components\r\n    }\r\n    \r\n    static get zero() {\r\n        return new Point(0, 0, 0)\r\n    }\r\n    \r\n    get x() {\r\n        return this.components[0]\r\n    }\r\n    \r\n    set x(n) {\r\n        this.components[0] = n\r\n    }\r\n\r\n    get y() {\r\n        return this.components[1]\r\n    } \r\n\r\n    set y(n) {\r\n        this.components[1] = n\r\n    }   \r\n\r\n    get z() {\r\n        return this.components[2]\r\n    } \r\n\r\n    set z(n) {\r\n        this.components[2] = n\r\n    } \r\n\r\n    length() {\r\n        return Math.hypot(...this.components)\r\n    }\r\n\r\n    abs() {\r\n        return new Point(\r\n            ...this.components.map(component => Math.abs(component))\r\n        )\r\n    }\r\n\r\n    toVector() {\r\n        return new Vector(...this.components)\r\n    }\r\n\r\n    toMatrix() {\r\n        return new Matrix(...this.components.map(component => [component]))\r\n    } \r\n\r\n    distance(b) {\r\n        return Math.sqrt(this.components.reduce((acc, component, i) => acc + Math.pow(this.components[i]-b.components[i], 2), 0))\r\n    }\r\n\r\n    // return a Point = Point + Vector\r\n    add({ components }) {\r\n        return new Point(\r\n            ...components.map((component, index) => this.components[index] + component)\r\n        )\r\n    }\r\n\r\n    // return a Vector = Point - Point \r\n    sub({ components }) {\r\n        return new Vector(\r\n            ...components.map((component, index) => this.components[index] - component)\r\n        )\r\n    }\r\n\r\n}\r\n\r\n","\r\nexport default class Line {\r\n    \r\n    constructor(p1, p2) {\r\n      this.p1 = p1\r\n      this.p2 = p2\r\n      this.m = (p2.y-p1.y) / (p2.x-p1.x)\r\n      this.c =  p1.y - this.m * p1.x\r\n    }\r\n\r\n    length() {\r\n        return this.p1.distance(this.p2)\r\n    }\r\n\r\n    distance(line) {\r\n      const d = Math.abs(line.c - this.c) / Math.sqrt(1+Math.pow(this.m, 2))\r\n      if (isNaN(d)) return 0\r\n      else return d\r\n    }\r\n}","import Point from '../LinearAlgebra/Point'\r\nimport Vector from '../LinearAlgebra/Vector'\r\nimport Matrix from '../LinearAlgebra/Matrix'\r\n\r\nexport default class DicomGeometry {\r\n    constructor(image) {\r\n      this.image = image\r\n      // Image Position Patient - x, y, z of top hand corner\r\n      const ipp = this.image.data.string('x00200032').split('\\\\').map(v => parseFloat(v)) \r\n      // Image Orientation Patient - x, y, z of direction cosines of the first row and x, y, z of direction cosines of the first column\r\n      const iop = this.image.data.string('x00200037').split('\\\\').map(v => parseFloat(v)) \r\n\r\n      const pixelSpacing = this.image.data.string('x00280030').split('\\\\').map(v => parseFloat(v)) \r\n      this.spacingY = pixelSpacing[0]\r\n      this.spacingX = pixelSpacing[1]\r\n\r\n      this.rows = image.rows\r\n      this.cols = image.columns\r\n\r\n      this.lengthX = this.cols * this.spacingY\r\n      this.lengthY = this.rows * this.spacingX\r\n\r\n      this.rowDir = new Vector(iop[0], iop[1], iop[2]) \r\n      this.colDir = new Vector(iop[3], iop[4], iop[5]) \r\n\r\n      this.nrmDir = this.rowDir.crossProduct(this.colDir)\r\n\r\n      this.topLeft = new Point(ipp[0], ipp[1], ipp[2])\r\n      this.topRight = this.topLeft.add(this.rowDir.mul(this.spacingX * this.cols))\r\n      this.bottomLeft = this.topLeft.add(this.colDir.mul(this.spacingY * this.rows))\r\n      this.bottomRight = this.bottomLeft.add(this.topRight.sub(this.topLeft)) \r\n\r\n      this.transformImageToRcs = new Matrix(\r\n        [this.rowDir.x*this.spacingX, this.colDir.x*this.spacingY, this.nrmDir.x, this.topLeft.x],\r\n        [this.rowDir.y*this.spacingX, this.colDir.y*this.spacingY, this.nrmDir.y, this.topLeft.y],\r\n        [this.rowDir.z*this.spacingX, this.colDir.z*this.spacingY, this.nrmDir.z, this.topLeft.z],\r\n        [0,                           0,                           0,             1             ]\r\n      )  \r\n      this.transformRcsToImage = this.transformImageToRcs.inverse() \r\n\r\n      const p = this.nrmDir.round().abs()\r\n      if (p.x === 1)\r\n        this.orientation = 'sagittal'\r\n      else if (p.y === 1) \r\n        this.orientation = 'coronal'\r\n      else if (p.z === 1) \r\n        this.orientation = 'axial'   \r\n\r\n    }\r\n\r\n}","import React from \"react\"\r\nimport {connect} from 'react-redux'\r\nimport Button from '@material-ui/core/Button'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport DialogContent from '@material-ui/core/DialogContent'\r\nimport DialogContentText from '@material-ui/core/DialogContentText'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport Link from '@material-ui/core/Link'\r\nimport Typography from '@material-ui/core/Typography'\r\nimport Hammer from \"hammerjs\"\r\nimport * as cornerstone from \"cornerstone-core\"\r\nimport * as cornerstoneTools from \"cornerstone-tools\"\r\nimport * as cornerstoneMath from \"cornerstone-math\"\r\nimport * as cornerstoneFileImageLoader from \"cornerstone-file-image-loader\"\r\nimport * as cornerstoneWebImageLoader from \"cornerstone-web-image-loader\"\r\nimport * as cornerstoneWADOImageLoader from \"cornerstone-wado-image-loader\"\r\nimport * as dicomParser from 'dicom-parser'\r\nimport * as blobUtil from 'blob-util'\r\nimport {uids} from '../constants/uids'\r\nimport { SETTINGS_SAVEAS } from '../constants/settings'\r\nimport OpenUrlDlg from './OpenUrlDlg'\r\nimport CinePlayer from './CinePlayer'\r\nimport { isMobile } from 'react-device-detect'\r\nimport { import as csTools } from 'cornerstone-tools'\r\nimport db from '../db/db'\r\nimport fs from '../fs/fs'\r\nimport Matrix from '../LinearAlgebra/Matrix'\r\nimport Point from '../LinearAlgebra/Point'\r\nimport Line from '../LinearAlgebra/Line'\r\nimport DicomGeometry from '../DicomGeometry/DicomGeometry'\r\n\r\nimport { \r\n  areEqual, \r\n} from '../LinearAlgebra/utils'\r\n\r\nimport {\r\n  clearStore, \r\n  dcmIsOpen, \r\n  activeDcm, \r\n  dcmTool, \r\n  activeMeasurements,\r\n  doFsRefresh,\r\n  setDcmEnableTool,\r\n} from '../actions'\r\n\r\nimport {\r\n  getDicomIpp,\r\n  //getDicomFrameOfReferenceUID,\r\n  capitalize,  \r\n  getFileName,\r\n  getSettingsOverlay,  \r\n  getSettingsSaveInto,\r\n  isFileImage,\r\n  isFsFileImage,\r\n  isLocalizer,  \r\n  isUrlImage,\r\n  //objectIsEmpty,\r\n} from '../functions'\r\n\r\n\r\nconst scrollToIndex = csTools('util/scrollToIndex')\r\n\r\ncornerstoneTools.external.cornerstone = cornerstone\r\ncornerstoneTools.external.cornerstoneMath = cornerstoneMath\r\ncornerstoneFileImageLoader.external.cornerstone = cornerstone\r\ncornerstoneWebImageLoader.external.cornerstone = cornerstone\r\ncornerstoneWADOImageLoader.external.cornerstone = cornerstone\r\ncornerstoneWADOImageLoader.external.dicomParser = dicomParser\r\ncornerstoneTools.external.Hammer = Hammer\r\ncornerstoneTools.init({\r\n  globalToolSyncEnabled: true,\r\n})\r\n\r\nclass DicomViewer extends React.Component {\r\n    constructor(props) {\r\n      super(props)\r\n      this.files = null\r\n      this.filename = ''\r\n      this.localfile = null\r\n      this.localurl = null\r\n      this.fsItem = null\r\n      this.dicomImage = null\r\n      this.explorerIndex = 0\r\n      this.imageId = null\r\n      this.image = null\r\n      this.isDicom = false\r\n      this.layoutIndex = 0\r\n      this.numberOfFrames = 1\r\n      this.measurements = []\r\n      this.xSize = 0\r\n      this.ySize = 0\r\n      this.zSize = 0\r\n      this.volume = null\r\n      this.originImage = null\r\n      this.mprPlane = ''\r\n      this.sliceMax = 0\r\n      this.sliceIndex = 0\r\n      this.mpr = {}      \r\n      this.referenceLines = {}\r\n      this.shouldScroll = false\r\n    }\r\n\r\n    state = {\r\n      visibleOpenUrlDlg: false,\r\n      progress: null,\r\n      visibleCinePlayer: false,\r\n      errorOnOpenImage: null,\r\n      errorOnCors: false,\r\n      frame: 1,\r\n      inPlay: false,\r\n      viewport: null,\r\n    }\r\n\r\n    componentDidMount() {\r\n      this.props.runTool(this)\r\n      this.props.changeTool(this)\r\n      cornerstone.events.addEventListener('cornerstoneimageloaded', this.onImageLoaded)\r\n      const { dcmRef } = this.props\r\n      dcmRef(this)          \r\n      this.layoutIndex = this.props.index\r\n\r\n      document.getElementById(`viewer-${this.props.index}`).addEventListener(\"wheel\", this.handlerMouseScroll)\r\n    }\r\n\r\n    componentWillUnmount() {\r\n      this.props.runTool(undefined)\r\n      this.props.changeTool(undefined)\r\n      const { dcmRef } = this.props\r\n      dcmRef(undefined)            \r\n    }\r\n\r\n    componentDidUpdate(previousProps) {\r\n      const isOpen = this.props.isOpen[this.props.index]\r\n      if (this.props.layout !== previousProps.layout && isOpen) {\r\n        cornerstone.resize(this.dicomImage)\r\n      }\r\n    }\r\n  \r\n    handlerMouseScroll = (e) => {\r\n      if (this.shouldScroll) { \r\n        if (e.deltaY > 0) this.props.listOpenFilesNextFrame()\r\n        else if (e.deltaY < 0) this.props.listOpenFilesPreviousFrame()\r\n      }\r\n    }\r\n\r\n    onOpenUrl = (e) => {\r\n      const eventData = e.detail\r\n      this.setState({ progress: eventData.percentComplete })\r\n    }\r\n\r\n    showOpenUrlDlg = (url) => {\r\n      this.setState({ visibleOpenUrlDlg: true }, () => {\r\n        cornerstone.events.addEventListener('cornerstoneimageloadprogress', this.onOpenUrl)\r\n        this.loadImage(undefined, url)\r\n      })\r\n    }\r\n  \r\n    hideOpenUrlDlg = () => {\r\n      this.setState({ visibleOpenUrlDlg: false, progress: null })\r\n    }\r\n\r\n    measurementSave = (measure) => {\r\n      this.measurements.push(measure) \r\n    }\r\n\r\n    measurementClear = () => {\r\n      this.measurements.splice(0, this.measurements.length)\r\n    }\r\n\r\n    measurementRemove = (index) => {\r\n      this.measurements.splice(index, 1)\r\n    }    \r\n\r\n    getTransferSyntax = () => {\r\n      const value = this.image.data.string('x00020010')\r\n      return value + ' [' + uids[value] + ']'\r\n    }\r\n\r\n    getSopClass = () => {\r\n      const value = this.image.data.string('x00080016')\r\n      return value + ' [' + uids[value] + ']'\r\n    }\r\n\r\n    getSopInstanceUID = () => {\r\n      const value = this.image.data.string('x00080018')\r\n      return value\r\n    }\r\n\r\n    getPixelRepresentation = () => {\r\n      const value = this.image.data.uint16('x00280103')\r\n      if (value === undefined) return\r\n      return value + (value === 0 ? ' (unsigned)' : ' (signed)')\r\n    }\r\n\r\n    getPlanarConfiguration = () => {\r\n      const value = this.image.data.uint16('x00280006')\r\n      if (value === undefined) return \r\n      return value + (value === 0 ? ' (pixel)' : ' (plane)')\r\n    }\r\n\r\n    getDicomViewerElement = () => {\r\n      return document.getElementsByClassName('cornerstone-enabled-image')\r\n    }\r\n   \r\n    onImageLoaded = (e) => {\r\n      this.props.onLoadedImage()\r\n    }\r\n\r\n    // Listen for changes to the viewport so we can update the text overlays in the corner\r\n    onImageRendered = (e) => {\r\n      const viewport = cornerstone.getViewport(e.target)\r\n      this.zoom = Math.round(viewport.scale.toFixed(2)*100)\r\n\r\n      document.getElementById(\r\n        `mrtopleft-${this.props.index}`\r\n      ).textContent = this.mprIsOrthogonalView() ? `${capitalize(this.mprPlane)}` : `${this.PatientsName}`\r\n\r\n      document.getElementById(\r\n        `mrtopright-${this.props.index}`\r\n      ).textContent = `${viewport.displayedArea.brhc.x}x${viewport.displayedArea.brhc.y}`\r\n\r\n      document.getElementById(\r\n        `mrbottomleft-${this.props.index}`\r\n      ).textContent = `WW/WC: ${Math.round(viewport.voi.windowWidth)}/${Math.round(viewport.voi.windowCenter)}`\r\n\r\n      document.getElementById(\r\n        `mrbottomright-${this.props.index}`\r\n      ).textContent = `Zoom: ${this.zoom}%`\r\n\r\n      document.getElementById(\r\n        `mrtopcenter-${this.props.index}`\r\n      ).textContent = ``\r\n      document.getElementById(\r\n        `mrbottomcenter-${this.props.index}`\r\n      ).textContent = ``    \r\n      document.getElementById(\r\n        `mrleftcenter-${this.props.index}`\r\n      ).textContent = ``      \r\n      document.getElementById(\r\n        `mrrightcenter-${this.props.index}`\r\n      ).textContent = ``  \r\n\r\n      if (this.mprPlane === 'sagittal') {\r\n        document.getElementById(\r\n          `mrtopcenter-${this.props.index}`\r\n        ).textContent = `S`\r\n        document.getElementById(\r\n          `mrbottomcenter-${this.props.index}`\r\n        ).textContent = `I`    \r\n        document.getElementById(\r\n          `mrleftcenter-${this.props.index}`\r\n        ).textContent = `A`      \r\n        document.getElementById(\r\n          `mrrightcenter-${this.props.index}`\r\n        ).textContent = `P`  \r\n\r\n      } else if (this.mprPlane === 'axial') {\r\n        document.getElementById(\r\n          `mrtopcenter-${this.props.index}`\r\n        ).textContent = `A`\r\n        document.getElementById(\r\n          `mrbottomcenter-${this.props.index}`\r\n        ).textContent = `P`    \r\n        document.getElementById(\r\n          `mrleftcenter-${this.props.index}`\r\n        ).textContent = `R`      \r\n        document.getElementById(\r\n          `mrrightcenter-${this.props.index}`\r\n        ).textContent = `L`    \r\n\r\n      } else if (this.mprPlane === 'coronal') {\r\n        document.getElementById(\r\n          `mrtopcenter-${this.props.index}`\r\n        ).textContent = `S`\r\n        document.getElementById(\r\n          `mrbottomcenter-${this.props.index}`\r\n        ).textContent = `I`    \r\n        document.getElementById(\r\n          `mrleftcenter-${this.props.index}`\r\n        ).textContent = `R`      \r\n        document.getElementById(\r\n          `mrrightcenter-${this.props.index}`\r\n        ).textContent = `L`                    \r\n      }    \r\n\r\n      if (this.referenceLines.isScoutDraw) {\r\n        this.referenceLines.isScoutDraw = false\r\n        this.referenceLinesDraw()\r\n      }\r\n\r\n      if (this.mpr.isSliceLocation) {\r\n        this.mpr.isSliceLocation = false\r\n        this.mprSliceLocationDraw()\r\n      }\r\n\r\n      if (this.isDicom && this.state.visibleCinePlayer && this.numberOfFrames > 1) {\r\n        document.getElementById(\r\n          `frameLabel-${this.props.index}`\r\n        ).textContent = `${this.state.frame} / ${this.numberOfFrames}`\r\n        if (this.state.inPlay) {\r\n          let frame = this.state.frame === this.numberOfFrames ? 1 : this.state.frame+1\r\n          this.setState({frame: frame})\r\n        }\r\n      }\r\n\r\n      this.props.onRenderedImage(this.props.index)\r\n    }\r\n\r\n    onMeasurementModified = (e) => {\r\n      \r\n    }\r\n\r\n    onMeasurementAdded = (e) => {\r\n      if (this.props.tool !== \"Angle\") return\r\n      const measure = {\r\n        tool: this.props.tool,\r\n        note: '',\r\n        data: e.detail.measurementData\r\n      }\r\n      this.measurementSave(measure)\r\n      this.props.setActiveMeasurements(this.measurements)      \r\n    }\r\n\r\n    onMeasurementCompleted = (e) => {\r\n      const measure = {\r\n        tool: this.props.tool,\r\n        note: '',\r\n        data: e.detail.measurementData\r\n      }\r\n      if (this.props.tool === \"FreehandRoi\") {\r\n        setTimeout(() => {\r\n          this.measurementSave(measure)\r\n          this.props.setActiveMeasurements(this.measurements)\r\n        }, 500)\r\n      } else {\r\n        this.measurementSave(measure)\r\n        this.props.setActiveMeasurements(this.measurements)\r\n      }\r\n    }\r\n    \r\n    onErrorOpenImageClose = () => {\r\n      this.setState({errorOnOpenImage: null})\r\n    }\r\n\r\n    onErrorCorsClose = () => {\r\n      this.setState({errorOnCors: false})\r\n    }    \r\n\r\n    updateImage = () => {\r\n      const element = this.dicomImage\r\n      cornerstone.updateImage(element)\r\n    }\r\n\r\n    displayImageFromFiles = (index) => {\r\n\r\n      const files = this.files === null ? this.props.files : this.files\r\n\r\n      const image = files[index].image\r\n      const imageId = files[index].imageId\r\n      this.filename = files[index].name\r\n      this.sliceIndex = index\r\n\r\n      const element = this.dicomImage\r\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage)\r\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted)\r\n      cornerstone.enable(element)\r\n\r\n      this.image = image\r\n\r\n      this.isDicom = true\r\n      \r\n      this.PatientsName = image.data.string('x00100010')\r\n      this.sopInstanceUid = this.getSopInstanceUID()\r\n\r\n      let stack = { currentImageIdIndex: 0, imageIds: \"\" }\r\n      this.numberOfFrames = image.data.intString('x00280008')\r\n      if (this.numberOfFrames > 0) {\r\n        let imageIds = []\t\r\n        for(var i=0; i < this.numberOfFrames; ++i) {\r\n          imageIds.push(imageId + \"?frame=\"+i)\r\n        }\t\r\n        stack.imageIds = imageIds\r\n      }\r\n\r\n      cornerstone.displayImage(element, image)\r\n\r\n      this.mprPlanePosition()\r\n      \r\n      this.enableTool()\r\n\r\n      if (this.numberOfFrames > 1) {\r\n        cornerstoneTools.addStackStateManager(element, ['stack', 'playClip']);    \r\n        cornerstoneTools.addToolState(element, 'stack', stack)\r\n        this.setState({frame: 1})\r\n      }\r\n     \r\n      // Load the possible measurements from DB and save in the store \r\n      db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).each(measure => {\r\n        this.measurementSave(measure)\r\n        cornerstoneTools.addToolState(element, measure.tool, measure.data)\r\n        this.runTool(measure.tool)\r\n        cornerstone.updateImage(element)\r\n        cornerstoneTools.setToolEnabled(measure.tool)\r\n      }).then(() => {\r\n        //if (this.useIsNormal) {\r\n          this.props.setActiveMeasurements(this.measurements)\r\n          this.props.setActiveDcm(this) // {image: this.image, element: this.dicomImage, isDicom: this.isDicom}     \r\n          this.props.setIsOpenStore({index: this.props.index, value: true})         \r\n        //} \r\n      })   \r\n      \r\n    }\r\n\r\n    loadImageFromCanvas = (canvas) => {\r\n\r\n      const element = this.dicomImage\r\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage)\r\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted)\r\n      cornerstone.enable(element)\r\n\r\n      const imageId = cornerstoneFileImageLoader.fileManager.addCanvas(canvas)\r\n\r\n      cornerstone.loadImage(imageId).then(image => {\r\n        this.image = image\r\n\r\n        this.isDicom = false\r\n\r\n        cornerstone.displayImage(element, image)\r\n\r\n        this.enableTool()\r\n\r\n        this.props.setIsOpenStore({index: this.props.index, value: true})\r\n\r\n      }, (e) => {\r\n        console.log('error', e)\r\n        this.setState({errorOnOpenImage: \"This is not a valid canvas.\"})\r\n      })\r\n    }\r\n\r\n    loadImageFromCustomObject = (columns, rows, pixelData) => {\r\n\r\n      const element = this.dicomImage\r\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage)\r\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted)\r\n      cornerstone.enable(element)\r\n      \r\n      let customObj = {\r\n        rows: rows,\r\n        columns: columns,\r\n        pixelData: pixelData,\r\n        image: this.originImage,\r\n      }\r\n\r\n      const imageId = cornerstoneFileImageLoader.fileManager.addCustom(customObj)\r\n\r\n      cornerstone.loadImage(imageId).then(image => {\r\n        this.image = image\r\n        this.isDicom = true\r\n\r\n        cornerstone.displayImage(element, image)\r\n\r\n        this.props.setIsOpenStore({index: this.props.index, value: true})\r\n      }, (e) => {\r\n        console.log('error', e)\r\n        this.setState({errorOnOpenImage: \"This is not a valid canvas.\"})\r\n      })\r\n    }\r\n\r\n    loadImage = (localfile, url=undefined, fsItem=undefined) => {\r\n\r\n      if (localfile === undefined && url === undefined && fsItem === undefined) return\r\n      \r\n      if (fsItem !== undefined) {\r\n        this.fsItem = fsItem\r\n      } else if (localfile !== undefined) {\r\n        this.localfile = localfile\r\n      } else {\r\n        this.localurl = url\r\n      }\r\n \r\n      const element = this.dicomImage\r\n\r\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage)\r\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted)\r\n\r\n      let imageId = undefined\r\n\r\n      cornerstone.enable(element)\r\n\r\n      if (localfile === undefined && isUrlImage(url)) { // check if it's a simple image [jpeg or png] from url\r\n        cornerstone.loadImage(url).then(image => {\r\n          this.hideOpenUrlDlg()\r\n          this.image = image\r\n          this.isDicom = false\r\n          cornerstone.displayImage(element, image)        \r\n          this.enableTool()\r\n          this.props.setActiveDcm(this) // {image: this.image, element: this.dicomImage, isDicom: this.isDicom}\r\n          this.props.isOpenStore(true)\r\n\r\n        }, (e) => {\r\n          console.log('error', e)\r\n          this.setState({errorOnOpenImage: \"This is not a valid JPG or PNG file.\"})\r\n        })\r\n\r\n      } else if ((localfile !== undefined && isFileImage(localfile)) || (fsItem !== undefined && isFsFileImage(fsItem))) { // otherwise try to open as local image file (JPEG, PNG) \r\n        if (fsItem !== undefined) {\r\n          imageId = cornerstoneFileImageLoader.fileManager.addBuffer(fsItem.data)\r\n        } else {\r\n          imageId = cornerstoneFileImageLoader.fileManager.add(localfile)\r\n        }\r\n        cornerstone.loadImage(imageId).then(image => {\r\n          console.log('loadImage, image from local: ', image)\r\n\r\n          this.image = image\r\n          this.isDicom = false\r\n          this.PatientsName = ''\r\n\r\n          cornerstone.displayImage(element, image)\r\n          \r\n          this.enableTool()\r\n\r\n          this.props.setActiveDcm(this) // {image: this.image, element: this.dicomImage, isDicom: this.isDicom}\r\n          this.props.setIsOpenStore({index: this.props.index, value: true})\r\n\r\n        }, (e) => {\r\n          console.log('error', e)\r\n          this.setState({errorOnOpenImage: \"This is not a valid JPG or PNG file.\"})\r\n        })\r\n\r\n      } else { // otherwise try to open as Dicom file\r\n        //let size = 0\r\n        if (fsItem !== undefined) {\r\n          imageId = cornerstoneWADOImageLoader.wadouri.fileManager.addBuffer(fsItem.data)\r\n          this.filename = fsItem.name\r\n          //size = fsItem.size\r\n        } else if (localfile !== undefined) {\r\n          imageId = cornerstoneWADOImageLoader.wadouri.fileManager.add(localfile)\r\n          this.filename = localfile.name\r\n          //size = localfile.size\r\n        } else { // it's a web dicom image\r\n          imageId = \"wadouri:\"+url\r\n        }\r\n\r\n        cornerstone.loadAndCacheImage(imageId).then(image => {\r\n          \r\n          this.hideOpenUrlDlg()\r\n\r\n          this.image = image\r\n\r\n          this.isDicom = true\r\n\r\n          this.PatientsName = image.data.string('x00100010')\r\n          this.sopInstanceUid = this.getSopInstanceUID()\r\n\r\n          let stack = { currentImageIdIndex: 0, imageIds: \"\" }\r\n          this.numberOfFrames = image.data.intString('x00280008')\r\n          if (this.numberOfFrames > 0) {\r\n            let imageIds = []\t\r\n            for(var i=0; i < this.numberOfFrames; ++i) {\r\n              imageIds.push(imageId + \"?frame=\"+i)\r\n            }\t\r\n            stack.imageIds = imageIds\r\n          }\r\n\r\n          cornerstone.displayImage(element, image)\r\n          //cornerstoneTools.mouseInput.enable(element);\r\n          //cornerstoneTools.mouseWheelInput.enable(element);\r\n\r\n          this.enableTool()\r\n\r\n          if (this.numberOfFrames > 1) {\r\n            cornerstoneTools.addStackStateManager(element, ['stack', 'playClip']);    \r\n            cornerstoneTools.addToolState(element, 'stack', stack)\r\n            //cornerstoneTools.setToolActive('StackScrollMouseWheel', { })\r\n            this.setState({frame: 1})\r\n          }\r\n  \r\n          // Load the possible measurements from DB and save in the store \r\n          db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).each(measure => {\r\n            this.measurementSave(measure)\r\n            cornerstoneTools.addToolState(element, measure.tool, measure.data)\r\n            this.runTool(measure.tool)\r\n            cornerstone.updateImage(element)\r\n            cornerstoneTools.setToolEnabled(measure.tool)\r\n          }).then(() => {\r\n            this.props.setActiveMeasurements(this.measurements)\r\n            this.props.setActiveDcm(this) // {name: this.filename, size: size, image: this.image, element: this.dicomImage, isDicom: this.isDicom}\r\n            this.props.setIsOpenStore({index: this.props.index, value: true})            \r\n          })       \r\n\r\n        }, (e) => {\r\n          console.log('error', e)   \r\n          this.hideOpenUrlDlg()     \r\n          const error = e.error.toString()\r\n          if (error === '[object XMLHttpRequest]') {\r\n            this.setState({errorOnCors: true})\r\n          } else {\r\n            const pos = error.indexOf(\":\")\r\n            this.setState({errorOnOpenImage: pos < 0 ? e.error : error.substring(pos+1)})            \r\n          } \r\n        })\r\n      }\r\n    }\r\n  \r\n    enableTool = (toolName, mouseButtonNumber) => {\r\n      if (this.props.dcmEnableTool) return\r\n      // Enable all tools we want to use with this element\r\n      const WwwcTool = cornerstoneTools.WwwcTool\r\n      const LengthTool = cornerstoneTools['LengthTool']\r\n      const PanTool = cornerstoneTools.PanTool\r\n      const ZoomTouchPinchTool = cornerstoneTools.ZoomTouchPinchTool\r\n      const ZoomTool = cornerstoneTools.ZoomTool\r\n      const ProbeTool = cornerstoneTools.ProbeTool\r\n      const EllipticalRoiTool = cornerstoneTools.EllipticalRoiTool\r\n      const RectangleRoiTool = cornerstoneTools.RectangleRoiTool\r\n      const FreehandRoiTool = cornerstoneTools.FreehandRoiTool\r\n      const AngleTool = cornerstoneTools.AngleTool\r\n      const MagnifyTool = cornerstoneTools.MagnifyTool\r\n      const StackScrollMouseWheelTool = cornerstoneTools.StackScrollMouseWheelTool\r\n\r\n      cornerstoneTools.addTool(MagnifyTool)\r\n      cornerstoneTools.addTool(AngleTool)    \r\n      cornerstoneTools.addTool(WwwcTool)\r\n      cornerstoneTools.addTool(LengthTool)\r\n      cornerstoneTools.addTool(PanTool)\r\n      cornerstoneTools.addTool(ZoomTouchPinchTool)\r\n      cornerstoneTools.addTool(ZoomTool)\r\n      cornerstoneTools.addTool(ProbeTool)\r\n      cornerstoneTools.addTool(EllipticalRoiTool)\r\n      cornerstoneTools.addTool(RectangleRoiTool)\r\n      cornerstoneTools.addTool(FreehandRoiTool)\r\n      cornerstoneTools.addTool(StackScrollMouseWheelTool)   \r\n      \r\n      this.props.setDcmEnableToolStore(true)\r\n    }\r\n  \r\n    // helper function used by the tool button handlers to disable the active tool\r\n    // before making a new tool active\r\n    disableAllTools = () => {\r\n      this.props.setDcmEnableToolStore(false)\r\n      cornerstoneTools.setToolEnabled('Length')\r\n      cornerstoneTools.setToolEnabled('Pan')\r\n      cornerstoneTools.setToolEnabled('Magnify')\r\n      cornerstoneTools.setToolEnabled('Angle')\r\n      cornerstoneTools.setToolEnabled('RectangleRoi')\r\n      cornerstoneTools.setToolEnabled('Wwwc')\r\n      cornerstoneTools.setToolEnabled('ZoomTouchPinch')\r\n      cornerstoneTools.setToolEnabled('Probe')\r\n      cornerstoneTools.setToolEnabled('EllipticalRoi')\r\n      cornerstoneTools.setToolEnabled('FreehandRoi')\r\n      cornerstoneTools.setToolEnabled('StackScrollMouseWheel')\r\n    }\r\n  \r\n    runTool = (toolName, opt) => {\r\n      if (this.state.inPlay) {\r\n        this.runCinePlayer('pause')\r\n      }\r\n      switch (toolName) {\r\n        case 'setfiles': {\r\n          this.files = opt\r\n          this.sliceMax = this.files.length\r\n          this.shouldScroll = this.files.length > 1\r\n          break   \r\n        }        \r\n        case 'openimage': {\r\n          cornerstone.disable(this.dicomImage)\r\n          this.displayImageFromFiles(opt)\r\n          break   \r\n        }\r\n        case 'openLocalFs': {\r\n          cornerstone.disable(this.dicomImage)\r\n          this.loadImage(opt)\r\n          break   \r\n        } \r\n        case 'openSandboxFs': {\r\n          cornerstone.disable(this.dicomImage)\r\n          this.loadImage(undefined, undefined, opt)\r\n          break   \r\n        }         \r\n        case 'openurl': {\r\n          this.showOpenUrlDlg(opt)\r\n          break                 \r\n        }\r\n        case 'clear': {\r\n          this.setState({ visibleCinePlayer: false })\r\n          this.mprPlane = ''\r\n          this.files = null\r\n          this.props.setIsOpenStore({index: this.props.index, value: false}) \r\n          cornerstone.disable(this.dicomImage)\r\n          break\r\n        }  \r\n        case 'notool': {\r\n          this.disableAllTools()\r\n          break\r\n        }\r\n        case 'Wwwc': {\r\n          cornerstoneTools.setToolActive('Wwwc', { mouseButtonMask: 1 })\r\n          break\r\n        }  \r\n        case 'Pan': {\r\n          cornerstoneTools.setToolActive('Pan', { mouseButtonMask: 1 })\r\n          break   \r\n        }  \r\n        case 'Zoom': {\r\n          cornerstoneTools.setToolActive(isMobile ? 'ZoomTouchPinch' : 'Zoom', { mouseButtonMask: 1 })\r\n          break\r\n        }\r\n        case 'Length': {\r\n          cornerstoneTools.setToolActive('Length', isMobile ? { isTouchActive: true } : { mouseButtonMask: 1 })\r\n          break  \r\n        }\r\n        case 'Probe': {\r\n            cornerstoneTools.setToolActive('Probe', { mouseButtonMask: 1 })\r\n          break\r\n        }\r\n        case 'EllipticalRoi': {\r\n          cornerstoneTools.setToolActive('EllipticalRoi', { mouseButtonMask: 1 })\r\n          break   \r\n        }\r\n        case 'RectangleRoi': {\r\n          cornerstoneTools.setToolActive('RectangleRoi', { mouseButtonMask: 1 })\r\n          break  \r\n        }\r\n        case 'Angle': {\r\n          cornerstoneTools.setToolActive('Angle', { mouseButtonMask: 1 })\r\n          break \r\n        }\r\n        case 'Magnify': {\r\n          cornerstoneTools.setToolActive('Magnify', { mouseButtonMask: 1 })\r\n          break  \r\n        }\r\n        case 'FreehandRoi': {\r\n          cornerstoneTools.setToolActive('FreehandRoi', { mouseButtonMask: 1 })\r\n          break \r\n        }\r\n        case 'Invert': {\r\n          const element = this.dicomImage\r\n          const viewport = cornerstone.getViewport(element)\r\n          viewport.invert = !viewport.invert\r\n          cornerstone.setViewport(element, viewport)\r\n          break \r\n        }         \r\n        case 'saveas': {\r\n            let type = localStorage.getItem(SETTINGS_SAVEAS)\r\n            if (getSettingsSaveInto() === 'local') {\r\n              // cornerstoneTools.SaveAs(this.dicomImage, `${this.filename}.${type}`, `image/${type}`)   \r\n              const element = this.dicomImage\r\n              const viewport = cornerstone.getViewport(element)\r\n              const canvas = document.getElementsByClassName('cornerstone-canvas')[this.props.activeDcmIndex]\r\n              const zoom = viewport.scale.toFixed(2)\r\n              const cols = this.image.columns * zoom\r\n              const rows = this.image.rows * zoom\r\n\r\n              let myCanvas = document.createElement('canvas')\r\n              myCanvas = this.cropCanvas(canvas, \r\n                Math.round(canvas.width / 2 - cols / 2), \r\n                Math.round(canvas.height / 2 - rows / 2), \r\n                cols, rows)   \r\n\r\n              let a = document.createElement(\"a\")\r\n              a.href = myCanvas.toDataURL(`image/${type}`)\r\n              a.download = `${this.filename}.${type}`    \r\n              document.body.appendChild(a) // Required for this to work in FireFox\r\n              a.click()           \r\n\r\n            } else { // store image into sandbox file system\r\n              const element = this.dicomImage\r\n              const viewport = cornerstone.getViewport(element)\r\n              const canvas = document.getElementsByClassName('cornerstone-canvas')[this.props.activeDcmIndex]\r\n              const zoom = viewport.scale.toFixed(2)\r\n              const cols = this.image.columns * zoom\r\n              const rows = this.image.rows * zoom\r\n\r\n              let myCanvas = document.createElement('canvas')\r\n              myCanvas = this.cropCanvas(canvas, \r\n                Math.round(canvas.width / 2 - cols / 2), \r\n                Math.round(canvas.height / 2 - rows / 2), \r\n                cols, rows)           \r\n              \r\n              blobUtil.canvasToBlob(myCanvas, `image/${type}`).then(blob => {\r\n                blobUtil.blobToArrayBuffer(blob).then(arrayBuffer => {\r\n                  const name = `${getFileName(this.filename)}-MPR-${this.mprPlane}`     \r\n                  let newName = name\r\n                  let counter = 1\r\n                  let done = false             \r\n                  do {\r\n                      let filename = `${newName}.${type}`\r\n                      const checkName = this.props.fsCurrentList.find(e => e.name === filename)\r\n                      if (checkName === undefined) {\r\n                          fs.transaction('rw', fs.files, async () => {\r\n                              await fs.files.add({\r\n                                  parent: this.props.fsCurrentDir,\r\n                                  name: filename,\r\n                                  type: type,\r\n                                  size: arrayBuffer.byteLength,\r\n                                  data: arrayBuffer\r\n                              })\r\n                          }).then(() => {\r\n                            this.props.makeFsRefresh()\r\n                          })\r\n                          done = true\r\n                      } else {\r\n                          newName = `${name} - ${counter}`\r\n                          counter++\r\n                      }\r\n                  } while (!done)\r\n                })\r\n              })\r\n            }  \r\n          break\r\n        }\r\n        case 'cine': {\r\n          this.setState({ visibleCinePlayer: !this.state.visibleCinePlayer })\r\n          break\r\n        }\r\n        case 'reset': {\r\n          this.reset()\r\n          break\r\n        }\r\n        case 'removetool': {\r\n          const element = this.dicomImage\r\n          cornerstoneTools.removeToolState(element, this.measurements[opt].tool, this.measurements[opt].data)\r\n          cornerstone.updateImage(element)\r\n          //this.props.measurementRemoveStore(opt)\r\n          this.measurementRemove(opt)\r\n          this.props.setActiveMeasurements(this.measurements)\r\n          break\r\n        }  \r\n        case 'removetools': {   \r\n          const element = this.dicomImage\r\n          // for each measurement remove it \r\n          this.measurements.forEach(measure => {\r\n            cornerstoneTools.clearToolState(element, measure.tool)         \r\n          })\r\n          cornerstone.updateImage(element)\r\n          this.measurementClear()\r\n          // also remove all measurements from db\r\n          db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).delete()\r\n          this.props.setActiveMeasurements(this.measurements)\r\n          break\r\n        }  \r\n        case 'savetools': {\r\n          // first, remove eventually previous measurements from db\r\n          db.measurement.where('sopinstanceuid').equals(this.sopInstanceUid).delete()\r\n          // then save all the current measurements\r\n          this.measurements.forEach(measure => {\r\n            try {\r\n              db.measurement.add({\r\n                sopinstanceuid: this.sopInstanceUid, \r\n                tool: measure.tool,\r\n                note: measure.note,\r\n                data: measure.data\r\n              })\r\n            } catch(error) {\r\n              console.error(error)\r\n            }                       \r\n          })\r\n          break\r\n        }\r\n        default: {\r\n          break\r\n        }\r\n      }\r\n    } \r\n\r\n    cropCanvas = (canvas, x, y, width, height) => {\r\n      // create a temp canvas\r\n      const newCanvas = document.createElement('canvas')\r\n      // set its dimensions\r\n      newCanvas.width = width\r\n      newCanvas.height = height\r\n      // draw the canvas in the new resized temp canvas \r\n      newCanvas.getContext('2d').drawImage(canvas, x, y, width, height, 0, 0, width, height)\r\n      return newCanvas\r\n    }\r\n\r\n    changeTool = (toolName, value) => {\r\n\r\n      switch (toolName) {\r\n        case 'Wwwc':\r\n          if (value === 1) {\r\n            cornerstoneTools.setToolActive('Wwwc', { mouseButtonMask: 1 })\r\n          } else if (value === 0) {\r\n            cornerstoneTools.setToolPassive('Wwwc')\r\n          }\r\n          break  \r\n        case 'Pan':\r\n          if (value === 1) {\r\n            cornerstoneTools.setToolActive('Pan', { mouseButtonMask: 1 })\r\n          } else if (value === 0) {\r\n            cornerstoneTools.setToolPassive('Pan')\r\n          }\r\n          break    \r\n        case 'Zoom':\r\n          if (value === 1) {\r\n            cornerstoneTools.setToolActive(isMobile ? 'ZoomTouchPinch' : 'Zoom', { mouseButtonMask: 1 })\r\n          } else if (value === 0) {\r\n            cornerstoneTools.setToolPassive(isMobile ? 'ZoomTouchPinch' : 'Zoom')\r\n          }\r\n          break                             \r\n        case 'Length':\r\n          if (value === 1) {\r\n            cornerstoneTools.setToolActive('Length', isMobile ? { isTouchActive: true } : { mouseButtonMask: 1 })\r\n          } else if (value === 0) {\r\n            cornerstoneTools.setToolPassive('Length')\r\n          }\r\n          break   \r\n        case 'Probe':\r\n          if (value === 1) {\r\n            cornerstoneTools.setToolActive('Probe', { mouseButtonMask: 1 })\r\n          } else if (value === 0) {\r\n            cornerstoneTools.setToolPassive('Probe')\r\n          }\r\n          break        \r\n        case 'Angle':\r\n          if (value === 1) {\r\n            cornerstoneTools.setToolActive('Angle', { mouseButtonMask: 1 })\r\n          } else if (value === 0) {\r\n            cornerstoneTools.setToolPassive('Angle')\r\n          }          \r\n          break   \r\n        case 'Magnify':\r\n          if (value === 1) {\r\n            cornerstoneTools.setToolActive('Magnify', { mouseButtonMask: 1 })\r\n          } else if (value === 0) {\r\n            cornerstoneTools.setToolPassive('Magnify')\r\n          }          \r\n          break        \r\n        case 'EllipticalRoi':\r\n          if (value === 1) {\r\n            cornerstoneTools.setToolActive('EllipticalRoi', { mouseButtonMask: 1 })\r\n          } else if (value === 0) {\r\n            cornerstoneTools.setToolPassive('EllipticalRoi')\r\n          }\r\n          break   \r\n        case 'RectangleRoi':\r\n          if (value === 1) {\r\n            cornerstoneTools.setToolActive('RectangleRoi', { mouseButtonMask: 1 })\r\n          } else if (value === 0) {\r\n            cornerstoneTools.setToolPassive('RectangleRoi')\r\n          }\r\n          break\r\n        case 'FreehandRoi':\r\n          if (value === 1) {\r\n            cornerstoneTools.setToolActive('FreehandRoi', { mouseButtonMask: 1 })\r\n          } else if (value === 0) {\r\n            cornerstoneTools.setToolPassive('FreehandRoi')\r\n          }\r\n          break     \r\n        default:\r\n            break\r\n        }  \r\n    }\r\n\r\n    runCinePlayer = (cmdName) => {\r\n      //console.log('this.state.frame: ', this.state.frame)\r\n      const element = this.dicomImage\r\n      switch (cmdName) {\r\n        case 'firstframe': {\r\n          let frame = 1\r\n          this.setState({frame: frame})\r\n          scrollToIndex(element, 0)\r\n          break\r\n        }\r\n        case 'previousframe': {\r\n          if (this.state.frame > 1) {\r\n            let frame = this.state.frame-1\r\n            this.setState({frame: frame})     \r\n            scrollToIndex(element, frame-1)       \r\n          }\r\n          break\r\n        }\r\n        case 'play': {\r\n          cornerstoneTools.playClip(element, 30)\r\n          this.setState({inPlay: true})\r\n          break\r\n        }\r\n        case 'pause': {\r\n            cornerstoneTools.stopClip(element)\r\n            this.setState({inPlay: false})\r\n          break\r\n        }\r\n        case 'nextframe': {\r\n          if (this.state.frame < this.numberOfFrames) {\r\n            let frame = this.state.frame+1\r\n            this.setState({frame: frame})            \r\n            scrollToIndex(element, frame-1)\r\n          }\r\n          break  \r\n        }\r\n        case 'lastframe': {\r\n          let frame = this.numberOfFrames\r\n          this.setState({frame: frame})   \r\n          scrollToIndex(element, frame-1)      \r\n          break    \r\n        }                       \r\n        default:\r\n          break\r\n      }\r\n    }\r\n\r\n    reset = () => {\r\n      const element = this.dicomImage\r\n      const defaultViewport = cornerstone.getDefaultViewportForImage(element, this.image)\r\n      let viewport = cornerstone.getViewport(element)\r\n      viewport.voi.windowWidth = defaultViewport.voi.windowWidth\r\n      viewport.voi.windowCenter = defaultViewport.voi.windowCenter\r\n      viewport.invert = false\r\n      cornerstone.setViewport(element, viewport)\r\n    }\r\n\r\n    // MPR\r\n    //#region MPR\r\n\r\n    mprPlanePosition = () => {\r\n      try {\r\n        if (!this.isDicom) return this.mprPlane\r\n        const image = this.files[0].image\r\n        const imageOrientation = image.data.string('x00200037').split('\\\\')\r\n        let v = new Array(6).fill(0)\r\n        v[0] = parseFloat(imageOrientation[0]) // the x direction cosines of the first row X\r\n        v[1] = parseFloat(imageOrientation[1]) // the y direction cosines of the first row X\r\n        v[2] = parseFloat(imageOrientation[2]) // the z direction cosines of the first row X\r\n        v[3] = parseFloat(imageOrientation[3]) // the x direction cosines of the first column Y\r\n        v[4] = parseFloat(imageOrientation[4]) // the y direction cosines of the first column Y\r\n        v[5] = parseFloat(imageOrientation[5]) // the z direction cosines of the first column Y    \r\n        v = v.map((x) => Math.round(x))\r\n        let p = [v[1]*v[5] - v[2]*v[4], v[2]*v[3] - v[0]*v[5], v[0]*v[4] - v[1]*v[3]] // cross product of X x Y\r\n        p = p.map((x) => Math.abs(x))\r\n        if (p[0] === 1) {\r\n          this.mprPlane = 'sagittal'\r\n        } else if (p[1] === 1) {\r\n          this.mprPlane = 'coronal'\r\n        } else if (p[2] === 1) {\r\n          this.mprPlane = 'axial'\r\n        }\r\n      } catch(error) { // it's not possible to build MPR\r\n        this.mprPlane = ''\r\n      } \r\n      return this.mprPlane \r\n    }\r\n\r\n    transpose = (matrix) => {\r\n      return Object.keys(matrix[0]).map(colNumber => matrix.map(rowNumber => rowNumber[colNumber]));\r\n    }\r\n\r\n    mprRenderYZPlane = (filename, origin, x, mprData) => {\r\n      if (this.volume === null) return \r\n\r\n      this.mprData = mprData\r\n\r\n      const files = this.files === null ? this.props.files : this.files\r\n\r\n      this.sliceIndex = x\r\n      \r\n      this.filename = filename\r\n      cornerstone.disable(this.dicomImage)\r\n\r\n      if (origin === 'sagittal') \r\n        this.mprPlane = 'coronal'\r\n      else if (origin === 'axial') \r\n        this.mprPlane = 'sagittal'\r\n      else\r\n        this.mprPlane = 'sagittal'\r\n\r\n      this.xSize = files[0].columns\r\n      this.ySize = files[0].rows \r\n      this.zSize = mprData.zDim\r\n\r\n      const i = Math.round(x / this.xSize * files.length)\r\n      this.originImage = files[i].image\r\n\r\n      if (origin === 'sagittal') {\r\n        let xoffset = Math.floor(this.xSize / 2) - Math.floor(this.zSize / 2)\r\n        let plane = new Int16Array(this.xSize * this.ySize)\r\n        for (let y = 0; y < this.ySize; y++) \r\n          for (let z = 0; z < this.zSize; z++) \r\n            plane[z + this.ySize * y + xoffset] = this.volume[z][x + this.ySize * y]        \r\n        this.loadImageFromCustomObject(this.xSize, this.ySize, plane)\r\n\r\n      } else if (origin === 'coronal') {\r\n        let xoffset = Math.floor(this.xSize / 2) - Math.floor(this.zSize / 2)\r\n        let plane = new Int16Array(this.xSize * this.ySize)\r\n        for (let y = 0; y < this.ySize; y++) \r\n          for (let z = 0; z < this.zSize; z++) \r\n            plane[z + this.ySize * y + xoffset] = this.volume[z][x + this.ySize * y]        \r\n        this.loadImageFromCustomObject(this.xSize, this.ySize, plane)\r\n\r\n      } else { // axial\r\n        const yzPlane = this.mprBuildYZPlane(x)\r\n        this.loadImageFromCustomObject(this.ySize, this.zSize, yzPlane)\r\n      }\r\n    }\r\n\r\n    mprBuildYZPlane = (x) => {\r\n      let plane = new Int16Array(this.ySize * this.zSize)\r\n      for (var y = 0; y < this.ySize; y++) \r\n        for (var z = 0; z < this.zSize; z++) \r\n          plane[y + this.ySize * z] = this.volume[z][x + this.ySize * y]\r\n      return plane\r\n    }\r\n\r\n    mprRenderXZPlane = (filename, origin, y, mprData) => {\r\n      if (this.volume === null) return\r\n\r\n      this.mprData = mprData\r\n\r\n      const files = this.files === null ? this.props.files : this.files\r\n      \r\n      this.sliceIndex = y\r\n\r\n      this.filename = filename\r\n      cornerstone.disable(this.dicomImage)\r\n\r\n      if (origin === 'sagittal') \r\n        this.mprPlane = 'axial'\r\n      else if (origin === 'axial') \r\n        this.mprPlane = 'coronal'\r\n      else\r\n        this.mprPlane = 'axial'\r\n\r\n      this.xSize = files[0].columns\r\n      this.ySize = files[0].rows\r\n      this.zSize = mprData.zDim\r\n\r\n      const i = Math.trunc(y / this.ySize * files.length)\r\n      this.originImage = files[i].image\r\n\r\n      if (origin === 'sagittal') {\r\n        let xoffset = Math.floor(this.xSize / 2) - Math.floor(this.zSize / 2)\r\n        let plane = new Int16Array(this.xSize * this.ySize)\r\n        for (let x = 0; x < this.xSize; x++) \r\n          for (let z = 0; z < this.zSize; z++)\r\n            plane[z + this.xSize * x + xoffset] = this.volume[z][x + this.xSize * y] \r\n        this.loadImageFromCustomObject(this.xSize, this.ySize, plane)\r\n\r\n      } else {\r\n        const xzPlane = this.mprBuildXZPlane(y)\r\n        this.loadImageFromCustomObject(this.xSize, this.zSize, xzPlane)\r\n      }\r\n    }\r\n  \r\n    mprBuildXZPlane = (y) => {\r\n      let plane = new Int16Array(this.xSize * this.zSize)\r\n      for (let x = 0; x < this.xSize; x++) \r\n        for (let z = 0; z < this.zSize; z++)\r\n          plane[x + this.xSize * z] = this.volume[z][x + this.xSize * y]     \r\n      return plane\r\n    }  \r\n\r\n    mprIsOrthogonalView = () => {\r\n      return (this.mprPlane !== '' && this.props.layout[0] === 1 && this.props.layout[1] === 3)\r\n    }\r\n\r\n    mprReferenceLines = (index) => {\r\n      const fromPlane = this.props.activeDcm.mprPlane\r\n      const toPlane = this.mprPlane\r\n      const border = 3\r\n      const offset = this.mprData.instanceNumberOrder === 1 ? index * this.mprData.zStep : (this.mprData.indexMax - index) * this.mprData.zStep\r\n\r\n      this.mpr.sliceLocation = {}\r\n      if (fromPlane === 'axial') {\r\n        this.mpr.sliceLocation.p0 = new Point(border, offset)\r\n        this.mpr.sliceLocation.p1 = new Point(this.xSize-border, offset)\r\n      } else if (fromPlane === 'sagittal') {\r\n        const start = Math.round((this.xSize - this.zSize) / 2)\r\n        this.mpr.sliceLocation.p0 = new Point(start+offset, border)\r\n        this.mpr.sliceLocation.p1 = new Point(start+offset, this.ySize-border)\r\n      } else { // from coronal\r\n        if (toPlane === 'axial') {\r\n          this.mpr.sliceLocation.p0 = new Point(border, offset)\r\n          this.mpr.sliceLocation.p1 = new Point(this.xSize-border, offset)\r\n        } else { // to sagittal\r\n          const start = Math.round((this.xSize - this.zSize) / 2)\r\n          this.mpr.sliceLocation.p0 = new Point(start+offset, border)\r\n          this.mpr.sliceLocation.p1 = new Point(start+offset, this.ySize-border)       \r\n        }\r\n      }\r\n      this.mpr.isSliceLocation = true\r\n      this.updateImage()\r\n    }\r\n\r\n    mprReferenceLines2 = (index) => { // from second view to third view or from third view to second view\r\n      const fromPlane = this.props.activeDcm.mprPlane\r\n      const toPlane = this.mprPlane\r\n      const border = 3\r\n      const offset = this.mprData.instanceNumberOrder === 1 ?  index : index\r\n\r\n      this.mpr.sliceLocation = {}\r\n      if (fromPlane === 'axial') {\r\n        this.mpr.sliceLocation.p0 = new Point(border, offset)\r\n        this.mpr.sliceLocation.p1 = new Point(this.xSize-border, offset)\r\n      } else if (fromPlane === 'sagittal') {\r\n        this.mpr.sliceLocation.p0 = new Point(offset, border)\r\n        this.mpr.sliceLocation.p1 = new Point(offset, this.zSize-border)\r\n      } else { // from coronal\r\n        if (toPlane === 'axial') {\r\n          this.mpr.sliceLocation.p0 = new Point(border, offset)\r\n          this.mpr.sliceLocation.p1 = new Point(this.xSize-border, offset)\r\n        } else { // to sagittal\r\n          this.mpr.sliceLocation.p0 = new Point(offset, border)\r\n          this.mpr.sliceLocation.p1 = new Point(offset, this.zSize-border)      \r\n        }\r\n      }\r\n      this.mpr.isSliceLocation = true\r\n      this.updateImage()\r\n    }\r\n\r\n    mprReferenceLines3 = (index, mprData) => { // from second or third view to first view\r\n      const xSize = this.image.columns\r\n      const ySize = this.image.rows\r\n      const fromPlane = this.props.activeDcm.mprPlane\r\n      const toPlane = this.mprPlane\r\n      const offset = 3\r\n\r\n      this.mpr.sliceLocation = {}\r\n      if (fromPlane === 'axial') {\r\n        this.mpr.sliceLocation.p0 = new Point(offset, index)\r\n        this.mpr.sliceLocation.p1 = new Point(xSize-offset, index)\r\n      } else if (fromPlane === 'sagittal') {\r\n        this.mpr.sliceLocation.p0 = new Point(index, offset)\r\n        this.mpr.sliceLocation.p1 = new Point(index, ySize-offset)\r\n      } else { // from coronal\r\n        if (toPlane === 'axial') {\r\n          this.mpr.sliceLocation.p0 = new Point(offset, index)\r\n          this.mpr.sliceLocation.p1 = new Point(xSize-offset, index)\r\n        } else { // to sagittal\r\n          this.mpr.sliceLocation.p0 = new Point(index, offset)\r\n          this.mpr.sliceLocation.p1 = new Point(index, ySize-offset)      \r\n        }\r\n      }\r\n      this.mpr.isSliceLocation = true\r\n      this.updateImage()\r\n    }\r\n\r\n    mprSliceLocationDraw = () => {\r\n      const canvas = document.getElementById(`viewer-${this.props.index}`).getElementsByClassName('cornerstone-canvas')[0]\r\n      const ctx = canvas.getContext(\"2d\")\r\n      const p0 = this.mpr.sliceLocation.p0\r\n      const p1 = this.mpr.sliceLocation.p1\r\n      ctx.beginPath()\r\n      ctx.setLineDash([])\r\n      if (this.zoom < 150) ctx.lineWidth = 2\r\n      ctx.strokeStyle = 'rgba(255, 255, 51, 0.7)'\r\n      ctx.moveTo(p0.x, p0.y)\r\n      ctx.lineTo(p1.x, p1.y)\r\n      ctx.lineWidth = 1\r\n      ctx.stroke()\r\n    }\r\n\r\n\r\n    referenceLinesBuild = (srcImage) => {\r\n      \r\n      this.referenceLines.dst = new DicomGeometry(this.image)\r\n      this.referenceLines.src = new DicomGeometry(srcImage)\r\n\r\n      this.referenceLines.isReferenceLine = this.referenceLines.dst.orientation !== undefined &&\r\n      this.referenceLines.src.orientation !== undefined && \r\n      this.referenceLines.dst.orientation !== this.referenceLines.src.orientation\r\n\r\n      this.referenceLines.isScoutDraw = true\r\n\r\n      this.updateImage()\r\n\r\n    }\r\n\r\n    referenceLinesBuildLine = () => {\r\n      const dst = this.referenceLines.dst\r\n      const src = this.referenceLines.src\r\n\r\n      const nP = dst.nrmDir.dotProduct(dst.topLeft)\r\n      const nA = dst.nrmDir.dotProduct(src.topLeft)\r\n      const nB = dst.nrmDir.dotProduct(src.topRight)\r\n      const nC = dst.nrmDir.dotProduct(src.bottomRight)\r\n      const nD = dst.nrmDir.dotProduct(src.bottomLeft)\r\n\r\n      let list = []\r\n\r\n      if (!areEqual(nB, nA)) {\r\n        const t = (nP - nA) / (nB - nA)\r\n        if (t > 0 && t <= 1) \r\n          list.push(src.topLeft.add((src.topRight.sub(src.topLeft)).mul(t)))\r\n      }\r\n\r\n      if (!areEqual(nC, nB)) { \r\n        const t = (nP - nB) / (nC - nB)\r\n        if (t > 0 && t <= 1)\r\n          list.push(src.topRight.add((src.bottomRight.sub(src.topRight)).mul(t)))\r\n      }\r\n        \r\n      if (!areEqual(nD, nC)) { \r\n        const t = (nP - nC) / (nD - nC)\r\n        if (t > 0 && t <= 1)\r\n          list.push(src.bottomRight.add((src.bottomLeft.sub(src.bottomRight)).mul(t)))\r\n      }\r\n\r\n      if (!areEqual(nA, nD)) { \r\n        const t = (nP - nD) / (nA - nD)\r\n        if (t > 0 && t <= 1)\r\n          list.push(src.bottomLeft.add((src.topLeft.sub(src.bottomLeft)).mul(t)))\r\n      }\r\n\r\n      // the destinationplane should have been crossed exactly two times\r\n      if (list.length !== 2)\r\n        return \r\n\r\n      // now back from 3D patient space to 2D pixel space\r\n      const p = {\r\n        startPoint: this.transformDstPatientPointToImage(list[0]),\r\n        endPoint:   this.transformDstPatientPointToImage(list[1])\r\n      }\r\n      return p      \r\n    }\r\n\r\n    transformDstPatientPointToImage = (p) => {\r\n      const v = new Matrix(\r\n        [p.x], \r\n        [p.y], \r\n        [p.z], \r\n        [1]\r\n      )\r\n      const transformed = this.referenceLines.dst.transformRcsToImage.multiply(v)\r\n      // validation, if the point is within the image plane, then the z-component of the transformed point should be zero\r\n      const point = new Point(Math.round(transformed.get(0,0)), Math.round(transformed.get(1,0)))\r\n      return point\r\n    }\r\n\r\n    referenceLinesBuildPlane = () => {\r\n      const dst = this.referenceLines.dst \r\n      const src = this.referenceLines.src \r\n\r\n      let pos = []\r\n\r\n      // TLHC is what is in ImagePositionPatient\r\n      pos[0] = src.topLeft\r\n      // TRHC\r\n      pos[1] = src.topLeft.add(src.rowDir.mul(src.lengthX))\r\n      // BRHC\r\n      pos[2] = src.topLeft.add((src.rowDir.mul(src.lengthX)).add(src.colDir.mul(src.lengthY)))\r\n      // BLHC\r\n      pos[3] = src.topLeft.add(src.colDir.mul(src.lengthY))\r\n\r\n      let pixel = []\r\n\r\n      let rotation = new Matrix(\r\n        dst.rowDir.toArray(),\r\n        dst.colDir.toArray(),\r\n        dst.nrmDir.toArray()\r\n      )\r\n\r\n      for (let i = 0; i < 4; i++) {            \r\n          // move everything to origin of target\r\n          pos[i] = pos[i].add(Point.zero.sub(dst.topLeft))\r\n\r\n          // The rotation is easy ... just rotate by the row, col and normal vectors ...\r\n          const m = rotation.multiply(pos[i].toMatrix())\r\n          pos[i] = new Point(Math.round(m.get(0,0)), Math.round(m.get(1,0)), Math.round(m.get(2,0))) \r\n\r\n          // DICOM coordinates are center of pixel 1\\1\r\n          pixel[i] = new Point(Math.trunc(pos[i].x / dst.spacingY + 0.5), Math.trunc(pos[i].y / dst.spacingX + 0.5))\r\n      }         \r\n\r\n      return pixel\r\n    }\r\n\r\n    referenceLinesDraw = () => {\r\n      if (!this.referenceLines.isReferenceLine) return\r\n\r\n      const canvas = document.getElementById(`viewer-${this.props.index}`).getElementsByClassName('cornerstone-canvas')[0]\r\n      const ctxH = canvas.getContext(\"2d\")\r\n\r\n      this.referenceLines.plane = this.referenceLinesBuildPlane()\r\n\r\n      this.referenceLines.line = this.referenceLinesBuildLine()\r\n\r\n      const line = this.referenceLines.line\r\n      \r\n      ctxH.beginPath()\r\n      ctxH.setLineDash([])\r\n      ctxH.strokeStyle = 'rgba(255, 255, 51, 0.5)'\r\n      ctxH.moveTo(line.startPoint.x, line.startPoint.y)\r\n      ctxH.lineTo(line.endPoint.x, line.endPoint.y)\r\n      ctxH.lineWidth = 1\r\n      ctxH.stroke()\r\n\r\n      const plane = this.referenceLines.plane\r\n\r\n      const d = Math.max(this.referenceLines.dst.rows, this.referenceLines.dst.cols) / 30\r\n\r\n      const line0 = new Line(plane[0], plane[1])\r\n      const line1 = new Line(plane[1], plane[2])\r\n      const line2 = new Line(plane[2], plane[3])\r\n      const line3 = new Line(plane[3], plane[0])\r\n\r\n      if (Math.min(line0.distance(line2), line1.distance(line3)) < d) return\r\n\r\n      ctxH.beginPath()\r\n      ctxH.setLineDash([3, 3])\r\n      ctxH.strokeStyle = 'rgba(135, 206, 250, 0.5)'\r\n      ctxH.moveTo(plane[0].x, plane[0].y)\r\n      ctxH.lineTo(plane[1].x, plane[1].y)\r\n      ctxH.lineTo(plane[2].x, plane[2].y)\r\n      ctxH.lineTo(plane[3].x, plane[3].y)\r\n      ctxH.lineTo(plane[0].x, plane[0].y)\r\n      ctxH.lineWidth = 1\r\n      ctxH.stroke()\r\n    }\r\n    \r\n    //#endregion\r\n\r\n\r\n    dicomImageRef = el => {\r\n      this.dicomImage = el\r\n    }\r\n\r\n    onImageClick = () => {\r\n    }\r\n\r\n    isLocalizer = () => {\r\n      return isLocalizer(this.image)\r\n    }\r\n\r\n    findFirstSliceWithIppValue = (ippValue, ippPos) => {\r\n      const increasing = this.files[0].sliceDistance - this.files[this.files.length-1].sliceDistance < 0\r\n      for(let i=0; i < this.files.length; i++) {\r\n        const ipp = getDicomIpp(this.files[i].image, ippPos)\r\n        if (increasing) {\r\n          if (ipp >= ippValue) return i          \r\n        } else {\r\n          if (ipp <= ippValue) return i          \r\n        }\r\n      }\r\n      return -1\r\n    }\r\n\r\n    render() {\r\n\r\n      const visible = this.props.visible ? 'visible' : 'hidden'\r\n      const isOpen = this.props.isOpen[this.props.index]\r\n      const visibleOpenUrlDlg = this.state.visibleOpenUrlDlg\r\n      const errorOnOpenImage = this.state.errorOnOpenImage\r\n      const progress = this.state.progress\r\n\r\n      const styleContainer = {\r\n        width: '100%', \r\n        height: '100%', \r\n        border: (this.props.activeDcmIndex === this.props.index && (this.props.layout[0] > 1 || this.props.layout[1] > 1)) ? 'solid 1px #AAAAAA' : null,\r\n        position: 'relative',\r\n      }\r\n\r\n      const styleDicomImage = {\r\n        width: '100%', \r\n        height: '100%', \r\n        position: 'relative',\r\n      }\r\n\r\n      const overlay = getSettingsOverlay() && this.props.overlay\r\n\r\n      return ( \r\n        <div className=\"container\" style={styleContainer} >\r\n\r\n          {visibleOpenUrlDlg ? <OpenUrlDlg progress={progress} onClose={this.hideOpenUrlDlg} /> : null}\r\n\r\n          <Dialog\r\n            open={errorOnOpenImage !== null}\r\n            onClose={this.onErrorOpenImageClose}\r\n          >\r\n            <DialogTitle id=\"alert-dialog-title\">{\"Error on opening image\"}</DialogTitle>\r\n            <DialogContent>\r\n              <DialogContentText id=\"alert-dialog-description\">\r\n                {this.state.errorOnOpenImage}\r\n              </DialogContentText>\r\n            </DialogContent>\r\n            <DialogActions>\r\n              <Button onClick={this.onErrorOpenImageClose} autoFocus>\r\n                Ok\r\n              </Button>\r\n            </DialogActions>\r\n          </Dialog>\r\n\r\n          {/* <Dialog\r\n            open={this.state.errorOnCors}\r\n            onClose={this.onErrorCorsClose}\r\n            aria-labelledby=\"alert-dialog-title\"\r\n            aria-describedby=\"alert-dialog-description\"\r\n          >\r\n            <DialogTitle id=\"alert-dialog-title\">{\"Error on loading image\"}</DialogTitle>\r\n            <DialogContent>\r\n              <DialogContentText id=\"alert-dialog-description\">\r\n                <Typography gutterBottom>\r\n                  CORS or Cross Origin Resource Sharing is a browser security policy \r\n                  that prevents javascript from loading data from a server with a different base URL \r\n                  than the server that served up the javascript file. \r\n                </Typography> \r\n                <Typography gutterBottom>\r\n                  See the &nbsp; \r\n                  <Link href=\"http://enable-cors.org/\" target='_blank' color='textPrimary'>\r\n                    Enable CORS site\r\n                  </Link>\r\n                  &nbsp; for information about CORS.                     \r\n                </Typography>                                \r\n              </DialogContentText>\r\n            </DialogContent>\r\n            <DialogActions>\r\n              <Button onClick={this.onErrorCorsClose} autoFocus>\r\n                Ok\r\n              </Button>\r\n            </DialogActions>\r\n          </Dialog> */}\r\n\r\n          <div\r\n            style={{\r\n              width: '100%', \r\n              height: '100%', \r\n              position: \"relative\",\r\n              color:  '#FFFFFF',\r\n              fontSize: '1.00em',\r\n              textShadow: '1px 1px #000000',\r\n              visibility: visible\r\n            }}\r\n            onContextMenu={() => false}\r\n            className=\"cornerstone-enabled-image\"\r\n          >\r\n\r\n            <div \r\n              id={`viewer-${this.props.index}`}\r\n              ref={this.dicomImageRef} style={styleDicomImage}\r\n            >\r\n            </div>\r\n\r\n            <div\r\n              id={`mrtopleft-${this.props.index}`}\r\n              style={{ position: \"absolute\", top: 0, left: 3, display: isOpen && overlay ? \"\" : \"none\" }}\r\n            >\r\n             \r\n            </div>\r\n            <div\r\n              id={`mrtopright-${this.props.index}`}\r\n              style={{ position: \"absolute\", top: 0, right: 3, display: isOpen && overlay ? \"\" : \"none\" }}\r\n            >\r\n              \r\n            </div>\r\n            <div\r\n              id={`mrbottomright-${this.props.index}`}\r\n              style={{ position: \"absolute\", bottom: 0, right: 3, display: isOpen && overlay ? \"\" : \"none\" }}\r\n            >\r\n              \r\n            </div>\r\n            <div\r\n              id={`mrbottomleft-${this.props.index}`}\r\n              style={{ position: \"absolute\", bottom: 0, left: 3, display: isOpen && overlay ? \"\" : \"none\" }}\r\n            >\r\n              \r\n            </div>   \r\n\r\n            <div\r\n              id={`mrtopcenter-${this.props.index}`}\r\n              style={{ position: \"absolute\", top: 0, width: '60px', left: '50%', marginLeft: '0px', display: isOpen && overlay ? \"\" : \"none\" }}\r\n            >\r\n              \r\n            </div>\r\n\r\n            <div\r\n              id={`mrleftcenter-${this.props.index}`}\r\n              style={{ position: \"absolute\", top: '50%', width: '30px', left: 3, marginLeft: '0px', display: isOpen && overlay ? \"\" : \"none\" }}\r\n            >\r\n              \r\n            </div>    \r\n\r\n            <div\r\n              id={`mrrightcenter-${this.props.index}`}\r\n              style={{ position: \"absolute\", top: '50%', width: '30px', right: 3, marginRight: '-20px', display: isOpen && overlay ? \"\" : \"none\" }}\r\n            >\r\n              \r\n            </div>                \r\n\r\n            <div\r\n              id={`mrbottomcenter-${this.props.index}`}\r\n              style={{ position: \"absolute\", bottom: 0, width: '60px', left: '50%', marginLeft: '0px', display: isOpen && overlay ? \"\" : \"none\" }}\r\n            >\r\n              \r\n            </div>\r\n\r\n            { this.state.visibleCinePlayer && this.numberOfFrames > 1 ? (\r\n              <div style={{position:\"absolute\", width:'100%', bottom:0, textAlign:'center'}}>\r\n                <div style={{margin:'0 auto', width:'240px', backgroundColor:'rgba(136, 136, 136, 0.5)'}}>\r\n                  <CinePlayer runCinePlayer={this.runCinePlayer} inPlay={this.state.inPlay} />  \r\n                  <div \r\n                    id={`frameLabel-${this.props.index}`}\r\n                    style={{ width:230, margin:'0 auto', marginTop:-10, textAlign:\"center\" }}\r\n                  >\r\n                    {this.state.frame} / {this.numberOfFrames}\r\n                  </div> \r\n                </div>               \r\n              </div> \r\n              ) : null\r\n            }\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n  }\r\n  \r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    files: state.files,\r\n    series: state.series,\r\n    url: state.url,\r\n    isOpen: state.isOpen,\r\n    tool: state.tool,\r\n    activeDcmIndex: state.activeDcmIndex,\r\n    activeDcm: state.activeDcm,\r\n    explorerActiveSeriesIndex: state.explorerActiveSeriesIndex,\r\n    measurements: state.measurements,\r\n    layout: state.layout,\r\n    fsCurrentDir: state.fsCurrentDir,\r\n    fsCurrentList: state.fsCurrentList,\r\n    volume: state.volume,\r\n    dcmEnableTool: state.dcmEnableTool,\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    clearingStore: () => dispatch(clearStore()),\r\n    setIsOpenStore: (value) => dispatch(dcmIsOpen(value)),\r\n    toolStore: (tool) => dispatch(dcmTool(tool)),\r\n    setActiveDcm: (dcm) => dispatch(activeDcm(dcm)),\r\n    setActiveMeasurements: (measurements) => dispatch(activeMeasurements(measurements)),\r\n    makeFsRefresh: (dcm) => dispatch(doFsRefresh()),\r\n    setDcmEnableToolStore: (value) => dispatch(setDcmEnableTool(value))\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(DicomViewer)\r\n","import React from 'react'\r\nimport List from '@material-ui/core/List'\r\nimport ListItem from '@material-ui/core/ListItem'\r\nimport ListItemText from '@material-ui/core/ListItemText'\r\nimport Toolbar from '@material-ui/core/Toolbar'\r\nimport Typography from '@material-ui/core/Typography'\r\nimport Icon from '@mdi/react'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport { SETTINGS_DCMHEADER } from '../constants/settings'\r\nimport { toCsv } from '../functions'\r\nimport 'react-perfect-scrollbar/dist/css/styles.css'\r\nimport PerfectScrollbar from 'react-perfect-scrollbar'\r\nimport {\r\n    mdiContentSaveOutline\r\n} from '@mdi/js'\r\n\r\nconst DicomHeader = ({dcmViewer, classes, color}) => {\r\n    let header = []\r\n    header.push({name: 'Transfer Syntax', value: dcmViewer.getTransferSyntax()})\r\n    header.push({name: 'SOP Class', value: dcmViewer.getSopClass()})\r\n    header.push({name: 'SOP Instance UID', value: dcmViewer.getSopInstanceUID()})\r\n    header.push({name: 'Modality', value: dcmViewer.image.data.string('x00080060')})\r\n    header.push({name: 'Manufacturer', value: dcmViewer.image.data.string('x00080070')})\r\n    header.push({name: 'Study Description', value: dcmViewer.image.data.string('x00081030')})\r\n    header.push({name: 'Series Description', value: dcmViewer.image.data.string('x0008103E')})\r\n    header.push({name: 'Patient Name', value: dcmViewer.image.data.string('x00100010')})\r\n    header.push({name: 'Frame Rate', value: dcmViewer.image.data.string('x00082144')})\r\n\r\n    header.push({name: 'MR Acquisition Type', value: dcmViewer.image.data.string('x00180023')})\r\n    header.push({name: 'Slice Thickness', value: dcmViewer.image.data.string('x00180050')})\r\n    header.push({name: 'Spacing Between Slice', value: dcmViewer.image.data.string('x00180088')})\r\n    header.push({name: 'Patient Position', value: dcmViewer.image.data.string('x00185100')})\r\n\r\n    header.push({name: 'Study ID', value: dcmViewer.image.data.string('x00200010')})\r\n    header.push({name: 'Series Number', value: dcmViewer.image.data.string('x00200011')})\r\n    header.push({name: 'Acquisition Number', value: dcmViewer.image.data.string('x00200012')})\r\n    header.push({name: 'Instance Number', value: dcmViewer.image.data.string('x00200013')})\r\n    header.push({name: 'Image Position (Patient)', value: dcmViewer.image.data.string('x00200032')})\r\n    header.push({name: 'Image Orientation (Patient)', value: dcmViewer.image.data.string('x00200037')})\r\n    header.push({name: 'Images in Acquisition', value: dcmViewer.image.data.string('x00201002')}) \r\n    header.push({name: 'Slice Location', value: dcmViewer.image.data.string('x00201041')})        \r\n\r\n    header.push({name: 'Samples per Pixel', value: dcmViewer.image.data.uint16('x00280002')})\r\n    header.push({name: 'Photometric Interpretation', value: dcmViewer.image.data.string('x00280004')})\r\n    header.push({name: 'Number of Frames', value: dcmViewer.image.data.string('x00280008')})\r\n    header.push({name: 'Planar Configuration', value: dcmViewer.getPlanarConfiguration()})\r\n    header.push({name: 'Rows', value: dcmViewer.image.data.uint16('x00280010')})\r\n    header.push({name: 'Columns', value: dcmViewer.image.data.uint16('x00280011')})\r\n    header.push({name: 'Pixel Spacing', value: dcmViewer.image.data.string('x00280030')})\r\n    header.push({name: 'Bits Allocated', value: dcmViewer.image.data.uint16('x00280100')})\r\n    header.push({name: 'Bits Stored', value: dcmViewer.image.data.uint16('x00280101')})\r\n    header.push({name: 'High Bit', value: dcmViewer.image.data.uint16('x00280102')})\r\n    header.push({name: 'Pixel Representation', value: dcmViewer.getPixelRepresentation()})\r\n    header.push({name: 'Window Center', value: dcmViewer.image.data.string('x00281050')})\r\n    header.push({name: 'Window Width', value: dcmViewer.image.data.string('x00281051')})\r\n    header.push({name: 'Rescale Intercept', value: dcmViewer.image.data.string('x00281052')})\r\n    header.push({name: 'Rescale Slope', value: dcmViewer.image.data.string('x00281053')})\r\n    header.push({name: 'Min Stored Pixel Value', value: dcmViewer.image.minPixelValue})\r\n    header.push({name: 'Max Stored Pixel Value', value: dcmViewer.image.maxPixelValue})\r\n\r\n    header.push({name: 'Image Orientation', value: dcmViewer.image.data.string('x00700042')})\r\n    header.push({name: 'Image Horizontal Flip', value: dcmViewer.image.data.string('x00700041')})\r\n\r\n    const listItems = header.map((item, index) => {\r\n        if (item.value !== undefined) \r\n            return (\r\n                <ListItem dense={true} key={index}>\r\n                    <ListItemText primary={item.name} secondary={item.value} />\r\n                </ListItem>\r\n            ) \r\n        else return null\r\n    })\r\n\r\n    const saveHeader = () => {\r\n        let exportAs = localStorage.getItem(SETTINGS_DCMHEADER)\r\n        if (exportAs === null) {\r\n          exportAs = \"json\"\r\n          localStorage.setItem(SETTINGS_DCMHEADER, exportAs)\r\n        }  \r\n    \r\n        let fileData = ''\r\n        \r\n        if (exportAs === 'csv') {\r\n          fileData = toCsv(header)\r\n        } else {\r\n          const obj = header.reduce((o, item) => ({ ...o, [item.name]: item.value}), {})\r\n          fileData = JSON.stringify(obj)\r\n        }\r\n        \r\n        const element = document.createElement(\"a\")\r\n        const file = new Blob([fileData], {type: 'text/plain'})\r\n        element.href = URL.createObjectURL(file)\r\n        element.download = `${dcmViewer.localfile.name}.${exportAs}`\r\n        document.body.appendChild(element) // Required for this to work in FireFox\r\n        element.click()\r\n    }\r\n\r\n    console.log('dcmViewer', dcmViewer)\r\n\r\n    return (\r\n      <PerfectScrollbar>\r\n        <div style={{marginTop: '48px'}}>\r\n          <Toolbar variant=\"dense\">\r\n            <Typography variant=\"subtitle1\" className={classes.title}>\r\n              Dicom Header\r\n            </Typography>\r\n            <div className={classes.grow} />\r\n            <IconButton color=\"inherit\" onClick={saveHeader}>\r\n              <Icon path={mdiContentSaveOutline} size={'1.2rem'} color={color} />\r\n            </IconButton>\r\n          </Toolbar>    \r\n          <div>          \r\n            <List dense={true} component=\"div\">\r\n                {listItems}             \r\n            </List>\r\n          </div>      \r\n        </div>\r\n      </PerfectScrollbar>\r\n    )\r\n}\r\n  \r\nexport default DicomHeader\r\n","import React, { PureComponent } from 'react'\r\nimport {connect} from 'react-redux'\r\nimport axios from 'axios'\r\nimport Button from '@material-ui/core/Button'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport DialogContent from '@material-ui/core/DialogContent'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport LinearProgress from '@material-ui/core/LinearProgress'\r\nimport {\r\n  setZippedFile,\r\n} from '../actions/index'\r\n\r\nconst CancelToken = axios.CancelToken\r\nconst source = CancelToken.source()\r\n\r\nclass DownloadZipDlg extends PureComponent {\r\n\r\n  state = {\r\n    loading: 0\r\n  }\r\n\r\n  componentDidMount(previousProps) {\r\n    this.requestDownloadZip()\r\n  }\r\n\r\n  hide = () => {\r\n    this.props.onClose()\r\n  }\r\n\r\n  cancel = () => {\r\n    source.cancel('Operation canceled by the user.')\r\n    this.hide()\r\n  }\r\n\r\n  requestDownloadZip = () => {\r\n    console.log('this.props.url', this.props.url)\r\n    this.setState({loading: 0})\r\n    axios({\r\n      method: 'get',\r\n      url: this.props.url,\r\n      responseType: 'arraybuffer',\r\n      cancelToken: source.token,\r\n      onDownloadProgress: (progressEvent) => {\r\n        const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total)\r\n        this.setState({ loading: percentCompleted })\r\n        console.log('loading: ', percentCompleted)\r\n      },\r\n    }).then((response) => {\r\n        console.log('response: ', response)\r\n        this.props.setFsZippedFile(response.data)\r\n        this.hide()\r\n    }).catch((error) => {\r\n      console.log('error: ', error)\r\n    })\r\n  }\r\n  \r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <Dialog\r\n            open={true}\r\n            onClose={this.hide}\r\n        >\r\n            <DialogTitle>{\"Downloading zip archive...\"}</DialogTitle>\r\n            <DialogContent>\r\n              <LinearProgress variant=\"determinate\" value={this.state.loading} color='secondary' />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={this.cancel}>\r\n                    Cancel\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    setFsZippedFile: (file) => dispatch(setZippedFile(file))\r\n  }\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(DownloadZipDlg)\r\n","import React from \"react\"\r\nimport {connect} from 'react-redux'\r\nimport Button from '@material-ui/core/Button'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport DialogContent from '@material-ui/core/DialogContent'\r\nimport DialogContentText from '@material-ui/core/DialogContentText'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport Link from '@material-ui/core/Link'\r\nimport Typography from '@material-ui/core/Typography'\r\nimport * as cornerstone from \"cornerstone-core\"\r\nimport * as cornerstoneFileImageLoader from \"cornerstone-file-image-loader\"\r\nimport * as cornerstoneWADOImageLoader from \"cornerstone-wado-image-loader\"\r\nimport {uids} from '../constants/uids'\r\nimport OpenUrlDlg from './OpenUrlDlg'\r\n\r\nimport {\r\n  clearStore, \r\n  dcmIsOpen, \r\n  activeDcm, \r\n  dcmTool, \r\n  activeMeasurements,\r\n  doFsRefresh,\r\n  setDcmEnableTool,\r\n} from '../actions'\r\n\r\nimport {\r\n  isFileImage,\r\n  isFsFileImage,\r\n  isUrlImage,\r\n} from '../functions'\r\n\r\nclass DicomPreviewer extends React.Component {\r\n    constructor(props) {\r\n      super(props)\r\n      this.files = null\r\n      this.filename = ''\r\n      this.localfile = null\r\n      this.localurl = null\r\n      this.fsItem = null\r\n      this.dicomImage = null\r\n      this.explorerIndex = 0\r\n      this.imageId = null\r\n      this.image = null\r\n      this.isDicom = false\r\n      this.numberOfFrames = 1\r\n      this.measurements = []\r\n      this.originImage = null\r\n      this.mprPlane = ''\r\n      this.sliceMax = 0\r\n      this.sliceIndex = 0\r\n      this.shouldScroll = false\r\n    }\r\n\r\n    state = {\r\n      visibleOpenUrlDlg: false,\r\n      progress: null,\r\n      visibleCinePlayer: false,\r\n      errorOnOpenImage: null,\r\n      errorOnCors: false,\r\n      frame: 1,\r\n      inPlay: false,\r\n      viewport: null,\r\n    }\r\n\r\n    componentDidMount() {\r\n      this.props.runTool(this)\r\n      const { dcmRef } = this.props\r\n      dcmRef(this)          \r\n    }\r\n\r\n    componentWillUnmount() {\r\n      this.props.runTool(undefined)\r\n      const { dcmRef } = this.props\r\n      dcmRef(undefined)            \r\n    }\r\n\r\n    componentDidUpdate(previousProps) {\r\n    }\r\n\r\n    onOpenUrl = (e) => {\r\n      const eventData = e.detail\r\n      this.setState({ progress: eventData.percentComplete })\r\n    }\r\n\r\n    showOpenUrlDlg = (url) => {\r\n      this.setState({ visibleOpenUrlDlg: true }, () => {\r\n        cornerstone.events.addEventListener('cornerstoneimageloadprogress', this.onOpenUrl)\r\n        this.loadImage(undefined, url)\r\n      })\r\n    }\r\n  \r\n    hideOpenUrlDlg = () => {\r\n      this.setState({ visibleOpenUrlDlg: false, progress: null })\r\n    }\r\n\r\n    measurementSave = (measure) => {\r\n      this.measurements.push(measure) \r\n    }\r\n\r\n    measurementClear = () => {\r\n      this.measurements.splice(0, this.measurements.length)\r\n    }\r\n\r\n    measurementRemove = (index) => {\r\n      this.measurements.splice(index, 1)\r\n    }    \r\n\r\n    getTransferSyntax = () => {\r\n      const value = this.image.data.string('x00020010')\r\n      return value + ' [' + uids[value] + ']'\r\n    }\r\n\r\n    getSopClass = () => {\r\n      const value = this.image.data.string('x00080016')\r\n      return value + ' [' + uids[value] + ']'\r\n    }\r\n\r\n    getSopInstanceUID = () => {\r\n      const value = this.image.data.string('x00080018')\r\n      return value\r\n    }\r\n\r\n    getPixelRepresentation = () => {\r\n      const value = this.image.data.uint16('x00280103')\r\n      if (value === undefined) return\r\n      return value + (value === 0 ? ' (unsigned)' : ' (signed)')\r\n    }\r\n\r\n    getPlanarConfiguration = () => {\r\n      const value = this.image.data.uint16('x00280006')\r\n      if (value === undefined) return \r\n      return value + (value === 0 ? ' (pixel)' : ' (plane)')\r\n    }\r\n\r\n    getDicomViewerElement = () => {\r\n      return document.getElementsByClassName('cornerstone-enabled-image')\r\n    }\r\n   \r\n    onImageLoaded = (e) => {\r\n    }\r\n\r\n    // Listen for changes to the viewport so we can update the text overlays in the corner\r\n    onImageRendered = (e) => {\r\n      if (this.isDicom && this.state.visibleCinePlayer && this.numberOfFrames > 1) {\r\n        document.getElementById(\r\n          `frameLabel-${this.props.index}`\r\n        ).textContent = `${this.state.frame} / ${this.numberOfFrames}`\r\n        if (this.state.inPlay) {\r\n          let frame = this.state.frame === this.numberOfFrames ? 1 : this.state.frame+1\r\n          this.setState({frame: frame})\r\n        }\r\n      }\r\n    }\r\n\r\n    onErrorOpenImageClose = () => {\r\n      this.setState({errorOnOpenImage: null})\r\n    }\r\n\r\n    onErrorCorsClose = () => {\r\n      this.setState({errorOnCors: false})\r\n    }    \r\n\r\n    updateImage = () => {\r\n      const element = this.dicomImage\r\n      cornerstone.updateImage(element)\r\n    }\r\n\r\n    displayImageFromFiles = (index) => {\r\n\r\n      const files = this.files === null ? this.props.files : this.files\r\n\r\n      const image = files[index].image\r\n      const imageId = files[index].imageId\r\n      this.filename = files[index].name\r\n\r\n      const element = this.dicomImage\r\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage)\r\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered)\r\n      cornerstone.enable(element)\r\n\r\n      this.image = image\r\n\r\n      this.isDicom = true\r\n      \r\n      this.PatientsName = image.data.string('x00100010')\r\n      this.sopInstanceUid = this.getSopInstanceUID()\r\n\r\n      let stack = { currentImageIdIndex: 0, imageIds: \"\" }\r\n      this.numberOfFrames = image.data.intString('x00280008')\r\n      if (this.numberOfFrames > 0) {\r\n        let imageIds = []\t\r\n        for(var i=0; i < this.numberOfFrames; ++i) {\r\n          imageIds.push(imageId + \"?frame=\"+i)\r\n        }\t\r\n        stack.imageIds = imageIds\r\n      }\r\n\r\n      cornerstone.displayImage(element, image)\r\n \r\n    }\r\n\r\n    loadImage = (localfile, url=undefined, fsItem=undefined) => {\r\n\r\n      if (localfile === undefined && url === undefined && fsItem === undefined) return\r\n      \r\n      if (fsItem !== undefined) {\r\n        this.fsItem = fsItem\r\n      } else if (localfile !== undefined) {\r\n        this.localfile = localfile\r\n      } else {\r\n        this.localurl = url\r\n      }\r\n \r\n      const element = this.dicomImage\r\n\r\n      element.addEventListener(\"cornerstonenewimage\", this.onNewImage)\r\n      element.addEventListener(\"cornerstoneimagerendered\", this.onImageRendered)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementadded\", this.onMeasurementAdded)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementmodified\", this.onMeasurementModified)\r\n      element.addEventListener(\"cornerstonetoolsmeasurementcompleted\", this.onMeasurementCompleted)\r\n\r\n      let imageId = undefined\r\n\r\n      cornerstone.enable(element)\r\n\r\n      if (localfile === undefined && isUrlImage(url)) { // check if it's a simple image [jpeg or png] from url\r\n\r\n        cornerstone.loadImage(url).then(image => {\r\n          this.hideOpenUrlDlg()\r\n\r\n          this.image = image\r\n\r\n          this.isDicom = false\r\n\r\n          cornerstone.displayImage(element, image)\r\n          \r\n          this.enableTool()\r\n\r\n          this.props.setActiveDcm({image: this.image, element: this.dicomImage, isDicom: this.isDicom})\r\n          this.props.isOpenStore(true)\r\n\r\n        }, (e) => {\r\n          console.log('error', e)\r\n          this.setState({errorOnOpenImage: \"This is not a valid JPG or PNG file.\"})\r\n        })\r\n\r\n      } else if ((localfile !== undefined && isFileImage(localfile)) || (fsItem !== undefined && isFsFileImage(fsItem))) { // otherwise try to open as local image file (JPEG, PNG) \r\n        if (fsItem !== undefined) {\r\n          imageId = cornerstoneFileImageLoader.fileManager.addBuffer(fsItem.data)\r\n        } else {\r\n          imageId = cornerstoneFileImageLoader.fileManager.add(localfile)\r\n        }\r\n        cornerstone.loadImage(imageId).then(image => {\r\n          console.log('loadImage, image from local: ', image)\r\n\r\n          this.image = image\r\n          this.isDicom = false\r\n          this.PatientsName = ''\r\n\r\n          cornerstone.displayImage(element, image)\r\n          \r\n          this.enableTool()\r\n\r\n          this.props.setActiveDcm({image: this.image, element: this.dicomImage, isDicom: this.isDicom})\r\n\r\n          this.props.setIsOpenStore({index: this.props.index, value: true})\r\n\r\n        }, (e) => {\r\n          console.log('error', e)\r\n          this.setState({errorOnOpenImage: \"This is not a valid JPG or PNG file.\"})\r\n        })\r\n\r\n      } else { // otherwise try to open as Dicom file\r\n\r\n        if (fsItem !== undefined) {\r\n          imageId = cornerstoneWADOImageLoader.wadouri.fileManager.addBuffer(fsItem.data)\r\n          this.filename = fsItem.name\r\n          //size = fsItem.size\r\n        } else if (localfile !== undefined) {\r\n          imageId = cornerstoneWADOImageLoader.wadouri.fileManager.add(localfile)\r\n          this.filename = localfile.name\r\n          //size = localfile.size\r\n        } else { // it's a web dicom image\r\n          imageId = \"wadouri:\"+url\r\n        }\r\n\r\n        cornerstone.loadAndCacheImage(imageId).then(image => {\r\n          \r\n          this.hideOpenUrlDlg()\r\n\r\n          this.image = image\r\n\r\n          this.isDicom = true\r\n\r\n          this.PatientsName = image.data.string('x00100010')\r\n          this.sopInstanceUid = this.getSopInstanceUID()\r\n\r\n          let stack = { currentImageIdIndex: 0, imageIds: \"\" }\r\n          this.numberOfFrames = image.data.intString('x00280008')\r\n          if (this.numberOfFrames > 0) {\r\n            let imageIds = []\t\r\n            for(var i=0; i < this.numberOfFrames; ++i) {\r\n              imageIds.push(imageId + \"?frame=\"+i)\r\n            }\t\r\n            stack.imageIds = imageIds\r\n          }\r\n\r\n          cornerstone.displayImage(element, image)\r\n\r\n          this.enableTool()\r\n\r\n        }, (e) => {\r\n          console.log('error', e)   \r\n          this.hideOpenUrlDlg()      \r\n          const error = e.error.toString()\r\n          if (error === '[object XMLHttpRequest]') {\r\n            this.setState({errorOnCors: true})\r\n          } else {\r\n            const pos = error.indexOf(\":\")\r\n            this.setState({errorOnOpenImage: pos < 0 ? e.error : error.substring(pos+1)})            \r\n          } \r\n        })\r\n      }\r\n    }\r\n\r\n    runTool = (toolName, opt) => {\r\n      if (this.state.inPlay) {\r\n        this.runCinePlayer('pause')\r\n      }\r\n      switch (toolName) {\r\n        case 'setfiles': {\r\n          this.files = opt\r\n          this.sliceMax = this.files.length\r\n          this.shouldScroll = this.files.length > 1\r\n          break   \r\n        }        \r\n        case 'openimage': {\r\n          cornerstone.disable(this.dicomImage)\r\n          this.sliceIndex = opt\r\n          this.displayImageFromFiles(opt)\r\n          break   \r\n        }\r\n\r\n        case 'reset': {\r\n          this.reset()\r\n          break\r\n        }\r\n\r\n        case 'clear': {\r\n          this.files = null\r\n          cornerstone.disable(this.dicomImage)\r\n          break\r\n        }  \r\n  \r\n        default: {\r\n          break\r\n        }\r\n      }\r\n    } \r\n\r\n    reset = () => {\r\n      const element = this.dicomImage\r\n      const defaultViewport = cornerstone.getDefaultViewportForImage(element, this.image)\r\n      let viewport = cornerstone.getViewport(element)\r\n      viewport.voi.windowWidth = defaultViewport.voi.windowWidth\r\n      viewport.voi.windowCenter = defaultViewport.voi.windowCenter\r\n      viewport.invert = false\r\n      cornerstone.setViewport(element, viewport)\r\n    }\r\n\r\n    dicomImageRef = el => {\r\n      this.dicomImage = el\r\n    }\r\n\r\n    onImageClick = () => {\r\n    }\r\n\r\n    getSeriesNumber = () => {\r\n      if (this.props.series === undefined || this.props.series === null) return     \r\n      return this.props.series.seriesList.get(this.props.series.seriesKeys[this.props.index])[this.props.index].series.seriesNumber\r\n    }\r\n\r\n    getSeriesLength = () => {\r\n      if (this.props.series === undefined || this.props.series === null) return     \r\n      return this.props.series.seriesList.get(this.props.series.seriesKeys[this.props.index]).length\r\n    }\r\n\r\n    getSeriesDescription = () => {\r\n      if (this.props.series === undefined || this.props.series === null) return\r\n      if (this.props.series.seriesList.get(this.props.series.seriesKeys[this.props.index])[this.props.index] === undefined) return\r\n      return this.props.series.seriesList.get(this.props.series.seriesKeys[this.props.index])[this.props.index].series.seriesDescription\r\n    }\r\n\r\n    render() {\r\n\r\n      const visible = this.props.visible ? 'visible' : 'hidden'\r\n      const visibleOpenUrlDlg = this.state.visibleOpenUrlDlg\r\n      const errorOnOpenImage = this.state.errorOnOpenImage\r\n      const progress = this.state.progress\r\n      \r\n      this.sliceMax = this.getSeriesLength()\r\n      \r\n      const styleContainer = {\r\n        width: '100%', \r\n        height: '100%', \r\n        border: (this.props.explorerActiveSeriesIndex === this.props.index) ? 'solid 1px #AAAAAA' : null,\r\n        position: 'relative',\r\n      }\r\n\r\n      const styleDicomImage = {\r\n        width: '100%', \r\n        height: '100%', \r\n        position: 'relative',\r\n      }\r\n\r\n      return ( \r\n        <div className=\"container\" style={styleContainer} >\r\n\r\n          {visibleOpenUrlDlg ? <OpenUrlDlg progress={progress} onClose={this.hideOpenUrlDlg} /> : null}\r\n\r\n          <Dialog\r\n            open={errorOnOpenImage !== null}\r\n            onClose={this.onErrorOpenImageClose}\r\n          >\r\n            <DialogTitle id=\"alert-dialog-title\">{\"Error on opening image\"}</DialogTitle>\r\n            <DialogContent>\r\n              <DialogContentText id=\"alert-dialog-description\">\r\n                {this.state.errorOnOpenImage}\r\n              </DialogContentText>\r\n            </DialogContent>\r\n            <DialogActions>\r\n              <Button onClick={this.onErrorOpenImageClose} autoFocus>\r\n                Ok\r\n              </Button>\r\n            </DialogActions>\r\n          </Dialog>\r\n\r\n{/* \r\n          <Dialog\r\n            open={this.state.errorOnCors}\r\n            onClose={this.onErrorCorsClose}\r\n            aria-labelledby=\"alert-dialog-title\"\r\n            aria-describedby=\"alert-dialog-description\"\r\n          >\r\n            <DialogTitle id=\"alert-dialog-title\">{\"Error on loading image\"}</DialogTitle>\r\n            <DialogContent>\r\n              <DialogContentText id=\"alert-dialog-description\">\r\n                <Typography gutterBottom>\r\n                  CORS or Cross Origin Resource Sharing is a browser security policy \r\n                  that prevents javascript from loading data from a server with a different base URL \r\n                  than the server that served up the javascript file. \r\n                </Typography> \r\n                <Typography gutterBottom>\r\n                  See the &nbsp; \r\n                  <Link href=\"http://enable-cors.org/\" target='_blank' color='textPrimary'>\r\n                    Enable CORS site\r\n                  </Link>\r\n                  &nbsp; for information about CORS.                     \r\n                </Typography>                                \r\n              </DialogContentText>\r\n            </DialogContent>\r\n            <DialogActions>\r\n              <Button onClick={this.onErrorCorsClose} autoFocus>\r\n                Ok\r\n              </Button>\r\n            </DialogActions>\r\n          </Dialog> */}\r\n\r\n          <div\r\n            style={{\r\n              width: '100%', \r\n              height: '100%', \r\n              position: \"relative\",\r\n              color:  '#AAAAAA',\r\n              fontSize: '0.80em',\r\n              textShadow: '1px 1px #000000',\r\n              visibility: visible\r\n            }}\r\n            onContextMenu={() => false}\r\n            className=\"cornerstone-enabled-image\"\r\n          >\r\n\r\n            <div \r\n              id={`previewer-${this.props.index}`}\r\n              ref={this.dicomImageRef} style={styleDicomImage}\r\n            >\r\n            </div>\r\n\r\n            <div\r\n              id={`mrtopleft-${this.props.index}`}\r\n              style={{ position: \"absolute\", top: 0, left: 3 }}\r\n            >\r\n             {this.getSeriesNumber()}\r\n            </div>\r\n            <div\r\n              id={`mrtopright-${this.props.index}`}\r\n              style={{ position: \"absolute\", top: 0, right: 3 }}\r\n            >\r\n              \r\n            </div>\r\n            <div\r\n              id={`mrbottomright-${this.props.index}`}\r\n              style={{ position: \"absolute\", bottom: 0, right: 3 }}\r\n            >\r\n              {`${this.sliceMax}`}\r\n            </div>\r\n            <div\r\n              id={`mrbottomleft-${this.props.index}`}\r\n              style={{ position: \"absolute\", bottom: 0, left: 3 }}\r\n            >\r\n              {this.getSeriesDescription()}\r\n            </div>   \r\n\r\n            <div\r\n              id={`mrtopcenter-${this.props.index}`}\r\n              style={{ position: \"absolute\", top: 0, width: '60px', left: '50%', marginLeft: '0px' }}\r\n            >\r\n              \r\n            </div>\r\n\r\n            <div\r\n              id={`mrleftcenter-${this.props.index}`}\r\n              style={{ position: \"absolute\", top: '50%', width: '30px', left: 3, marginLeft: '0px' }}\r\n            >\r\n              \r\n            </div>    \r\n\r\n            <div\r\n              id={`mrrightcenter-${this.props.index}`}\r\n              style={{ position: \"absolute\", top: '50%', width: '30px', right: 3, marginRight: '-20px' }}\r\n            >\r\n              \r\n            </div>                \r\n\r\n            <div\r\n              id={`mrbottomcenter-${this.props.index}`}\r\n              style={{ position: \"absolute\", bottom: 0, width: '60px', left: '50%', marginLeft: '0px' }}\r\n            >\r\n              \r\n            </div>\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n  }\r\n  \r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    files: state.files,\r\n    series: state.series,\r\n    url: state.url,\r\n    tool: state.tool,\r\n    activeDcmIndex: state.activeDcmIndex,\r\n    activeDcm: state.activeDcm,\r\n    explorerActiveSeriesIndex: state.explorerActiveSeriesIndex,\r\n    measurements: state.measurements,\r\n    fsCurrentDir: state.fsCurrentDir,\r\n    fsCurrentList: state.fsCurrentList,\r\n    dcmEnableTool: state.dcmEnableTool,\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    clearingStore: () => dispatch(clearStore()),\r\n    setIsOpenStore: (value) => dispatch(dcmIsOpen(value)),\r\n    toolStore: (tool) => dispatch(dcmTool(tool)),\r\n    setActiveDcm: (dcm) => dispatch(activeDcm(dcm)),\r\n    setActiveMeasurements: (measurements) => dispatch(activeMeasurements(measurements)),\r\n    makeFsRefresh: (dcm) => dispatch(doFsRefresh()),\r\n    setDcmEnableToolStore: (value) => dispatch(setDcmEnableTool(value))\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(DicomPreviewer)\r\n","import React, { PureComponent } from 'react'\r\nimport {connect} from 'react-redux'\r\nimport { withStyles } from '@material-ui/core/styles'\r\nimport DicomPreviewer from './DicomPreviewer'\r\nimport InputLabel from '@material-ui/core/InputLabel'\r\nimport MenuItem from '@material-ui/core/MenuItem'\r\nimport FormControl from '@material-ui/core/FormControl'\r\nimport Select from '@material-ui/core/Select'\r\nimport 'react-perfect-scrollbar/dist/css/styles.css'\r\nimport PerfectScrollbar from 'react-perfect-scrollbar'\r\nimport {\r\n    seriesStore,\r\n    filesStore,\r\n    explorer,\r\n    explorerActivePatientIndex,\r\n    explorerActiveStudyIndex,\r\n    explorerActiveSeriesIndex,\r\n  } from '../actions'\r\n\r\nimport {\r\n    groupBy,  \r\n} from '../functions'\r\n\r\nconst style = {\r\n    width: '200px', \r\n    padding: '8px 8px 8px 8px', \r\n    marginTop: '40px',\r\n}\r\n\r\nconst styleScrollbar = {\r\n    height: 'calc(100vh - 48px)',\r\n}\r\n\r\nconst styleDicomViewerStack = {\r\n    width: '182px', \r\n    marginTop: '10px',\r\n    marginLeft: '7px',\r\n}\r\n\r\nconst styleDicomViewer = { \r\n    padding: '4px 4px 4px 4px', \r\n}\r\n\r\nconst styles = theme => ({\r\n    formControl: {\r\n        margin: theme.spacing(1),\r\n        minWidth: 180,\r\n    },\r\n    selectEmpty: {\r\n        marginTop: theme.spacing(2),\r\n    },\r\n    selectText: {\r\n        fontSize: '0.85em',\r\n    },    \r\n    menuItemText: {\r\n        fontSize: '0.85em',\r\n    },\r\n})\r\n\r\nclass Explorer extends PureComponent {\r\n    constructor(props) {\r\n        super(props)\r\n\r\n        this.dicomViewersRefs = []\r\n        this.dicomViewers = []\r\n        for(let i=0; i < 16; i++) {\r\n          this.dicomViewers.push(this.setDcmViewer(i))\r\n        }\r\n      }\r\n\r\n    state = {\r\n        patientName: this.props.explorer.patient.keys[0],\r\n        studies: [],\r\n        study: '',\r\n        series: [],\r\n        seriesActiveIndex: 0,\r\n    }\r\n\r\n    setDcmViewer = (index) => {\r\n        return (\r\n          <div style={styleDicomViewer}>  \r\n            <DicomPreviewer \r\n                dcmRef={(ref) => {this.dicomViewersRefs[index] = ref}}\r\n                index={index}\r\n                runTool={ref => (this.runTool = ref)} \r\n                changeTool={ref => (this.changeTool = ref)}\r\n                onLoadedImage={this.onLoadedImage}\r\n                onRenderedImage={this.onRenderedImage}\r\n                visible={true} \r\n            />   \r\n          </div> \r\n        )\r\n    }\r\n    \r\n    onLoadedImage = () => {\r\n    \r\n    }\r\n\r\n    onRenderedImage = () => {\r\n\r\n    }\r\n\r\n    getDcmViewerRef = (index) => {\r\n        return this.dicomViewersRefs[index]\r\n    }\r\n\r\n    getDcmViewer = (index) => {\r\n        return this.dicomViewers[index]\r\n    }\r\n\r\n    buildPreviewStack = (rows) => {\r\n        this.dicomviewers = []\r\n        for(let i=0; i < rows; i++) {\r\n            this.dicomviewers.push(\r\n              <div \r\n                key={i} \r\n                onClick={() => this.previewStackClick(i)} \r\n                onTouchStart={() => this.previewStackTouch(i)}\r\n              >\r\n                {this.getDcmViewer(i)}\r\n              </div>        \r\n            )\r\n        }\r\n        \r\n        return (\r\n          <div\r\n            id=\"dicompreviewer-grid\"\r\n            style={{\r\n              display: 'grid',\r\n              gridTemplateRows: `repeat(${rows}, ${100 / rows}%)`,\r\n              gridTemplateColumns: `repeat(${1}, ${100}%)`,\r\n              height: '100%',\r\n              width: '100%',\r\n            }}\r\n          >\r\n            {this.dicomviewers}\r\n          </div>\r\n        )\r\n    }\r\n\r\n    componentDidMount() {\r\n        const patientIndex = this.props.explorerActivePatientIndex\r\n        const studyIndex = this.props.explorerActiveStudyIndex\r\n        const seriesIndex = this.props.explorerActiveSeriesIndex\r\n        const patientName = this.props.explorer.patient.keys[patientIndex]\r\n\r\n        const files = this.props.files\r\n        \r\n        this.setState({patientName: patientName}, () => {\r\n            this.filesListForPatient = files.filter((a) => {\r\n                return a.patient.patientName === patientName}\r\n            )\r\n \r\n            this.studyList = groupBy(this.filesListForPatient, a => a.study.studyDateTime)\r\n            let studyKeys = [...this.studyList.keys()]\r\n            if (this.studyList.get(studyKeys[0])[0].study.studyDate === undefined) {\r\n                this.studyList = groupBy(this.filesListForPatient, a => a.study.studyDescription)\r\n                studyKeys = [...this.studyList.keys()]\r\n            }\r\n            this.study = {\r\n              list: this.studyList,\r\n              keys: studyKeys\r\n            }\r\n\r\n            const seriesList = groupBy(this.studyList.get(studyKeys[0]), a => a.series.seriesNumber) // this.filesListForPatient\r\n            this.seriesList = new Map([...seriesList].sort())\r\n            \r\n            const seriesKeys = [...this.seriesList.keys()]\r\n            seriesKeys.sort(function(a, b) { return a - b })\r\n\r\n            this.series = {\r\n                seriesList: this.seriesList,\r\n                seriesKeys: seriesKeys\r\n            }\r\n            this.files = this.series.seriesList.get(seriesKeys[0])\r\n            this.props.setSeriesStore(this.series)\r\n\r\n            this.setState({study: this.study.keys[studyIndex], studies: studyKeys, series: seriesKeys}, () => {\r\n                this.previewStackClick(seriesIndex)\r\n            })\r\n        })\r\n\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        for(let i=0; i < this.state.series.length; i++) {\r\n            this.dicomViewersRefs[i].runTool('setfiles', this.seriesList.get(this.state.series[i]))\r\n            this.dicomViewersRefs[i].runTool('openimage', 0)\r\n        }\r\n    }\r\n\r\n    handlePatientChange = (event, value) => {\r\n        this.patientName = event.target.value\r\n        const patientIndex = value.key\r\n\r\n        this.filesListForPatient = this.props.allFiles.filter((a) => {\r\n            return a.patient.patientName === this.patientName}\r\n        )\r\n\r\n        this.studyList = groupBy(this.filesListForPatient, a => a.study.studyDateTime)\r\n        const studyKeys = [...this.studyList.keys()]\r\n        this.study = {\r\n          list: this.studyList,\r\n          keys: studyKeys\r\n        }\r\n\r\n        this.seriesList = groupBy(this.studyList.get(studyKeys[0]), a => a.series.seriesNumber) // this.filesListForPatient\r\n        const seriesKeys = [...this.seriesList.keys()]\r\n\r\n        this.series = {\r\n            seriesList: this.seriesList,\r\n            seriesKeys: seriesKeys\r\n        }\r\n        this.props.setSeriesStore(this.series)\r\n\r\n        this.setState({patientName: this.patientName, study: this.study.keys[0], studies: studyKeys, series: seriesKeys}, () => {\r\n            this.props.setExplorerActivePatientIndex(patientIndex)\r\n            this.previewStackClick(0)\r\n        })\r\n    }\r\n\r\n    handleStudyChange = (event, value) => {\r\n        const studyIndex = value.key\r\n\r\n        this.studyList = groupBy(this.filesListForPatient, a => a.study.studyDateTime)\r\n        let studyKeys = [...this.studyList.keys()]\r\n        if (this.studyList.get(studyKeys[0])[0].study.studyDate === undefined) {\r\n            this.studyList = groupBy(this.filesListForPatient, a => a.study.studyDescription)\r\n            studyKeys = [...this.studyList.keys()]\r\n        }\r\n        this.study = {\r\n          list: this.studyList,\r\n          keys: studyKeys\r\n        }\r\n\r\n        this.seriesList = groupBy(this.studyList.get(studyKeys[studyIndex]), a => a.series.seriesNumber)\r\n        const seriesKeys = [...this.seriesList.keys()]\r\n\r\n        this.series = {\r\n            seriesList: this.seriesList,\r\n            seriesKeys: seriesKeys\r\n        }\r\n        this.props.setSeriesStore(this.series)\r\n\r\n        this.setState({study: this.study.keys[studyIndex], studies: studyKeys, series: seriesKeys}, () => {\r\n            this.previewStackClick(0)\r\n        })\r\n\r\n\r\n    }\r\n\r\n    previewStackClick = (index) => {\r\n        //if (index === this.state.seriesActiveIndex) return\r\n        this.props.setExplorerActiveSeriesIndex(index) \r\n        this.setState({seriesActiveIndex: index}, () => {\r\n            this.props.onSelectSeries(this.series.seriesList.get(this.state.series[index]), index)\r\n        })\r\n    }\r\n\r\n    previewStackTouch = (index) => {\r\n        this.props.setExplorerActiveSeriesIndex(index)\r\n        this.setState({seriesActiveIndex: index}, () => {\r\n            this.props.onSelectSeries(this.series.seriesList.get(this.state.series[index]))\r\n        })\r\n    }\r\n\r\n    clear = () => {\r\n        for(let i=0; i < 16; i++) {\r\n            this.dicomViewersRefs[i].runTool('clear')\r\n        }\r\n    }\r\n\r\n    render() {   \r\n        const { classes } = this.props\r\n\r\n        return (\r\n            <PerfectScrollbar> \r\n                <div style={styleScrollbar}>\r\n                    <div style={style}>\r\n                        <FormControl className={classes.formControl}>\r\n                            <InputLabel id=\"patient-label\">Patient</InputLabel>\r\n                            <Select\r\n                                className={classes.selectText}\r\n                                labelId=\"patient-select-label\"\r\n                                id=\"patient-select\"\r\n                                value={this.state.patientName}\r\n                                onChange={this.handlePatientChange}\r\n                            >\r\n                                {this.props.explorer.patient.keys.map((patient, index) => (\r\n                                    <MenuItem className={classes.menuItemText} value={patient} key={index}>{patient}</MenuItem>\r\n                                ))}\r\n                            </Select>\r\n                        </FormControl>\r\n\r\n                        <FormControl className={classes.formControl}>\r\n                            <InputLabel id=\"study-label\">Study</InputLabel>\r\n                            <Select\r\n                                className={classes.selectText}\r\n                                labelId=\"study-select-label\"\r\n                                id=\"study-select\"\r\n                                value={this.state.study}\r\n                                onChange={this.handleStudyChange}\r\n                            >\r\n                                {this.state.studies.map((study, index) => (\r\n                                    // `${studyDate} - ${studyTime}`\r\n                                    <MenuItem className={classes.menuItemText} value={study} key={index}>{study}</MenuItem>\r\n                                ))}\r\n                            </Select>\r\n                        </FormControl>\r\n\r\n                        <div style={styleDicomViewerStack}>\r\n                            {\r\n                                this.buildPreviewStack(this.state.series.length)\r\n                            }\r\n                        </div>\r\n                    </div>\r\n\r\n            </div>\r\n          </PerfectScrollbar> \r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n      files: state.files,\r\n      explorerActivePatientIndex: state.explorerActivePatientIndex,\r\n      explorerActiveStudyIndex: state.explorerActiveStudyIndex,\r\n      explorerActiveSeriesIndex: state.explorerActiveSeriesIndex,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n    return {\r\n        setFilesStore: (files) => dispatch(filesStore(files)),\r\n        setExplorer: (data) => dispatch(explorer(data)),\r\n        setExplorerActivePatientIndex: (index) => dispatch(explorerActivePatientIndex(index)),\r\n        setExplorerActiveStudyIndex: (index) => dispatch(explorerActiveStudyIndex(index)),\r\n        setExplorerActiveSeriesIndex: (index) => dispatch(explorerActiveSeriesIndex(index)),\r\n        setSeriesStore: (series) => dispatch(seriesStore(series)),\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(Explorer))\r\n","import React, { PureComponent } from 'react'\r\nimport {connect} from 'react-redux'\r\nimport Button from '@material-ui/core/Button'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport DialogContent from '@material-ui/core/DialogContent'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport LinearProgress from '@material-ui/core/LinearProgress'\r\nimport * as cornerstone from \"cornerstone-core\"\r\nimport * as cornerstoneWADOImageLoader from \"cornerstone-wado-image-loader\"\r\nimport {\r\n  //allFilesStore,\r\n  filesStore,\r\n} from '../actions'\r\nimport { \r\n  getDicomPatientName,\r\n  getDicomStudyId,\r\n  getDicomStudyDate,\r\n  getDicomStudyTime,\r\n  getDicomStudyDescription,\r\n  getDicomSeriesDate,\r\n  getDicomSeriesTime,\r\n  getDicomSeriesDescription,\r\n  getDicomSeriesNumber,\r\n  getDicomInstanceNumber,\r\n  getDicomSliceLocation,\r\n  getDicomSliceDistance,\r\n  getDicomRows,\r\n  getDicomColumns,\r\n  getDicomEchoNumber,\r\n  getFileNameCorrect,\r\n  dicomDateTimeToLocale,\r\n} from '../functions'\r\n\r\ncornerstoneWADOImageLoader.external.cornerstone = cornerstone\r\n\r\nclass OpenMultipleFilesDlg extends PureComponent {\r\n\r\n  state = {\r\n    progress: 0,\r\n    cancel: false,\r\n  }  \r\n\r\n  componentDidMount() {\r\n    this.items = []\r\n    this.count = 0\r\n    this.step = 0\r\n\r\n    const files = this.props.files\r\n\r\n    this.step = files.length / 50\r\n    this.nextProgress = this.step\r\n    this.t0 = performance.now()\r\n\r\n    //cornerstoneWADOImageLoader.wadouri.fileManager.purge()\r\n    //cornerstone.imageCache.purgeCache()\r\n    \r\n    let imageIds = [] \r\n\r\n    for (let i=0; i < files.length; i++) {\r\n      const file = files[i]\r\n      if (this.props.origin === 'local')\r\n        imageIds.push(cornerstoneWADOImageLoader.wadouri.fileManager.add(file))\r\n      else // it's fs item\r\n        imageIds.push(cornerstoneWADOImageLoader.wadouri.fileManager.addBuffer(file.data))\r\n    }\r\n\r\n    for (let i=0; i < files.length; i++) {\r\n      const file = files[i]\r\n      if (this.state.cancel) {\r\n        //this.props.setAllFilesStore(null)\r\n        this.props.setFilesStore(null)\r\n        this.close()\r\n        return\r\n      }\r\n      \r\n      cornerstone.loadImage(imageIds[i]).then((image) => {\r\n        const patientName = getDicomPatientName(image)\r\n\r\n        const studyId = getDicomStudyId(image)\r\n        const studyDate = getDicomStudyDate(image)\r\n        const studyTime = getDicomStudyTime(image)\r\n        const studyDescription = getDicomStudyDescription(image)\r\n\r\n        const seriesDate = getDicomSeriesDate(image)\r\n        const seriesTime = getDicomSeriesTime(image)\r\n        const seriesDescription = getDicomSeriesDescription(image)        \r\n        const seriesNumber = getDicomSeriesNumber(image)\r\n\r\n        const instanceNumber = getDicomInstanceNumber(image)\r\n        const sliceDistance = getDicomSliceDistance(image)\r\n        const echoNumber = getDicomEchoNumber(image)\r\n        const sliceLocation = getDicomSliceLocation(image)  \r\n        const columns = getDicomColumns(image)       \r\n        const rows = getDicomRows(image)\r\n\r\n        const studyDateTime = studyDate === undefined ? undefined : dicomDateTimeToLocale(`${studyDate}.${studyTime}`)\r\n\r\n        let item = null\r\n        if (this.props.origin === 'local')\r\n          item = {\r\n            imageId: imageIds[i], \r\n            instanceNumber: instanceNumber, \r\n            name: getFileNameCorrect(file.name), \r\n            image: image, \r\n            rows: rows, \r\n            columns: columns, \r\n            sliceDistance: sliceDistance,\r\n            sliceLocation: sliceLocation,\r\n            patient: {\r\n              patientName: patientName\r\n            },\r\n            study: {\r\n              studyId: studyId,\r\n              studyDate: studyDate,\r\n              studyTime: studyTime,\r\n              studyDateTime: studyDateTime,\r\n              studyDescription: studyDescription\r\n            },\r\n            series: {\r\n              seriesDate: seriesDate,\r\n              seriesTime: seriesTime,\r\n              seriesDescription: seriesDescription,\r\n              seriesNumber: seriesNumber,\r\n              echoNumber: echoNumber\r\n            }\r\n          }\r\n        else\r\n          item = {\r\n            imageId: imageIds[i], \r\n            instanceNumber: instanceNumber, \r\n            name: file.name, \r\n            image: image, \r\n            rows: rows, \r\n            columns: columns, \r\n            sliceDistance: sliceDistance,\r\n            sliceLocation: sliceLocation,  \r\n            patient: {\r\n              patientName: patientName\r\n            },\r\n            study: {\r\n              studyId: studyId,\r\n              studyDate: studyDate,\r\n              studyTime: studyTime,\r\n              studyDateTime: studyDateTime,\r\n              studyDescription: studyDescription\r\n            },\r\n            series: {\r\n              seriesDate: seriesDate,\r\n              seriesTime: seriesTime,\r\n              seriesDescription: seriesDescription,\r\n              seriesNumber: seriesNumber,\r\n              echoNumber: echoNumber\r\n            }          \r\n          }\r\n        this.items.push(item)\r\n        this.count++\r\n\r\n        const progress = Math.floor(this.count*(100/files.length))\r\n        //\r\n        if (progress > this.nextProgress) {\r\n          this.nextProgress += this.step\r\n          this.setState({progress: progress})\r\n        }\r\n        if (this.count === files.length) {\r\n          this.items.sort((l, r) => {\r\n            return l.instanceNumber - r.instanceNumber\r\n            // return l.sliceDistance - r.sliceDistance\r\n            // return l.sliceLocation - r.sliceLocation\r\n          })\r\n          this.t1 = performance.now()\r\n          console.log(`performance load ${this.count} images in ${this.t1-this.t0} milliseconds`)\r\n          this.props.setFilesStore(this.items)\r\n          this.close()\r\n        }\r\n\t\t\t}, (e) => {\r\n        console.log('Error in reading multiple files: ', e)\r\n        this.count++\r\n      })\r\n      if (this.count === files.length) {\r\n        \r\n      }   \r\n    }\r\n    //this.close()\r\n  }\r\n\r\n  close = () => {\r\n    this.props.onClose()\r\n  }\r\n\r\n  cancel = () => {\r\n    this.setState({cancel: true}) \r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <Dialog\r\n            open={true}\r\n            onClose={this.close}\r\n            aria-labelledby=\"alert-dialog-title\"\r\n        >\r\n            <DialogTitle id=\"alert-dialog-title\">{\"Opening multiple files ...\"}</DialogTitle>\r\n            <DialogContent>\r\n              <LinearProgress variant=\"determinate\" value={this.state.progress} color='secondary' />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={this.cancel}>\r\n                    Cancel\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n      setFilesStore: (files) => dispatch(filesStore(files)),\r\n  }\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(OpenMultipleFilesDlg)\r\n","import React, { PureComponent } from 'react'\r\nimport {connect} from 'react-redux'\r\nimport { withStyles } from '@material-ui/core/styles'\r\nimport Button from '@material-ui/core/Button'\r\nimport CircularProgress from '@material-ui/core/CircularProgress'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogContent from '@material-ui/core/DialogContent'\r\nimport DialogContentText from '@material-ui/core/DialogContentText'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport Icon from '@mdi/react'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport InputBase from '@material-ui/core/InputBase'\r\nimport LinearProgress from '@material-ui/core/LinearProgress'\r\nimport Paper from '@material-ui/core/Paper'\r\nimport Table from '@material-ui/core/Table'\r\nimport TableBody from '@material-ui/core/TableBody'\r\nimport TableCell from '@material-ui/core/TableCell'\r\nimport TableContainer from '@material-ui/core/TableContainer'\r\nimport TableHead from '@material-ui/core/TableHead'\r\nimport TableRow from '@material-ui/core/TableRow'\r\nimport TextField from '@material-ui/core/TextField'\r\nimport Toolbar from '@material-ui/core/Toolbar'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\nimport Typography from '@material-ui/core/Typography'\r\nimport 'react-perfect-scrollbar/dist/css/styles.css'\r\nimport PerfectScrollbar from 'react-perfect-scrollbar'\r\nimport JSZip from 'jszip'\r\nimport { saveAs } from 'file-saver'\r\nimport fs from '../fs/fs'\r\nimport OpenMultipleFilesDlg from './OpenMultipleFilesDlg'\r\nimport {\r\n    getFileExt,\r\n    getFileExtReal,\r\n    getFileName,\r\n    formatBytes,\r\n    getSettingsFsView,\r\n    getFileNameCorrect,\r\n} from '../functions'\r\nimport {\r\n    //setFsCurrentId,\r\n    setFsCurrentDir,\r\n    setFsCurrentList,\r\n    setZippedFile,\r\n    fsFileStore,\r\n} from '../actions'\r\nimport {\r\n    mdiCheck,\r\n    mdiChevronLeft,\r\n    mdiClose,\r\n    mdiContentCopy,\r\n    mdiContentCut,\r\n    mdiContentPaste,\r\n    mdiContentSaveOutline,\r\n    mdiDeleteOutline,\r\n    mdiDotsHorizontal,\r\n    mdiExportVariant, \r\n    mdiFolderOutline,   \r\n    mdiFolderPlusOutline,\r\n    mdiCheckBoxOutline,\r\n    mdiSquareEditOutline,\r\n} from '@mdi/js'\r\n\r\nconst styles = theme => ({\r\n    table: {\r\n        minWidth: 250,\r\n    },\r\n    tableCellText: {\r\n        fontSize: '0.80em',\r\n    },\r\n    toolbarButtons: {\r\n        marginLeft: 'auto',\r\n        marginRight: -20,\r\n    },\r\n    leftButtons: {\r\n        marginLeft: -25,\r\n    },\r\n    textPaper: {\r\n        padding: '2px 4px',\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        width: 250,\r\n    },\r\n    textInput: {\r\n        marginLeft: theme.spacing(1),\r\n        flex: 1,\r\n    },\r\n    textButton: {\r\n        padding: 10,\r\n    },\r\n})\r\n\r\nconst styleScrollbar = {\r\n    height: 'calc(100vh - 48px)'\r\n}\r\n\r\nclass FsUI extends PureComponent {\r\n    constructor(props) {\r\n        super(props)\r\n        this.files = []\r\n        this.cut = false\r\n        this.itemsCount = 0\r\n        this.saveAsField = React.createRef()\r\n\r\n      }\r\n\r\n    state = {\r\n        textFieldLabel: '',\r\n        textFieldValue: '',\r\n        selected: [],\r\n        selectedCopy: [],\r\n        visibleTextField: false,\r\n        visibleDeleteDlg: false,\r\n        visibleOthers: false,\r\n        visibleAlreadyExistDlg: false,\r\n        visibleOSaveAsDlg: false,\r\n        visibleWaiting: false,\r\n        visibleOpenMultipleFilesDlg: false,\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.fsListDir(this.props.fsCurrentDir)\r\n    }\r\n\r\n    componentDidUpdate(previousProps) {\r\n\r\n        if (this.props.fsZippedFile !== null) {\r\n            const zip = new JSZip()\r\n            zip.loadAsync(this.props.fsZippedFile).then((contents) => {\r\n                contents.forEach((relativePath, zipEntry) => {\r\n                    if (zipEntry.dir) { \r\n                    } else {                  \r\n                        zip.file(relativePath).async('uint8array').then((content) => {\r\n                            this.fsAddItem(relativePath, content)\r\n                        })\r\n                    }\r\n                })\r\n            }).then(() => {\r\n                this.props.setFsZippedFile(null)\r\n                //this.fsListDir(this.props.fsCurrentDir)\r\n            })\r\n        } else {\r\n            //this.fsListDir(this.props.fsCurrentDir)\r\n        }\r\n    }\r\n\r\n    fsBuildParent(parent, name) {\r\n        let newParent = ''\r\n        if (parent === '') {\r\n            if (name !== '') \r\n                newParent = name\r\n        } else {\r\n            if (name !== '') \r\n                newParent = `${parent}/${name}` \r\n            else\r\n                newParent = parent\r\n        }\r\n        return newParent\r\n    }\r\n\r\n    fsAddItem(filename, data) {\r\n        let components = filename.split('/')\r\n        const name = components.pop()\r\n        const parent = this.fsBuildParent(this.props.fsCurrentDir, components.join('/'))\r\n        fs.transaction('rw', fs.files, async () => {\r\n            await fs.files.add({\r\n                parent: parent,\r\n                name: name,\r\n                type: getFileExt(name),\r\n                size: data.length,\r\n                data: data\r\n            })             \r\n        }).then(() => {\r\n            // store subdirectory\r\n            while (components.length > 0) {\r\n                const name = components.pop()\r\n                const parent = this.fsBuildParent(this.props.fsCurrentDir, components.join('/'))\r\n                fs.transaction('rw', fs.files, async () => {\r\n                    await fs.files.put({\r\n                        parent: parent,\r\n                        name: name,\r\n                        type: 'dir',\r\n                        size: '' \r\n                    }) \r\n                }).then(() => {\r\n                    this.fsListDir(this.props.fsCurrentDir)\r\n                })\r\n            }            \r\n        })\r\n    }\r\n\r\n    fsExistDir(dir, create = true) {\r\n        const item = this.props.fsCurrentList.find(e => e.name === dir)\r\n        if (item !== undefined) {\r\n            if (create) {\r\n                this.fsCreateDir(this.props.fsCurrentDir, dir)\r\n                return true\r\n            } else return false\r\n        } else return false\r\n    }\r\n\r\n    fsListDir(dir) {\r\n        let listItems = []\r\n        fs.transaction('r', fs.files, () => {\r\n            fs.files.where({parent: dir, type: 'dir'}).sortBy('name').then((list) => { // first list all dirs\r\n                listItems = list\r\n            }).then(() => { // after list all files\r\n                fs.files.where({parent: dir}).and(item => item.type !== 'dir').sortBy('name').then((list) => {\r\n                    listItems = listItems.concat(list)\r\n                }).then(() => {\r\n                    this.props.setCurrentList(listItems)\r\n                    setTimeout(() => this.setState({visibleWaiting: false}), 1000)\r\n                })\r\n            })\r\n        })\r\n    }\r\n\r\n    fsCreateDir(parent, name) {\r\n        fs.files.add({parent: parent, name: name, type: 'dir', size: ''}).then(() => { \r\n            this.fsListDir(this.props.fsCurrentDir)\r\n        })\r\n    }\r\n\r\n    doSelectUnselect = () => {\r\n        let newSelected = []\r\n        if (this.state.selected.length > 0) { // unselect the files\r\n            this.setState({selected: newSelected})            \r\n        } else { // select only files not dir\r\n            this.props.fsCurrentList.forEach((item) => {\r\n                if (item.type !== 'dir') {\r\n                    newSelected.push(item.name)\r\n                }\r\n                this.setState({selected: newSelected}, () => {\r\n                })\r\n                \r\n            })\r\n        }\r\n    }\r\n\r\n    openSelectedFilesRetrieveItems = async () => {\r\n        await fs.transaction('r', fs.files, async () => {\r\n            this.state.selected.forEach( async (name, index) => {\r\n                await fs.files.where({parent: this.props.fsCurrentDir, name: name}).first((item) => {\r\n                    if (item !== undefined && item.type !== 'dir') {\r\n                        this.files.push(item)\r\n                    } else if (item.type === 'dir') {\r\n                        fs.files.where('parent').startsWithIgnoreCase(item.name).each((e) => {\r\n                            if (e !== undefined && e.type !== 'dir') {\r\n                                this.files.push(e)\r\n                            }\r\n                        })\r\n                    }\r\n                })\r\n             })\r\n        })\r\n    }\r\n\r\n    openSelectedFiles = () => {\r\n        if (this.state.selected.length === 0) return\r\n        this.files = []\r\n        this.openSelectedFilesRetrieveItems().then(() => {\r\n            this.setState({visibleOpenMultipleFilesDlg: true})\r\n            this.setState({selected: []})  \r\n        })\r\n    }\r\n\r\n    hideOpenMultipleFilesDlg = () => {\r\n        this.setState({ visibleOpenMultipleFilesDlg: false })\r\n        if (this.props.files.length > 1) {\r\n            this.props.onOpenMultipleFilesCompleted()\r\n        } else this.props.onOpenImage(0)\r\n    }\r\n\r\n    createDir = () => {\r\n        this.setState({textFieldLabel: 'new folder name', visibleTextField: !this.state.visibleTextField})\r\n    }\r\n\r\n    renameItem = () => {\r\n        this.lastSelected = this.state.selected[this.state.selected.length-1]\r\n        this.setState({textFieldLabel: '', textFieldValue: this.lastSelected, visibleTextField: !this.state.visibleTextField})\r\n    }\r\n\r\n    previousDir = () => {\r\n        if (this.props.fsCurrentDir === '') return\r\n        const nextDir = this.props.fsCurrentDir.split('/').slice(0, -1).join('/')\r\n        this.props.setCurrentDir(nextDir)\r\n        this.fsListDir(nextDir)\r\n    }\r\n\r\n    confirmText = (e) => {\r\n        if (this.state.textFieldLabel === '') { // it's a rename\r\n            // check if the new name already exist\r\n            const check = this.props.fsCurrentList.find(e => e.name === this.state.textFieldValue)\r\n            if (check !== undefined) {\r\n                this.setState({visibleAlreadyExistDlg: true})\r\n                return\r\n            }\r\n            const item = this.props.fsCurrentList.find(e => e.name === this.lastSelected)\r\n            if (item !== undefined) {\r\n                if (item.type === 'dir') {\r\n                    const oldParent = this.fsBuildParent(item.parent, item.name)\r\n                    const newParent = this.fsBuildParent(item.parent, this.state.textFieldValue)\r\n                    // rename parent for all subitems\r\n                    fs.transaction('rw', fs.files, async () => {\r\n                        await fs.files.where({parent: oldParent}).each((e) => {\r\n                            fs.transaction('rw', fs.files, async () => { // since is a new primary key then add it as new item \r\n                                await fs.files.add({\r\n                                parent: newParent,\r\n                                name: e.name,\r\n                                type: e.type,\r\n                                size: e.size,\r\n                                data: e.data\r\n                                }).then(() => { // then delete old one\r\n                                    fs.files.where({parent: oldParent}).delete()\r\n                                })\r\n                            })\r\n                        })\r\n                    })\r\n                } \r\n                fs.transaction('rw', fs.files, async () => { // a new primary key, add it as new item \r\n                    await fs.files.add({\r\n                      parent: item.parent,\r\n                      name: this.state.textFieldValue,\r\n                      type: item.type,\r\n                      size: item.size,\r\n                      data: item.data\r\n                    }).then(() => { // then delete old one\r\n                        fs.files.where({parent: item.parent, name: item.name}).delete()\r\n                    })\r\n                })\r\n                this.setState({visibleTextField: false})\r\n                this.fsListDir(this.props.fsCurrentDir)                \r\n            }\r\n        } else { // it's a new directory\r\n            this.setState({visibleTextField: false}, () => {\r\n                this.fsCreateDir(this.props.fsCurrentDir, this.state.textFieldValue)\r\n            })\r\n        }\r\n    }\r\n\r\n    cancelDir = () => {\r\n         this.setState({visibleTextField: false})\r\n    }\r\n\r\n    saveItem = () => {\r\n\r\n        if (this.props.localFileStore !== null) {\r\n            const file = this.props.localFileStore\r\n            if (file === null) return\r\n            let reader = new FileReader()\r\n            reader.onload = (event) => {\r\n                let buffer = event.target.result\r\n                const ext = getFileExtReal(file.name)\r\n                const name = getFileName(getFileNameCorrect(file.name))   \r\n                let newName = name\r\n                let counter = 0\r\n                let done = false             \r\n                do {\r\n                    let filename = ext === '' ? newName : `${newName}.${ext}`\r\n                    const checkName = this.props.fsCurrentList.find(e => e.name === filename)\r\n                    if (checkName === undefined) {\r\n                        fs.transaction('rw', fs.files, async () => {\r\n                            await fs.files.add({\r\n                                parent: this.props.fsCurrentDir,\r\n                                name: filename,\r\n                                type: ext === '' ? getFileExt(name) : ext,\r\n                                size: file.size,\r\n                                data: buffer\r\n                            })\r\n                        }).then(() => {\r\n                            this.fsListDir(this.props.fsCurrentDir)\r\n                        })\r\n                        done = true\r\n                    } else {\r\n                        newName = `${name} - Copy`\r\n                        if (counter > 0) newName = `${newName} (${counter})`\r\n                        counter++\r\n                    }\r\n                } while (!done)\r\n            }\r\n            reader.readAsArrayBuffer(file)\r\n        } else if (this.props.fsFileStore !== null) {\r\n            const file = this.props.fsFileStore\r\n            let buffer = file.data\r\n            const ext = getFileExtReal(file.name)\r\n            const name = getFileName(getFileNameCorrect(file.name))   \r\n            let newName = name\r\n            let counter = 0\r\n            let done = false             \r\n            do {\r\n                let filename = ext === '' ? newName : `${newName}.${ext}`\r\n                const checkName = this.props.fsCurrentList.find(e => e.name === filename)\r\n                if (checkName === undefined) {\r\n                    fs.transaction('rw', fs.files, async () => {\r\n                        await fs.files.add({\r\n                            parent: this.props.fsCurrentDir,\r\n                            name: filename,\r\n                            type: getFileExt(name),\r\n                            size: file.size,\r\n                            data: buffer\r\n                        })\r\n                    }).then(() => {\r\n                        this.fsListDir(this.props.fsCurrentDir)\r\n                    })\r\n                    done = true\r\n                } else {\r\n                    newName = `${name} - Copy`\r\n                    if (counter > 0) newName = `${newName} (${counter})`\r\n                    counter++\r\n                }\r\n            } while (!done)           \r\n        }\r\n    }\r\n\r\n    copyItem = () => {\r\n        let newSelectedCopy = []\r\n        this.state.selected.forEach(name => {\r\n            const item = this.props.fsCurrentList.find(e => e.name === name)\r\n            if (item !== undefined) {\r\n                newSelectedCopy.push({parent: item.parent, name: item.name})\r\n            }\r\n        })\r\n        this.setState({selectedCopy: newSelectedCopy})\r\n    }\r\n\r\n    cutItem = () => {\r\n        let newSelectedCopy = []\r\n        this.state.selected.forEach(name => {\r\n            let item = this.props.fsCurrentList.find(e => e.name === name)\r\n            if (item !== undefined) {\r\n                newSelectedCopy.push({parent: item.parent, name: item.name})\r\n            }\r\n        })\r\n        this.setState({selectedCopy: newSelectedCopy})\r\n        this.cut = true\r\n    }\r\n\r\n    pasteItem = () => {\r\n        this.state.selectedCopy.forEach(async (selected, index) => {\r\n            await fs.files.where({parent: selected.parent, name: selected.name}).first((item) => {\r\n                if (item !== undefined) {\r\n                    if (item.type === 'dir') {\r\n                        // create a new name\r\n                        let counter = 0\r\n                        let done = false\r\n                        let newName = item.name\r\n                        do {\r\n                            let filename = newName\r\n                            const checkName = this.props.fsCurrentList.find(e => e.name === filename)\r\n                            if (checkName === undefined) {\r\n                                done = true\r\n                            } else {\r\n                                newName = `${item.name} - Copy`\r\n                                if (counter > 0) newName = `${newName} (${counter})`\r\n                                counter++\r\n                            }\r\n                        } while (!done)   \r\n                        // copy the folder\r\n                        fs.files.add({\r\n                            parent: this.props.fsCurrentDir,\r\n                            name: newName,\r\n                            type: item.type,\r\n                            size: item.size,\r\n                            data: item.data\r\n                        })   \r\n                        // copy all subdirs and files\r\n                        const oldParent = this.fsBuildParent(item.parent, item.name) \r\n                        const newParent = this.fsBuildParent(this.props.fsCurrentDir, newName) \r\n                        let listItems = []\r\n                        fs.files.where('parent').startsWithIgnoreCase(oldParent).each((e) => {\r\n                            listItems.push(e)\r\n                        }).then(() => {\r\n                            listItems.forEach(e => {\r\n                                fs.files.add({\r\n                                    parent: newParent,\r\n                                    name: e.name,\r\n                                    type: e.type,\r\n                                    size: e.size,\r\n                                    data: e.data\r\n                                })                          \r\n                            })                            \r\n                        })\r\n                    } else { // it's a file\r\n                        const ext = getFileExtReal(item.name)\r\n                        const name = getFileName(item.name)    \r\n                        let newName = name\r\n                        let counter = 0\r\n                        let done = false             \r\n                        do {\r\n                            let filename = ext === '' ? newName : `${newName}.${ext}`\r\n                            const checkName = this.props.fsCurrentList.find(e => e.name === filename)\r\n                            if (checkName === undefined) {\r\n                                fs.transaction('rw', fs.files, async () => {\r\n                                    await fs.files.add({\r\n                                        parent: this.props.fsCurrentDir,\r\n                                        name: filename,\r\n                                        type: item.type,\r\n                                        size: item.size,\r\n                                        data: item.data\r\n                                    })\r\n                                })\r\n                                done = true\r\n                            } else {\r\n                                newName = `${name} - Copy`\r\n                                if (counter > 0) newName = `${newName} (${counter})`\r\n                                counter++\r\n                            }\r\n                        } while (!done)\r\n                    }\r\n                }\r\n            })\r\n            if (index === this.state.selectedCopy.length-1) {\r\n                if (this.cut) {\r\n                    this.state.selectedCopy.forEach((selected) => {\r\n                        fs.files.where({parent: selected.parent, name: selected.name}).delete()\r\n                    })\r\n                    this.setState({selectedCopy: []})\r\n                    this.cut = false                    \r\n                }\r\n                this.fsListDir(this.props.fsCurrentDir)\r\n            }\r\n        })\r\n        this.setState({selected: []})\r\n    }\r\n\r\n    deleteItem = () => {\r\n        this.state.selected.forEach(name => {\r\n            let item = this.props.fsCurrentList.find(e => e.name === name)\r\n            if (item !== undefined) {\r\n                if (item.type === 'dir') { // delete also all subitems\r\n                    fs.files.where('parent').startsWithIgnoreCase(this.fsBuildParent(item.parent, item.name)).delete()\r\n                }\r\n                fs.files.where({parent: item.parent, name: item.name}).delete().then(() => {\r\n                    this.fsListDir(this.props.fsCurrentDir)\r\n                })\r\n            }\r\n        })\r\n        this.setState({selected: []}) \r\n    }\r\n\r\n    showOthers = () => {\r\n        this.setState({visibleOthers: !this.state.visibleOthers})\r\n    }\r\n\r\n    exportItem = () => {\r\n        if (this.state.selected.length === 0) return\r\n        this.setState({visibleOSaveAsDlg: true})\r\n    }\r\n\r\n    itemClick = (e, row) => {\r\n        const selectedIndex = this.state.selected.indexOf(row.name)\r\n        let newSelected = []\r\n        if (selectedIndex === -1) {\r\n            newSelected = newSelected.concat(this.state.selected, row.name)\r\n        } else if (selectedIndex >= 0) {\r\n            newSelected = newSelected.concat(\r\n                this.state.selected.slice(0, selectedIndex),\r\n                this.state.selected.slice(selectedIndex + 1),\r\n            )\r\n        }\r\n        this.setState({selected: newSelected}, () => {\r\n        })\r\n    }\r\n\r\n    itemDoubleClick = (e, item) => {\r\n        if (item.type === 'dir') {\r\n            this.setState({visibleWaiting: true})\r\n            const fsCurrentDir = this.fsBuildParent(item.parent, item.name)\r\n            this.props.setCurrentDir(fsCurrentDir)\r\n            this.fsListDir(fsCurrentDir)\r\n        } else if (item.name === 'DICOMDIR') {\r\n            this.props.onOpenDicomdir(item)\r\n        } else {\r\n            this.props.setFsFileStore(item)\r\n            this.props.onOpen(item)\r\n        }\r\n    }\r\n\r\n    showDeleteDlg = () => {\r\n        this.setState({ visibleDeleteDlg: true })\r\n      }\r\n    \r\n    hideDeleteDlg = () => {\r\n        this.setState({ visibleDeleteDlg: false })\r\n    }\r\n\r\n    confirmDeleteDlg = () => {\r\n        this.hideDeleteDlg()\r\n        this.deleteItem()\r\n    }\r\n\r\n    hideAlreadyExistDlg = () => {\r\n        this.setState({ visibleAlreadyExistDlg: false })\r\n    }  \r\n\r\n    hideSaveAs = () => {\r\n        this.setState({ visibleOSaveAsDlg: false })\r\n    }\r\n\r\n    closeSaveAs = () => {\r\n        const filename = `${this.saveAsField.value}.zip`\r\n        this.setState({ visibleOSaveAsDlg: false }, () => {\r\n            let zip = new JSZip()\r\n            let listItems = []\r\n            fs.files.where('parent').startsWithIgnoreCase(this.props.fsCurrentDir).each((e) => {\r\n                if (this.state.selected.indexOf(e.parent) >= 0 || this.state.selected.indexOf(e.name) >= 0)\r\n                    listItems.push(e)\r\n            }).then(() => {\r\n                listItems.forEach((e) => {\r\n                    if (e.type !== 'dir') {\r\n                        zip.folder(e.parent).file(e.name, e.data)\r\n                    }\r\n                })\r\n                zip.generateAsync({type:\"blob\"}).then(blob => {\r\n                    saveAs(blob, filename)\r\n                })\r\n            })\r\n        })\r\n    }    \r\n\r\n    mouseDown = (e, item) => {\r\n        this.timer = setTimeout(() => { \r\n            this.itemDoubleClick(e, item)\r\n        }, 500)\r\n    }\r\n\r\n    mouseUp = (e) => {\r\n        clearTimeout(this.timer)\r\n    }\r\n\r\n    render() {   \r\n        const { classes } = this.props\r\n        const isSelected = name => this.state.selected.indexOf(name) !== -1\r\n        const visibleTextField = this.state.visibleTextField\r\n        const visibleOthers = this.state.visibleOthers\r\n        const visibleDeleteDlg = this.state.visibleDeleteDlg\r\n        const visibleAlreadyExistDlg = this.state.visibleAlreadyExistDlg\r\n        const visibleOSaveAsDlg = this.state.visibleOSaveAsDlg\r\n        const visibleOpenMultipleFilesDlg = this.state.visibleOpenMultipleFilesDlg\r\n        const visibleWaiting = this.state.visibleWaiting\r\n\r\n        let styleComponent = null\r\n        if (getSettingsFsView() === 'bottom') {\r\n            styleComponent = {marginTop: '0px', height: '275px'}\r\n        } else {\r\n            styleComponent = {marginTop: '48px', width: '350px'}\r\n        }\r\n\r\n        let totalItemsCount = ''\r\n        if (this.state.selected.length > 0)\r\n            totalItemsCount = `(${this.state.selected.length} / ${this.props.fsCurrentList.length} items)`\r\n        else \r\n            totalItemsCount = `(${this.props.fsCurrentList.length} items)`\r\n\r\n        //console.log('this.props.fsCurrentDir: ', this.props.fsCurrentDir)\r\n\r\n        return (\r\n            <PerfectScrollbar>\r\n                <div style={styleScrollbar}> \r\n                    <div style={styleComponent}>\r\n                    { visibleTextField ? \r\n                        <Paper component=\"form\" className={classes.textPaper}>\r\n                            <InputBase\r\n                                autoFocus\r\n                                className={classes.textInput}\r\n                                placeholder={this.state.textFieldLabel}\r\n                                defaultValue={this.state.textFieldValue}\r\n                                onChange={(event) => {\r\n                                    this.setState({textFieldValue: event.target.value})\r\n                                }}\r\n                            />\r\n                            <IconButton className={classes.textButton} onClick={this.confirmText}>\r\n                                <Icon path={mdiCheck} size={'1.2rem'} color={this.props.color} />\r\n                            </IconButton>\r\n                            <IconButton className={classes.textButton} onClick={this.cancelDir}>\r\n                                <Icon path={mdiClose} size={'1.2rem'} color={this.props.color} />\r\n                            </IconButton>                        \r\n                        </Paper>\r\n                    : \r\n                        <div>\r\n\r\n                            <div>\r\n                                <Toolbar variant=\"dense\">\r\n                                    <div className={classes.leftButtons}>\r\n                                    { visibleWaiting ?\r\n                                        <CircularProgress style={{marginLeft: '10px'}} size={20} color=\"secondary\" />\r\n                                    : \r\n                                        <Tooltip title=\"Previous folder\">\r\n                                            <IconButton color=\"inherit\" onClick={this.previousDir} >\r\n                                                <Icon path={mdiChevronLeft} size={'1.2rem'} color={this.props.color} />\r\n                                            </IconButton>       \r\n                                        </Tooltip>                                     \r\n                                    }\r\n                        \r\n                                    </div>\r\n                                    <div className={classes.toolbarButtons}>\r\n                                        <Tooltip title=\"Select/unselect all files\">\r\n                                            <IconButton color=\"inherit\" onClick={this.doSelectUnselect}>\r\n                                                <Icon path={mdiCheckBoxOutline} size={'1.2rem'} color={this.props.color} />\r\n                                            </IconButton>\r\n                                        </Tooltip>    \r\n                                        <Tooltip title=\"Open selected files\">\r\n                                            <IconButton color=\"inherit\" onClick={this.openSelectedFiles}>\r\n                                                <Icon path={mdiFolderOutline} size={'1.2rem'} color={this.props.color} />\r\n                                            </IconButton>\r\n                                        </Tooltip>                            \r\n                                        <Tooltip title=\"Create a new directory\">\r\n                                            <IconButton color=\"inherit\" onClick={this.createDir}>\r\n                                                <Icon path={mdiFolderPlusOutline} size={'1.2rem'} color={this.props.color} />\r\n                                            </IconButton>\r\n                                        </Tooltip>\r\n                                        <Tooltip title=\"Rename the last selected item\">\r\n                                            <IconButton color=\"inherit\" onClick={this.renameItem}>\r\n                                                <Icon path={mdiSquareEditOutline} size={'1.2rem'} color={this.props.color} />\r\n                                            </IconButton> \r\n                                        </Tooltip>\r\n\r\n                                        <IconButton color=\"inherit\" onClick={this.showOthers}>\r\n                                            <Icon path={mdiDotsHorizontal} size={'1.2rem'} color={this.props.color} />\r\n                                        </IconButton>                           \r\n                                    </div>            \r\n                                </Toolbar>\r\n                            </div> \r\n\r\n                            { visibleOthers ?\r\n                                <div>\r\n                                    <Toolbar variant=\"dense\">\r\n                                        <div className={classes.toolbarButtons}>\r\n                                            <Tooltip title=\"Move the selected items to the clipboard\">                          \r\n                                                <IconButton color=\"inherit\" onClick={this.cutItem}>\r\n                                                    <Icon path={mdiContentCut} size={'1.2rem'} color={this.props.color} />\r\n                                                </IconButton> \r\n                                            </Tooltip>  \r\n                                            <Tooltip title=\"Copy the selected items to the clipboard\">\r\n                                                <IconButton color=\"inherit\" onClick={this.copyItem}>\r\n                                                    <Icon path={mdiContentCopy} size={'1.2rem'} color={this.props.color} />\r\n                                                </IconButton>\r\n                                            </Tooltip>\r\n                                            <Tooltip title=\"Paste clipboard contents to current location\">                             \r\n                                                <IconButton color=\"inherit\" onClick={this.pasteItem}>\r\n                                                    <Icon path={mdiContentPaste} size={'1.2rem'} color={this.props.color} />\r\n                                                </IconButton>   \r\n                                            </Tooltip>  \r\n                                            <Tooltip title=\"Delete the selected items\">    \r\n                                                <IconButton color=\"inherit\" onClick={this.showDeleteDlg}>\r\n                                                    <Icon path={mdiDeleteOutline} size={'1.2rem'} color={this.props.color} />\r\n                                                </IconButton>  \r\n                                            </Tooltip>                                    \r\n                                            <Tooltip title=\"Save the opened image to sandbox file system\"> \r\n                                                <IconButton color=\"inherit\" onClick={this.saveItem}>\r\n                                                    <Icon path={mdiContentSaveOutline} size={'1.2rem'} color={this.props.color} />\r\n                                                </IconButton>      \r\n                                            </Tooltip>\r\n                                            <Tooltip title=\"Export the selected items as zipped archive\">\r\n                                                <IconButton color=\"inherit\" onClick={this.exportItem}>\r\n                                                    <Icon path={mdiExportVariant} size={'1.2rem'} color={this.props.color} />\r\n                                                </IconButton>   \r\n                                            </Tooltip>     \r\n                                             </div>            \r\n                                    </Toolbar>\r\n                                </div>\r\n                            : null\r\n                            }\r\n\r\n                            <div>\r\n                                <div>\r\n                                    <Typography \r\n                                        type=\"caption text\" \r\n                                        style={{fontSize: '0.75em', marginLeft: '15px', color: 'rgba(146, 146, 146, 1)', float: 'left'}}>\r\n                                            {'/'+this.props.fsCurrentDir+' '}\r\n                                    </Typography>\r\n                                </div>\r\n                                <div>\r\n                                    <Typography \r\n                                        type=\"caption text\" \r\n                                        style={{fontSize: '0.75em', marginRight: '5px', color: 'rgba(146, 146, 146, 1)', float: 'right'}}>\r\n                                            { totalItemsCount }\r\n                                    </Typography>\r\n                                </div>\r\n                            </div>    \r\n\r\n                            { visibleWaiting ?\r\n                                <div style={{marginTop: '20px', position: 'absolute'}}>\r\n                                    <LinearProgress color=\"secondary\" />\r\n                                </div>\r\n                            : null  \r\n                            }\r\n        \r\n                        </div>\r\n                        \r\n                    }\r\n                    \r\n                    <div style={{height: '200px'}}>\r\n                        <TableContainer component={Paper}>\r\n                            <Table className={classes.table} size=\"small\">\r\n                                <TableHead>\r\n                                    <TableRow>\r\n                                        <TableCell>Name</TableCell>\r\n                                        <TableCell align=\"left\">Type</TableCell>\r\n                                        <TableCell align=\"left\">Size</TableCell>\r\n                                    </TableRow>\r\n                                </TableHead>\r\n                                <TableBody>\r\n                                {this.props.fsCurrentList.map((row) => {\r\n                                    const isItemSelected = isSelected(row.name)\r\n                                    return (\r\n                                        <TableRow \r\n                                            key={`${row.parent}/${row.name}`} \r\n                                            role='button' \r\n                                            hover\r\n                                            selected={isItemSelected}\r\n                                            onClick={(e) => {this.itemClick(e, row)}}\r\n                                            onDoubleClick={(e) => {this.itemDoubleClick(e, row)}}\r\n                                            onTouchStart={(e) => this.mouseDown(e, row)} \r\n                                            onTouchEnd={(e) => this.mouseUp(e, row)}\r\n                                            onMouseDown={(e) => this.mouseDown(e, row)} \r\n                                            onMouseUp={(e) => this.mouseUp(e, row)}\r\n                                        >\r\n                                            <TableCell component=\"th\" scope=\"row\">\r\n                                            <Typography className={classes.tableCellText}>\r\n                                                {row.name}\r\n                                            </Typography>    \r\n                                            </TableCell>\r\n                                            <TableCell align=\"left\">{row.type}</TableCell>\r\n                                            <TableCell align=\"left\">{formatBytes(row.size)}</TableCell>\r\n                                        </TableRow>\r\n                                    )\r\n                                })}\r\n                                </TableBody>\r\n                            </Table>\r\n                        </TableContainer>\r\n                    </div>   \r\n\r\n                    <Dialog\r\n                        open={visibleDeleteDlg}\r\n                        onClose={this.hideDeleteDlg}\r\n                    >\r\n                        <DialogTitle>{\"Are you sure to delete selected items?\"}</DialogTitle>\r\n                        <DialogActions>\r\n                            <Button onClick={this.hideDeleteDlg}>\r\n                                Cancel\r\n                            </Button>\r\n                            <Button onClick={this.confirmDeleteDlg} autoFocus>\r\n                                Ok\r\n                            </Button>\r\n                        </DialogActions>\r\n                    </Dialog>    \r\n\r\n                    <Dialog\r\n                        open={visibleAlreadyExistDlg}\r\n                        onClose={this.hideAlreadyExistDlg}\r\n                    >\r\n                        <DialogTitle>{\"An item with this name already exists!\"}</DialogTitle>\r\n                        <DialogActions>\r\n                            <Button onClick={this.hideAlreadyExistDlg} autoFocus>\r\n                                Ok\r\n                            </Button>\r\n                        </DialogActions>\r\n                    </Dialog>    \r\n\r\n                    <Dialog\r\n                        open={visibleOSaveAsDlg}\r\n                    >\r\n                        <DialogTitle>Export archive</DialogTitle>\r\n                        <DialogContent>\r\n                            <DialogContentText>\r\n                                Specify a file name for the archive:\r\n                            </DialogContentText>\r\n                            <TextField\r\n                                autoFocus\r\n                                margin=\"dense\"\r\n                                id=\"id-open-url\"\r\n                                inputRef={input => (this.saveAsField = input)}\r\n                                fullWidth\r\n                            />\r\n                        </DialogContent>\r\n                        <DialogActions>\r\n                            <Button onClick={() => this.hideSaveAs()} >\r\n                                Cancel\r\n                            </Button>\r\n                            <Button onClick={() => this.closeSaveAs()}>\r\n                                Ok\r\n                            </Button>\r\n                        </DialogActions>\r\n                    </Dialog>          \r\n\r\n                    {visibleOpenMultipleFilesDlg ? <OpenMultipleFilesDlg onClose={this.hideOpenMultipleFilesDlg} files={this.files} origin={'fs'} /> : null}                    \r\n                </div>\r\n                </div>\r\n            </PerfectScrollbar>\r\n        )\r\n    }              \r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n      files: state.files,\r\n      localFileStore: state.localFile,\r\n      fsFileStore: state.fsFile,  \r\n      activeDcm: state.activeDcm,\r\n      fsCurrentDir: state.fsCurrentDir,\r\n      fsCurrentList: state.fsCurrentList,\r\n      fsZippedFile: state.fsZippedFile,\r\n      fsRefresh: state.fsRefresh,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n    return {\r\n        setCurrentDir: (dir) => dispatch(setFsCurrentDir(dir)),\r\n        setCurrentList: (list) => dispatch(setFsCurrentList(list)),\r\n        setFsZippedFile: (file) => dispatch(setZippedFile(file)),\r\n        setFsFileStore: (file) => dispatch(fsFileStore(file)),\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(FsUI))\r\n","import React, { PureComponent } from 'react'\r\nimport Slider from '@material-ui/core/Slider'\r\nimport {connect} from 'react-redux'\r\n\r\n\r\nconst HIST_WIDTH = 256\r\nconst HIST_HEIGHT = 128\r\nconst N_BINS = 256\r\n\r\nconst style = {\r\n  width: '273px', \r\n  padding: '8px 8px 8px 8px', \r\n  backgroundColor: '#444444',\r\n}\r\n\r\nconst styleSlider = {\r\n  width: '255px',\r\n  marginTop: '-9px',\r\n}\r\n\r\nconst styleCanvasGradient = {\r\n  marginTop: '-9px',\r\n}\r\n\r\nconst styleTable = {\r\n  borderCollapse: 'collapse',\r\n  fontFamily: 'Courier, monospace',\r\n  fontSize: '67%',\r\n  width: '100%',\r\n}\r\n\r\nconst styleTableTd = {\r\n  tableLayout: 'fixed',\r\n  width: '25%',\r\n}\r\n\r\nclass Histogram extends PureComponent {\r\n    constructor(props) {\r\n      super(props)\r\n      this.canvasHistogram = React.createRef()\r\n      this.canvasGradient = React.createRef()\r\n    }\r\n\r\n    state = {\r\n      activeDrags: 0,\r\n      deltaPosition: {\r\n        x: 0, y: 0\r\n      },\r\n      controlledPosition: {\r\n        x: -400, y: 200\r\n      },\r\n      value: 128,\r\n      histCount: 0,\r\n      valueScale: 0,\r\n      minHist: 0,\r\n      maxHist: 0,\r\n      mean: 0,\r\n      stdDev: 0,\r\n      indexDcm: -1\r\n    }\r\n\r\n    componentDidMount() {\r\n\r\n      const canvasH = this.canvasHistogram.current\r\n      const ctxH = this.canvasHistogram.current.getContext(\"2d\")\r\n      ctxH.translate(0, canvasH.height)\r\n      ctxH.scale(1, -1)\r\n\r\n      this.updateCanvas()     \r\n    }\r\n    \r\n    componentDidUpdate() {\r\n      if (this.state.indexDcm !== this.props.activeDcmIndex) {\r\n        this.setState({indexDcm: this.props.activeDcmIndex})\r\n        this.updateCanvas()\r\n      }\r\n    }\r\n\r\n    getMousePos(canvas, evt) {\r\n      const rect = canvas.getBoundingClientRect()\r\n      return {\r\n        x: evt.clientX - rect.left,\r\n        y: evt.clientY - rect.top\r\n      }\r\n    }\r\n\r\n    getRGBPixelsImage(x, y, width, height) {\r\n      const pixelData = this.props.activeDcm.image.getPixelData()\r\n      const storedPixelData = []\r\n      x = Math.round(x)\r\n      y = Math.round(y)   \r\n      let index = 0\r\n      let spIndex, row, column\r\n    \r\n      for (row = 0; row < height; row++) {\r\n        for (column = 0; column < width; column++) {\r\n          spIndex = ((row + y) * this.props.activeDcm.image.rows + (column + x)) * 4\r\n          const red = pixelData[spIndex]\r\n          const green = pixelData[spIndex + 1]\r\n          const blue = pixelData[spIndex + 2]\r\n          const alpha = pixelData[spIndex + 3]\r\n  \r\n          storedPixelData[index++] = red\r\n          storedPixelData[index++] = green\r\n          storedPixelData[index++] = blue\r\n          storedPixelData[index++] = alpha\r\n        }\r\n      }\r\n      return storedPixelData\r\n    }\r\n\r\n    getPixelsImage(x, y, width, height) {\r\n      const pixelData = this.props.activeDcm.image.getPixelData()\r\n      const storedPixelData = []\r\n      x = Math.round(x)\r\n      y = Math.round(y)   \r\n      let index = 0\r\n      let spIndex, row, column\r\n    \r\n      for (row = 0; row < height; row++) {\r\n        for (column = 0; column < width; column++) {\r\n          spIndex = ((row + y) * this.props.activeDcm.image.rows + (column + x)) \r\n          storedPixelData[index++] = pixelData[spIndex]\r\n        }\r\n      }\r\n      return storedPixelData\r\n    }    \r\n\r\n    getPixel(x, y) {\r\n      let sp = []\r\n      if (this.props.activeDcm.isDicom) {\r\n        if (this.props.activeDcm.image.color) {\r\n          //sp = getRGBPixels(this.element, x, y, 1, 1)\r\n          //sp = cornerstone.getStoredPixels(this.element, x, y, 1, 1)\r\n          sp = this.getRGBPixelsImage(x, y, 1, 1)\r\n        } else {\r\n          // sp = cornerstone.getStoredPixels(this.props.activeDcm.element, x, y, 1, 1)\r\n          sp = this.getPixelsImage(x, y, 1, 1)\r\n        }\r\n      } else {\r\n        sp = this.getRGBPixelsImage(x, y, 1, 1)\r\n      }\r\n      return sp[0]\r\n    }\r\n\r\n    updateCanvas() {\r\n      if (this.props.activeDcm === null) return\r\n      const image = this.props.activeDcm.image\r\n      if (image === null) return\r\n      //const element = this.props.element\r\n      const maxPixelValue = image.maxPixelValue\r\n      const minPixelValue = image.minPixelValue\r\n      //const k = Math.pow(2, this.props.bitsStored)\r\n      const minHist = minPixelValue+image.intercept\r\n      const maxHist = maxPixelValue+image.intercept\r\n      const lenHist = maxHist-minHist+1\r\n      const binSize = lenHist / N_BINS\r\n      let zero256 = Math.floor(Math.abs(minHist) / binSize)\r\n      let stepWW = Math.round(image.windowWidth / binSize / 2)\r\n      let stepWC = Math.round(image.windowCenter / binSize)\r\n\r\n      this.setState({minHist: minHist})\r\n      this.setState({maxHist: maxHist})\r\n      this.binSize = binSize\r\n\r\n\r\n      let m = 0 // the mean\r\n      // build histogram\r\n      let hist = Array(lenHist).fill(0) \r\n      for (let y = 0; y < image.columns; y++) {\r\n        for (let x = 0; x < image.rows; x++) {\r\n          let sp = this.getPixel(x, y)\r\n          let mo = sp * image.slope + image.intercept\r\n          hist[mo-minHist] += 1\r\n          m += mo\r\n        } \r\n      }  \r\n\r\n      m = m / (image.columns * image.rows)\r\n      this.setState({mean: m})  \r\n\r\n\r\n      // calculate standard deviation\r\n      let s = 0\r\n      for (let y = 0; y < image.columns; y++)\r\n        for (let x = 0; x < image.rows; x++) {\r\n          let sp = this.getPixel(x, y)\r\n          let mo = sp * image.slope + image.intercept\r\n          s += Math.pow(mo-m, 2)\r\n        }  \r\n      s = Math.sqrt(s / (image.columns * image.rows))\r\n      this.setState({stdDev: s})\r\n\r\n      // binning the histogram \r\n      let hist256 = Array(N_BINS).fill(0) \r\n      let max = 0\r\n\r\n      if (binSize < 1) {\r\n        let binStep = Math.round(N_BINS / lenHist)\r\n        let iHist = 0\r\n        let i = 0\r\n        while (i < N_BINS) {\r\n          for (let j=0; j < binStep; j++) { \r\n            hist256[i] = iHist < lenHist ? hist[iHist] : 0\r\n            if (max < hist256[i]) max = hist256[i]  \r\n            i++\r\n          }   \r\n          iHist++     \r\n        }\r\n\r\n      } else {\r\n        let step = 0\r\n        for (let i=0; i < N_BINS; i++) {\r\n          for (let j=step; j < Math.round(step+binSize); j++) {\r\n            if (j >= lenHist) break\r\n            hist256[i] += hist[j]\r\n          }\r\n          if (max < hist256[i]) { max = hist256[i] }\r\n          step = Math.round(step+binSize)\r\n        }        \r\n      }\r\n\r\n      this.hist256 = hist256\r\n\r\n\r\n      if (max / HIST_HEIGHT > 100) max = max / 5\r\n      \r\n      const canvasH = this.canvasHistogram.current\r\n      const ctxH = this.canvasHistogram.current.getContext(\"2d\")\r\n      ctxH.clearRect(0, 0, ctxH.canvas.width, ctxH.canvas.height)\r\n\r\n      canvasH.addEventListener('pointermove', (evt) => {\r\n        const mousePos = this.getMousePos(canvasH, evt)\r\n        this.setState({histCount: hist256[mousePos.x]})\r\n        let p = Math.round(mousePos.x * this.binSize)\r\n        this.setState({valueScale: p+minHist})\r\n      }, true)\r\n      let value = Math.round((m-minHist)/binSize)\r\n      this.setState({value: value, valueScale: m, histCount: hist256[value]})\r\n      //this.setState({valueScale: m})\r\n      //this.setState({histCount: hist256[value]})\r\n\r\n      // draw WindowWidth area\r\n      ctxH.beginPath()\r\n      ctxH.fillStyle = 'rgba(210, 210, 210, 0.5)'\r\n      ctxH.fillRect(zero256-stepWW+stepWC, 0, stepWW*2, HIST_HEIGHT)\r\n\r\n      // draw histogram\r\n      ctxH.beginPath()\r\n      ctxH.strokeStyle = 'rgba(0, 0, 0, 1.0)'\r\n      for (let i = 0; i < N_BINS; i++) {\r\n        let h = Math.round((hist256[i]/max)*HIST_HEIGHT)\r\n        ctxH.moveTo(i, 0)\r\n        ctxH.lineTo(i, h)\r\n        ctxH.stroke()\r\n      }\r\n      \r\n      // draw WindowCenter cursor\r\n      ctxH.beginPath()\r\n      ctxH.strokeStyle = 'rgba(140, 140, 140, 0.5)'\r\n      ctxH.moveTo(zero256+stepWC, 0)\r\n      ctxH.lineTo(zero256+stepWC, HIST_HEIGHT)\r\n      ctxH.lineWidth = 1\r\n      ctxH.stroke()\r\n          \r\n      let lowX = zero256-stepWW+stepWC\r\n      let highX = zero256+stepWW+stepWC\r\n\r\n      // draw gradient scale\r\n      const canvasG = this.canvasGradient.current\r\n      const ctxG = canvasG.getContext(\"2d\")\r\n\r\n      ctxG.fillStyle = \"#000000\"\r\n      ctxG.fillRect(0, 0, lowX, 10)\r\n\r\n      let grd = ctxG.createLinearGradient(lowX, 0, highX+(lowX < 0 ? lowX : 0), 0)\r\n      grd.addColorStop(0, \"black\")\r\n      grd.addColorStop(1, \"white\")\r\n      ctxG.fillStyle = grd\r\n      ctxG.fillRect(lowX, 0, highX, 10)\r\n    }\r\n        \r\n    handleChangeValue = (event, newValue) => {\r\n      this.setState({value: newValue})\r\n      this.setState({valueScale: (newValue*this.binSize)+this.state.minHist})\r\n      this.setState({histCount: this.hist256[newValue]})\r\n    }\r\n      \r\n    hide = () => {\r\n      this.props.onClose()\r\n    }\r\n    \r\n    onDrag = (e, ui) => {\r\n      const {x, y} = this.state.deltaPosition;\r\n      this.setState({\r\n        deltaPosition: {\r\n          x: x + ui.deltaX,\r\n          y: y + ui.deltaY,\r\n        }\r\n      })\r\n    }\r\n  \r\n    onStart = () => {\r\n      this.setState({activeDrags: this.state.activeDrags+1})\r\n    }\r\n  \r\n    onStop = () => {\r\n      this.setState({activeDrags: this.state.activeDrags-1})\r\n    }\r\n    \r\n    render() {\r\n      return (\r\n        <div style={style}>\r\n          <div>\r\n            <canvas \r\n              ref={this.canvasHistogram} \r\n              width={HIST_WIDTH} \r\n              height={HIST_HEIGHT} \r\n              style={{backgroundColor: \"#FFFFFF\", cursor:'crosshair'}} \r\n            />\r\n          </div>  \r\n          <div style={styleCanvasGradient}>\r\n            <canvas ref={this.canvasGradient} width={HIST_WIDTH} height={10} style={{backgroundColor: \"#FFFFFF\"}} />\r\n          </div>\r\n          <div style={styleSlider}>\r\n            <Slider\r\n              value={this.state.value}\r\n              onChange={this.handleChangeValue}\r\n              aria-labelledby=\"continuous-slider\"\r\n              color=\"secondary\"\r\n              min={0}\r\n              max={255}\r\n            />\r\n          </div>\r\n          <div>\r\n            <table style={styleTable}>\r\n              <tbody>\r\n                <tr>\r\n                  <td style={styleTableTd}>min:</td>\r\n                  <td style={styleTableTd}>{this.state.minHist}</td>\r\n                  <td style={styleTableTd}>max:</td>\r\n                  <td style={styleTableTd}>{this.state.maxHist}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td>mean:</td>\r\n                  <td>{parseFloat(this.state.mean).toFixed(3)}</td>\r\n                  <td>std dev:</td>\r\n                  <td>{parseFloat(this.state.stdDev).toFixed(3)}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td>count:</td>\r\n                  <td>{this.state.histCount}</td>\r\n                  <td>value:</td>\r\n                  <td>{parseFloat(this.state.valueScale).toFixed(3)}</td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n      </div>\r\n      )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    activeDcmIndex: state.activeDcmIndex,\r\n    activeDcm: state.activeDcm,\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps)(Histogram)\r\n","import React, { PureComponent } from 'react'\r\n\r\nconst styleTable = {\r\n  borderCollapse: 'collapse',\r\n  width: '100px',\r\n  height: '100px',\r\n}\r\n\r\nconst styleTableTd = {\r\n  width: '25px',\r\n  height: '25px',\r\n  border: 'solid 1px black',\r\n}\r\n\r\nclass LayoutTool extends PureComponent {\r\n    constructor(props) {\r\n      super(props)\r\n      this.tableRef = React.createRef()\r\n      this.state = {\r\n        row: this.props.row,\r\n        col: this.props.col,\r\n      }\r\n    }\r\n\r\n    componentDidMount() {\r\n      this.initTable()\r\n    }\r\n\r\n    initTable = () => {\r\n      let row = this.state.row\r\n      let col = this.state.col\r\n      let rows = this.tableRef.current.rows\r\n      for (let i=0; i <= row; i++) {\r\n        for(let j=0; j <= col; j++) {\r\n          rows[i].cells[j].bgColor = '#AAAAAA'\r\n        }\r\n      }\r\n    }\r\n\r\n    cellClick = (e) => {\r\n      let row = e.target.parentNode.rowIndex\r\n      let col = e.target.cellIndex\r\n\r\n      this.setState({row: row, col: col})\r\n\r\n      let rows = this.tableRef.current.rows\r\n      for (let i=0; i <= 3; i++) {\r\n        for(let j=0; j <= 3; j++) {\r\n          rows[i].cells[j].bgColor = '#444444'\r\n        }\r\n      }\r\n      for (let i=0; i <= row; i++) {\r\n        for(let j=0; j <= col; j++) {\r\n          rows[i].cells[j].bgColor = '#AAAAAA'\r\n        }\r\n      }\r\n      this.props.onChange(row+1, col+1)\r\n    }\r\n\r\n    renderTable() {\r\n      const rows = ['', '', '', '']\r\n      return (\r\n        rows.map((row, i) => {\r\n          return (\r\n            <tr key={`${i}`}>\r\n               <td style={styleTableTd} onClick={this.cellClick} />\r\n               <td style={styleTableTd} onClick={this.cellClick} />\r\n               <td style={styleTableTd} onClick={this.cellClick} />\r\n               <td style={styleTableTd} onClick={this.cellClick} />\r\n            </tr>\r\n          )\r\n        })\r\n      )\r\n   }\r\n\r\n    render() {  \r\n      return (\r\n          <div>            \r\n            <table style={styleTable} ref={this.tableRef}>\r\n              <tbody>\r\n                {this.renderTable()}                   \r\n              </tbody>\r\n            </table>\r\n          </div>     \r\n      )\r\n    }\r\n\r\n}\r\n\r\nexport default LayoutTool\r\n","import React, { PureComponent } from 'react'\r\nimport Icon from '@mdi/react'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\n\r\nimport { \r\n    mdiAngleAcute,\r\n    mdiArrowAll,\r\n    mdiArrowSplitHorizontal,\r\n    mdiCheckboxIntermediate,\r\n    mdiCursorDefault, \r\n    mdiCursorPointer,\r\n    mdiEllipse,\r\n    mdiEyedropper,\r\n    mdiGesture,\r\n    mdiMagnify,\r\n    mdiRectangle,\r\n    mdiRuler,\r\n    mdiVectorLink,\r\n  } from '@mdi/js'\r\n\r\nconst styleTable = {\r\n  borderCollapse: 'collapse',\r\n  width: '120px',\r\n  height: '120px',\r\n}\r\n\r\nconst styleTableTd = {\r\n  width: '40px',\r\n  height: '40px',\r\n  padding: '3px',\r\n  //border: 'solid 1px black',\r\n}\r\n\r\nconst iconSize = '1.2rem'\r\nconst iconColor = '#FFFFFF'\r\nconst activeColor = 'rgba(0, 255, 0, 1.0)'\r\n\r\nclass ToolsPanel extends PureComponent {\r\n    constructor(props) {\r\n      super(props)\r\n      this.tableRef = React.createRef()\r\n    }\r\n\r\n    componentDidMount() {\r\n      \r\n    }\r\n\r\n    colorIcon = (tool) => {\r\n        return this.props.toolActive === tool ? activeColor : iconColor\r\n    }\r\n    \r\n    render() {  \r\n      return (\r\n        <div>            \r\n            <table style={styleTable} ref={this.tableRef}>\r\n                <tbody>\r\n                <tr>\r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"No Tool\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('notool')}>\r\n                                <Icon path={mdiCursorDefault} size={iconSize} color={this.colorIcon('notool')} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>\r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"Reference Lines\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('referencelines')}>\r\n                                <Icon path={mdiArrowSplitHorizontal} size={iconSize} color={this.props.referenceLines ? activeColor : iconColor} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>\r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"Link Series\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('serieslink')}>\r\n                                <Icon path={mdiVectorLink} size={iconSize} color={this.props.seriesLink ? activeColor : iconColor} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>                    \r\n                </tr>   \r\n                <tr>\r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"WW/WC\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('Wwwc')}>\r\n                                <Icon path={mdiArrowAll} size={iconSize} color={this.colorIcon('Wwwc')} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>    \r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"Pan\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('Pan')}>\r\n                                <Icon path={mdiCursorPointer} size={iconSize} color={this.colorIcon('Pan')} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>\r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"Zoom\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('Zoom')}>\r\n                                <Icon path={mdiMagnify} size={iconSize} color={this.colorIcon('Zoom')} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>                                    \r\n                </tr>                   \r\n                <tr>\r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"Magnify\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('Magnify')}>\r\n                                <Icon path={mdiCheckboxIntermediate} size={iconSize} color={this.colorIcon('Magnify')} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>   \r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"Length\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('Length')}>\r\n                                <Icon path={mdiRuler} size={iconSize} color={this.colorIcon('Length')} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>\r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"Probe\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('Probe')}>\r\n                                <Icon path={mdiEyedropper} size={iconSize} color={this.colorIcon('Probe')} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>                    \r\n                </tr> \r\n                <tr>\r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"Angle\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('Angle')}>\r\n                                <Icon path={mdiAngleAcute} size={iconSize} color={this.colorIcon('Angle')} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>   \r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"Elliptical Roi\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('EllipticalRoi')}>\r\n                                <Icon path={mdiEllipse} size={iconSize} color={this.colorIcon('EllipticalRoi')} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>\r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"Rectangle Roi\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('RectangleRoi')}>\r\n                                <Icon path={mdiRectangle} size={iconSize} color={this.colorIcon('RectangleRoi')} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>                    \r\n                </tr> \r\n                <tr>\r\n                    <td style={styleTableTd}>\r\n                        <Tooltip title=\"Freehand Roi\">\r\n                            <IconButton color=\"inherit\" onClick={() => this.props.toolExecute('FreehandRoi')}>\r\n                                <Icon path={mdiGesture} size={iconSize} color={this.colorIcon('FreehandRoi')} />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </td>  \r\n                </tr>                                                               \r\n                </tbody>\r\n            </table>\r\n        </div>     \r\n      )\r\n    }\r\n\r\n}\r\n\r\nexport default ToolsPanel\r\n","import React, { PureComponent } from 'react'\r\nimport {connect} from 'react-redux'\r\nimport Button from '@material-ui/core/Button'\r\nimport CreateIcon from '@material-ui/icons/Create'\r\nimport DeleteIcon from '@material-ui/icons/Delete'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport DialogContent from '@material-ui/core/DialogContent'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport ListItem from '@material-ui/core/ListItem'\r\nimport ListItemText from '@material-ui/core/ListItemText'\r\nimport TextField from '@material-ui/core/TextField'\r\nimport Toolbar from '@material-ui/core/Toolbar'\r\nimport { withStyles } from '@material-ui/core/styles'\r\n\r\nconst styles = theme => ({\r\n    listItemText:{\r\n        fontSize:'0.9em',\r\n    }\r\n})\r\n\r\nclass MeasureItem extends PureComponent {\r\n\r\n    constructor(props) {\r\n        super(props)\r\n        this.noteField = React.createRef()\r\n    \r\n      }\r\n\r\n    state = { \r\n        visibleDlgNote: false,\r\n        visibleDlgDelete: false,\r\n    }\r\n\r\n    showDlgNote = () => {\r\n        this.setState({ visibleDlgNote: true })\r\n    }\r\n    \r\n    hideDlgNote = () => {\r\n        this.setState({ visibleDlgNote: false })\r\n    }\r\n\r\n    showDlgDelete = () => {\r\n        this.setState({ visibleDlgDelete: true })\r\n    }\r\n    \r\n    hideDlgDelete = () => {\r\n        this.setState({ visibleDlgDelete: false })\r\n    }\r\n\r\n    handleOnChangeNote = event => {\r\n        this.setState({ note: event.target.value })\r\n    }\r\n\r\n    confirmNote = (index) => {\r\n        this.hideDlgNote()\r\n        this.props.measurements[index].note = this.noteField.value\r\n    }   \r\n\r\n    confirmDelete = (index) => {\r\n        this.hideDlgDelete()\r\n        this.props.toolRemove(index)\r\n    }\r\n\r\n    onEdit = () => {\r\n        this.showDlgNote()\r\n    }\r\n    \r\n    onDelete = () => {\r\n        this.showDlgDelete()\r\n    }\r\n    \r\n    render() {    \r\n        const { classes } = this.props\r\n\r\n        const item = this.props.item\r\n        let index = this.props.index\r\n        let pText = ''\r\n        let sText = ''\r\n        switch (item.tool) {\r\n            case 'Length':\r\n                pText = `${item.data.length.toFixed(2)} ${item.data.unit}`\r\n                sText = item.note\r\n                break\r\n            case 'Angle':\r\n                pText = `${item.data.rAngle} °`\r\n                sText = item.note\r\n                break\r\n            case 'EllipticalRoi':\r\n                pText = <div>\r\n                            <div> A: {item.data.cachedStats.area.toFixed(2)} mm² </div>\r\n                            <div> M: {item.data.cachedStats.mean.toFixed(2)} {item.data.unit} </div>\r\n                            <div> SD: {item.data.cachedStats.stdDev.toFixed(2)} {item.data.unit} </div>\r\n                        </div>\r\n                sText = item.note            \r\n                break    \r\n            case 'RectangleRoi':\r\n                pText = <div>\r\n                            <div> A: {item.data.cachedStats.area.toFixed(2)} mm² </div>\r\n                            <div> M: {item.data.cachedStats.mean.toFixed(2)} {item.data.unit} </div>\r\n                            <div> SD: {item.data.cachedStats.stdDev.toFixed(2)} {item.data.unit} </div>\r\n                        </div>\r\n                sText = item.note\r\n                break          \r\n            case 'FreehandRoi':\r\n                //if (item.data.area !== undefined) {\r\n                pText = <div>\r\n                            <div> A: {item.data.area.toFixed(2)} mm² </div>\r\n                            <div> M: {item.data.meanStdDev.mean.toFixed(2)} {item.data.unit} </div>\r\n                            <div> SD: {item.data.meanStdDev.stdDev.toFixed(2)} {item.data.unit} </div>\r\n                        </div>\r\n                sText = item.note\r\n                //}\r\n                break                                  \r\n            default:\r\n                break    \r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <ListItem>\r\n                    <ListItemText classes={{primary:classes.listItemText}} primary={pText} secondary={sText} />\r\n                    <Toolbar>\r\n                        <IconButton edge=\"end\" onClick={() => this.onEdit(index)}>\r\n                            <CreateIcon />\r\n                        </IconButton>\r\n                        <IconButton edge=\"end\" onClick={() => this.onDelete(index)}>\r\n                            <DeleteIcon />\r\n                        </IconButton>\r\n                    </Toolbar>\r\n                </ListItem>\r\n                \r\n                { this.state.visibleDlgNote ?\r\n                    <Dialog\r\n                        open={this.state.visibleDlgNote}\r\n                        onClose={this.hideDlgNote}\r\n                        aria-labelledby=\"form-dialog-title\"\r\n                    >\r\n                        <DialogTitle id=\"form-dialog-title\">{\"Note for measurement:\"}</DialogTitle>\r\n                        <DialogContent>\r\n                            <TextField\r\n                                ref=\"noteField\"\r\n                                autoFocus\r\n                                margin=\"dense\"\r\n                                id=\"note\"\r\n                                fullWidth\r\n                                defaultValue={this.props.measurements[index].note}\r\n                                inputRef={input => (this.noteField = input)}\r\n                            />\r\n                        </DialogContent>\r\n                        <DialogActions>\r\n                            <Button onClick={this.hideDlgNote} >\r\n                                Cancel\r\n                            </Button>\r\n                            <Button onClick={() => this.confirmNote(index)} autoFocus>\r\n                                Ok\r\n                            </Button>\r\n                        </DialogActions>\r\n                    </Dialog>\r\n                : null }\r\n\r\n                <Dialog\r\n                    open={this.state.visibleDlgDelete}\r\n                    onClose={this.hideDlgNote}\r\n                    aria-labelledby=\"alert-dialog-title\"\r\n                >\r\n                    <DialogTitle id=\"alert-dialog-title\">{\"Are you sure to delete the measurement?\"}</DialogTitle>\r\n                    <DialogActions>\r\n                        <Button onClick={this.hideDlgDelete}>\r\n                            Cancel\r\n                        </Button>\r\n                        <Button onClick={() => this.confirmDelete(index)} autoFocus>\r\n                            Ok\r\n                        </Button>\r\n                    </DialogActions>\r\n                </Dialog>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        measurements: state.measurements,\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps)(withStyles(styles)(MeasureItem))\r\n","import React, { PureComponent } from 'react'\r\nimport {connect} from 'react-redux'\r\nimport Button from '@material-ui/core/Button'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport MeasureItem from './MeasureItem'\r\n\r\nclass Measurements extends PureComponent {\r\n\r\n  state = { \r\n    visibleClearMeasureDlg: false,\r\n  }\r\n\r\n  showClearMeasureDlg = () => {\r\n    this.setState({ visibleClearMeasureDlg: true })\r\n  }\r\n\r\n  hideClearMeasureDlg = () => {\r\n      this.setState({ visibleClearMeasureDlg: false })\r\n  }\r\n\r\n  confirmClearMeasureDlg = () => {\r\n    this.hideClearMeasureDlg()\r\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('removetools')\r\n  }\r\n\r\n  render() {   \r\n    //const classes = this.props.classes\r\n\r\n    return (\r\n      <div>\r\n\r\n        <div>\r\n          { this.props.measurements !== null ?\r\n              this.props.measurements.map((item, index) => {\r\n                  return <MeasureItem item={item} index={index} toolRemove={this.props.toolRemove} key={index} />\r\n              }) \r\n            : null }\r\n        </div>\r\n        \r\n        <Dialog\r\n            open={this.state.visibleClearMeasureDlg}\r\n            onClose={this.hideClearMeasureDlg}\r\n            aria-labelledby=\"alert-dialog-title\"\r\n        >\r\n            <DialogTitle id=\"alert-dialog-title\">{\"Are you sure to remove all the measurements?\"}</DialogTitle>\r\n            <DialogActions>\r\n                <Button onClick={this.hideClearMeasureDlg}>\r\n                    Cancel\r\n                </Button>\r\n                <Button onClick={this.confirmClearMeasureDlg} autoFocus>\r\n                    Ok\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n\r\n      </div>\r\n    )\r\n  }\r\n\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    measurements: state.measurements,\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps)(Measurements)\r\n","import React from 'react'\r\nimport { makeStyles } from '@material-ui/core/styles'\r\nimport AppBar from '@material-ui/core/AppBar'\r\nimport Checkbox from '@material-ui/core/Checkbox'\r\nimport CloseIcon from '@material-ui/icons/Close'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\r\nimport FormControl from '@material-ui/core/FormControl'\r\nimport FormLabel from '@material-ui/core/FormLabel'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport Radio from '@material-ui/core/Radio'\r\nimport RadioGroup from '@material-ui/core/RadioGroup'\r\nimport Toolbar from '@material-ui/core/Toolbar'\r\nimport Typography from '@material-ui/core/Typography'\r\nimport 'react-perfect-scrollbar/dist/css/styles.css'\r\nimport PerfectScrollbar from 'react-perfect-scrollbar'\r\nimport { \r\n  getSettingsSaveAs, \r\n  setSettingsSaveAs, \r\n  getSettingsSaveInto,\r\n  setSettingsSaveInto,\r\n  getSettingsDcmHeader, \r\n  setSettingsDcmHeader, \r\n  getSettingsOverlay, \r\n  setSettingsOverlay,\r\n  getSettingsFsView,\r\n  setSettingsFsView,\r\n  getSettingsDicomdirView,\r\n  setSettingsDicomdirView,\r\n  getSettingsMprInterpolation,\r\n  setSettingsMprInterpolation,\r\n} from '../functions'\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  appBar: {\r\n    position: 'relative',\r\n  },\r\n  formControl: {\r\n    margin: theme.spacing(3),\r\n  },\r\n  formLabel: {\r\n    fontSize: '0.85em',\r\n  },\r\n  radioControl: {\r\n    size: 'small',\r\n  },  \r\n  title: {\r\n    marginLeft: theme.spacing(2),\r\n    flex: 1,\r\n    fontSize: '0.95em',\r\n  },\r\n}))\r\n\r\nconst Settings = ({ onClose }) => {\r\n  \r\n  let saveAs = getSettingsSaveAs()\r\n  let saveInto = getSettingsSaveInto()\r\n  let exportAs = getSettingsDcmHeader()\r\n  let overlay = getSettingsOverlay()\r\n  let fsView = getSettingsFsView()\r\n  let dicomdirView = getSettingsDicomdirView()\r\n  let mprInterpolation = getSettingsMprInterpolation()\r\n  \r\n  const handleChangeSaveAs = event => {\r\n    setState({ ...state, 'saveAs': event.target.value })\r\n    setSettingsSaveAs(event.target.value)\r\n  }\r\n  \r\n  const handleChangeSaveInto = event => {\r\n    setState({ ...state, 'saveInto': event.target.value })\r\n    setSettingsSaveInto(event.target.value)\r\n  }\r\n\r\n  const handleChangeExportAs = event => {\r\n    setState({ ...state, 'exportAs': event.target.value })\r\n    setSettingsDcmHeader(event.target.value)\r\n  }\r\n\r\n  const handleChangeOverlay = event => {\r\n    setState({ ...state, 'overlay': event.target.checked })\r\n    setSettingsOverlay(event.target.checked)\r\n  }\r\n\r\n  const handleChangeFsView = event => {\r\n    setState({ ...state, 'fsView': event.target.value })\r\n    setSettingsFsView(event.target.value)\r\n  }\r\n\r\n  const handleChangeDicomdirView = event => {\r\n    setState({ ...state, 'dicomdirView': event.target.value })\r\n    setSettingsDicomdirView(event.target.value)\r\n  }  \r\n\r\n  const handleChangeMprInterpolation = event => {\r\n    setState({ ...state, 'mprInterpolation': event.target.value })\r\n    setSettingsMprInterpolation(event.target.value)\r\n  }  \r\n  const classes = useStyles()\r\n\r\n  const [state, setState] = React.useState({\r\n    saveAs: saveAs,\r\n    saveInto: saveInto,\r\n    exportAs: exportAs,\r\n    overlay: overlay,\r\n    fsView: fsView,\r\n    dicomdirView: dicomdirView,\r\n    mprInterpolation: mprInterpolation,\r\n  })\r\n\r\n  return (\r\n    <Dialog fullScreen open={true} onClose={onClose}> {/* TransitionComponent={Transition} */}\r\n      <AppBar className={classes.appBar} elevation={0}>\r\n        <Toolbar variant=\"dense\">\r\n          <IconButton edge=\"start\" color=\"inherit\" onClick={onClose} aria-label=\"close\">\r\n            <CloseIcon />\r\n          </IconButton>\r\n          <Typography variant=\"h6\" className={classes.title}>\r\n            Settings\r\n          </Typography>\r\n        </Toolbar>\r\n      </AppBar>\r\n      <PerfectScrollbar> \r\n      <div>\r\n        <div>\r\n        <FormControl component=\"fieldset\" className={classes.formControl}>\r\n          <FormControlLabel\r\n            control={\r\n              <Checkbox \r\n                checked={state.overlay} \r\n                onChange={handleChangeOverlay}\r\n                value=\"overlay\" \r\n                size='small'\r\n              />\r\n            }\r\n            label=\"Show overlay Information\"\r\n          />\r\n        </FormControl>\r\n        </div>\r\n        <div>\r\n        <FormControl component=\"fieldset\" className={classes.formControl}>\r\n          <FormLabel component=\"legend\" className={classes.formLabel}>Open sandbox file system from:</FormLabel>\r\n          <RadioGroup size='small' aria-label=\"filesystem\" name=\"filesystem\" value={state.fsView} onChange={handleChangeFsView}>\r\n            <FormControlLabel value=\"left\" control={<Radio size='small' />} label=\"left\" />\r\n            <FormControlLabel value=\"right\" control={<Radio size='small' />} label=\"right\" />\r\n            <FormControlLabel value=\"bottom\" control={<Radio size='small' />} label=\"bottom\" />\r\n          </RadioGroup>\r\n        </FormControl>    \r\n        </div>\r\n        <div>\r\n        <FormControl component=\"fieldset\" className={classes.formControl}>\r\n          <FormLabel component=\"legend\" className={classes.formLabel}>Open DICOMDIR panel from:</FormLabel>\r\n          <RadioGroup size='small' aria-label=\"dicomdir\" name=\"dicomdir\" value={state.dicomdirView} onChange={handleChangeDicomdirView}>\r\n            <FormControlLabel value=\"left\" control={<Radio size='small' />} label=\"left\" />\r\n            <FormControlLabel value=\"right\" control={<Radio size='small' />} label=\"right\" />\r\n            <FormControlLabel value=\"bottom\" control={<Radio size='small' />} label=\"bottom\" />\r\n          </RadioGroup>\r\n        </FormControl>                    \r\n        </div>\r\n        <div>\r\n        <FormControl component=\"fieldset\" className={classes.formControl}>\r\n          <FormLabel component=\"legend\" className={classes.formLabel}>Save screenshot as:</FormLabel>\r\n          <RadioGroup aria-label=\"saveas\" name=\"saveas\" value={state.saveAs} onChange={handleChangeSaveAs}>\r\n            <FormControlLabel value=\"jpeg\" control={<Radio size='small' />} label=\"JPEG\" />\r\n            <FormControlLabel value=\"png\" control={<Radio size='small' />} label=\"PNG\" />\r\n          </RadioGroup>\r\n        </FormControl>\r\n        </div>\r\n        <div>\r\n        <FormControl component=\"fieldset\" className={classes.formControl}>\r\n          <FormLabel component=\"legend\" className={classes.formLabel}>Save screenshot into:</FormLabel>\r\n          <RadioGroup aria-label=\"saveinto\" name=\"saveinto\" value={state.saveInto} onChange={handleChangeSaveInto}>\r\n            <FormControlLabel value=\"local\" control={<Radio size='small' />} label=\"local file system\" />\r\n            <FormControlLabel value=\"sandbox\" control={<Radio size='small' />} label=\"sandbox file system\" />\r\n          </RadioGroup>\r\n        </FormControl>          \r\n        </div>\r\n        <div>\r\n        <FormControl component=\"fieldset\" className={classes.formControl}>\r\n          <FormLabel component=\"legend\" className={classes.formLabel}>Export Dicom header as:</FormLabel>\r\n          <RadioGroup aria-label=\"exportas\" name=\"exportas\" value={exportAs} onChange={handleChangeExportAs}>\r\n            <FormControlLabel value=\"json\" control={<Radio size='small' />} label=\"JSON\" />\r\n            <FormControlLabel value=\"csv\" control={<Radio size='small' />} label=\"CSV\" />\r\n          </RadioGroup>\r\n        </FormControl> \r\n        </div> \r\n        <div>\r\n        <FormControl component=\"fieldset\" className={classes.formControl}>\r\n          <FormLabel component=\"legend\" className={classes.formLabel}>MPR interpolation method:</FormLabel>\r\n          <RadioGroup aria-label=\"mprinterpolation\" name=\"mprinterpolation\" value={mprInterpolation} onChange={handleChangeMprInterpolation}>\r\n            <FormControlLabel value=\"no\" control={<Radio size='small' />} label=\"No interpolation (duplicate planes)\" />\r\n            <FormControlLabel value=\"weightedlinear\" control={<Radio size='small' />} label=\"Weighted linear interpolation\" />\r\n          </RadioGroup>\r\n        </FormControl> \r\n        </div>            \r\n      </div>\r\n      </PerfectScrollbar>\r\n    </Dialog>\r\n  )\r\n\r\n}\r\n\r\nexport default Settings\r\n","import React, { PureComponent } from 'react'\r\nimport { withStyles } from '@material-ui/core/styles'\r\nimport {connect} from 'react-redux'\r\nimport AboutDlg from './components/AboutDlg'\r\nimport Dicomdir from './components/Dicomdir'\r\nimport DicomViewer from './components/DicomViewer'\r\nimport DicomHeader from './components/DicomHeader'\r\nimport DownloadZipDlg from './components/DownloadZipDlg'\r\nimport Explorer from './components/Explorer'\r\nimport FsUI from './components/FsUI'\r\nimport Histogram from './components/Histogram'\r\nimport LayoutTool from './components/LayoutTool'\r\nimport ToolsPanel from './components/ToolsPanel'\r\nimport Measurements from './components/Measurements'\r\nimport OpenMultipleFilesDlg from './components/OpenMultipleFilesDlg'\r\nimport Settings from './components/Settings'\r\nimport AppBar from '@material-ui/core/AppBar'\r\nimport Collapse from '@material-ui/core/Collapse'\r\nimport Button from '@material-ui/core/Button'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport DialogContent from '@material-ui/core/DialogContent'\r\nimport DialogContentText from '@material-ui/core/DialogContentText'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport Divider from '@material-ui/core/Divider'\r\nimport Drawer from '@material-ui/core/Drawer'\r\nimport ExpandLess from '@material-ui/icons/ExpandLess'\r\nimport ExpandMore from '@material-ui/icons/ExpandMore'\r\nimport Icon from '@mdi/react'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport List from '@material-ui/core/List'\r\nimport ListItem from '@material-ui/core/ListItem'\r\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\r\nimport ListItemText from '@material-ui/core/ListItemText'\r\nimport MenuIcon from '@material-ui/icons/Menu'\r\nimport Popover from '@material-ui/core/Popover'\r\nimport Slider from '@material-ui/core/Slider'\r\nimport Snackbar from '@material-ui/core/Snackbar'\r\nimport TextField from '@material-ui/core/TextField'\r\nimport Toolbar from '@material-ui/core/Toolbar'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\nimport Typography from '@material-ui/core/Typography'\r\nimport 'react-perfect-scrollbar/dist/css/styles.css'\r\nimport PerfectScrollbar from 'react-perfect-scrollbar'\r\n\r\n\r\nimport { \r\n  isMobile, \r\n  isTablet,\r\n} from 'react-device-detect'\r\n\r\nimport {\r\n  clearStore,\r\n  localFileStore,\r\n  dcmIsOpen,\r\n  activeDcm,\r\n  activeDcmIndex,\r\n  activeMeasurements,\r\n  setLayout,\r\n  dcmTool, \r\n  setDicomdir,\r\n  setZippedFile,\r\n  setVolume,\r\n  filesStore,\r\n  explorerActiveSeriesIndex,\r\n} from './actions/index'\r\n\r\nimport { \r\n  log,\r\n  getDicomPixelSpacing,\r\n  getDicomSpacingBetweenSlice,\r\n  getDicomSliceThickness,\r\n  getDicomSliceLocation,\r\n  getDicomStudyId,\r\n  getDicomIpp,\r\n  getDicomEchoNumber,\r\n  getFileExtReal,\r\n  isInputDirSupported,\r\n  getSettingsFsView,\r\n  getSettingsDicomdirView,\r\n  getSettingsMprInterpolation,\r\n  getDicomImageXOnRows,\r\n  groupBy,\r\n  objectIsEmpty,\r\n} from './functions'\r\n\r\nimport { \r\n  mdiAngleAcute,\r\n  mdiAnimationOutline,\r\n  mdiArrowAll,\r\n  mdiArrowSplitHorizontal,\r\n  mdiAxisArrow,\r\n  mdiCamera,\r\n  mdiChartHistogram,\r\n  mdiCheck,\r\n  mdiCheckboxIntermediate,\r\n  mdiContentSaveOutline,   \r\n  mdiCursorDefault, \r\n  mdiCursorPointer,\r\n  mdiDelete,\r\n  mdiEllipse,\r\n  mdiEyedropper,\r\n  mdiFileCabinet,\r\n  mdiFileDocument, \r\n  mdiFileCad, \r\n  mdiFolder,\r\n  mdiFolderMultiple,\r\n  mdiGesture,\r\n  mdiCog,\r\n  mdiViewGridPlusOutline,\r\n  mdiImageEdit,\r\n  mdiInformationOutline,\r\n  mdiInvertColors,\r\n  mdiMagnify,\r\n  mdiFolderOpen,\r\n  mdiRefresh,\r\n  mdiRectangle,\r\n  mdiRuler,\r\n  //mdiToolbox,\r\n  mdiTools,\r\n  mdiTrashCanOutline, \r\n  mdiVectorLink,\r\n  mdiVideo,\r\n  // mdiWeb,\r\n  mdiPlay,\r\n  mdiPause,\r\n  mdiSkipBackward,\r\n  mdiSkipForward,\r\n  mdiSkipNext,\r\n  mdiSkipPrevious,\r\n} from '@mdi/js'\r\n\r\nimport './App.css'\r\n\r\nlog()\r\n\r\n//localStorage.setItem(\"debug\", \"cornerstoneTools\")\r\n\r\nconst drawerWidth = 240\r\nconst iconColor = '#FFFFFF'\r\nconst iconColor1 = '#1aa3ff'\r\nconst activeColor = 'rgba(0, 255, 0, 1.0)'\r\n\r\nconst styles = theme => ({\r\n  '@global': {\r\n    body: {\r\n        backgroundColor: theme.palette.common.black,\r\n    },\r\n  },\r\n\r\n  grow: {\r\n    flexGrow: 1,\r\n  },\r\n\r\n  root: {\r\n    display: 'flex',\r\n  },\r\n\r\n  menuButton: {\r\n    marginRight: theme.spacing(2),\r\n  },\r\n\r\n  title: {\r\n    flexGrow: 1,\r\n  },\r\n  \r\n\r\n  appBar: {\r\n    position: 'relative',\r\n    BorderRadius: '0px 0px 10px 10px',\r\n    zIndex: theme.zIndex.drawer + 1,\r\n    transition: theme.transitions.create(['width', 'margin'], {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n  },\r\n\r\n  appBarShift: {\r\n    marginLeft: drawerWidth,\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    transition: theme.transitions.create(['width', 'margin'], {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  },\r\n\r\n  hide: {\r\n    display: 'none',\r\n  },\r\n\r\n  drawer: {\r\n    width: drawerWidth,\r\n    flexShrink: 0,\r\n    whiteSpace: 'nowrap',\r\n  },\r\n\r\n  drawerOpen: {\r\n    width: drawerWidth,\r\n    transition: theme.transitions.create('width', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  },\r\n\r\n  drawerClose: {\r\n    transition: theme.transitions.create('width', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n    overflowX: 'hidden',\r\n    width: theme.spacing(7) + 1,\r\n    [theme.breakpoints.up('sm')]: {\r\n      width: theme.spacing(9) + 1,\r\n    },\r\n  },\r\n\r\n  // Loads information about the app bar, including app bar height\r\n  toolbar: theme.mixins.toolbar,\r\n\r\n  content: {\r\n    flexGrow: 1,\r\n    padding: theme.spacing(3),\r\n  },\r\n\r\n  listItemText: {\r\n    fontSize: '0.85em',\r\n    marginLeft: '-20px',\r\n  },\r\n\r\n})\r\n\r\nclass App extends PureComponent {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.files = []\r\n    this.folder = null\r\n    this.file = null\r\n    this.url = null\r\n    this.explorer = null\r\n    this.series = null\r\n  \r\n    this.mprData = {}\r\n    this.mprPlane = ''\r\n    this.echoNumber = 0\r\n    \r\n    this.volume = []\r\n\r\n    this.fileOpen = React.createRef()\r\n    this.showFileOpen = this.showFileOpen.bind(this)\r\n\r\n    this.openDicomdir = React.createRef()\r\n    this.showOpenDicomdir = this.showOpenDicomdir.bind(this)\r\n\r\n    this.openFolder = React.createRef()\r\n    this.showOpenFolder = this.showOpenFolder.bind(this)    \r\n\r\n    this.openUrlField = React.createRef()\r\n    \r\n    this.dicomViewersActive = []\r\n    this.dicomViewersActiveSameStudy = []\r\n    this.dicomViewersActiveSamePlane = []\r\n    this.dicomViewersRefs = []\r\n    this.dicomViewers = []\r\n    for(let i=0; i < 16; i++) {\r\n      this.dicomViewers.push(this.setDcmViewer(i))\r\n    }\r\n\r\n    this.activeDcmViewersNum = 0\r\n\r\n    this.referenceLines = {}\r\n    \r\n  }\r\n\r\n  state = {\r\n    anchorElLayout: null,   \r\n    anchorElToolsPanel: null,   \r\n    openMenu: false,\r\n    openImageEdit: false,\r\n    openTools: false,\r\n    mprMenu: false,\r\n    mprMode: false,\r\n    textMessage: '',\r\n    titleMessage: '',\r\n    visibleMainMenu: true,\r\n    visibleHeader: false,\r\n    visibleSettings: false,\r\n    visibleToolbar: true,\r\n    visibleOpenUrl: false,\r\n    visibleToolbox: false,\r\n    visibleTools: false,\r\n    visibleMeasure: false,\r\n    visibleClearMeasureDlg: false,\r\n    visibleAbout: false,\r\n    visibleDicomdir: false,\r\n    visibleFileManager: false,\r\n    visibleZippedFileDlg: false,\r\n    visibleDownloadZipDlg: false,\r\n    visibleOpenMultipleFilesDlg: false,\r\n    toolState: 1,\r\n    toolActive: 'notool',\r\n    sliceIndex: 0,\r\n    sliceMax: 1,\r\n    listOpenFilesScrolling: false,\r\n    visibleVolumeBuilding: false,\r\n    visibleMpr3D: false,\r\n    visibleMprOrthogonal: false,\r\n    visibleMprCoronal: false,\r\n    visibleMprSagittal: false,\r\n    visibleMprAxial: false,\r\n    visibleExplorer: false,\r\n    visibleMessage: false,\r\n    visibleReferenceLines: true,\r\n    visibleSeriesLink: true,\r\n  }\r\n\r\n  setDcmViewer = (index) => {\r\n    return (\r\n      <DicomViewer \r\n        dcmRef={(ref) => {this.dicomViewersRefs[index] = ref}}\r\n        index={index}\r\n        dicomViewersRefs={this.dicomViewersRef}\r\n        runTool={ref => (this.runTool = ref)} \r\n        changeTool={ref => (this.changeTool = ref)}\r\n        onLoadedImage={this.onLoadedImage}\r\n        onRenderedImage={this.onRenderedImage}\r\n        listOpenFilesPreviousFrame={this.listOpenFilesPreviousFrame}\r\n        listOpenFilesNextFrame={this.listOpenFilesNextFrame}\r\n        overlay={true}\r\n        visible={true}\r\n      />   \r\n    )\r\n  }\r\n\r\n  onLoadedImage = () => {\r\n\r\n  }\r\n\r\n  onRenderedImage = (index) => {\r\n    if (this.referenceLines.crossViewer !== undefined && \r\n        this.state.visibleReferenceLines \r\n        && this.isSliceChange \r\n        && this.referenceLines.crossViewer.layoutIndex === index) {\r\n      this.isSliceChange = false\r\n      this.referenceLinesShow()\r\n    }\r\n  }\r\n\r\n  getDcmViewerRef = (index) => {\r\n    return this.dicomViewersRefs[index]\r\n  }\r\n\r\n  getDcmViewer = (index) => {\r\n    return this.dicomViewers[index]\r\n  }\r\n\r\n  getActiveDcmViewer = () => {\r\n    return this.dicomViewersRefs[this.props.activeDcmIndex]\r\n  }  \r\n\r\n  showFileOpen() {\r\n    this.props.isOpenStore(false)\r\n    this.fileOpen.current.click()\r\n  }\r\n\r\n  handleOpenLocalFs = (filesSelected) => {\r\n    if (filesSelected.length > 1) {\r\n      this.files = filesSelected\r\n      this.changeLayout(1, 1)\r\n      this.mprPlane = ''\r\n      this.volume = []\r\n      this.setState({sliceIndex: 0,\r\n                     sliceMax: 1,\r\n                     visibleMprOrthogonal: false, \r\n                     visibleMprCoronal: false, \r\n                     visibleMprSagittal: false, \r\n                     visibleMprAxial: false}, () => {\r\n                       this.setState({visibleOpenMultipleFilesDlg: true})\r\n                     })\r\n    } else {\r\n      const file = filesSelected[0]\r\n      if (file.type === 'application/x-zip-compressed' || file.type === 'application/zip') {\r\n        this.file = file\r\n        this.url = null\r\n        this.setState({visibleZippedFileDlg: true})\r\n      } else {\r\n        this.setState({sliceIndex: 0, sliceMax: 1})\r\n        this.props.setLocalFileStore(file)\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].runTool('clear')\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openLocalFs', file)      \r\n      }\r\n    }\r\n  }\r\n\r\n  handleOpenSandboxFs = (fsItem) => {\r\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('clear')\r\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openSandboxFs', fsItem)\r\n  }\r\n\r\n  handleOpenImage = (index) => {\r\n\r\n    this.dicomViewersRefs[this.props.activeDcmIndex].sliceIndex = index // this.state.sliceIndex\r\n\r\n    const visibleMprOrthogonal = this.state.visibleMprOrthogonal\r\n    const visibleMprSagittal = this.state.visibleMprSagittal\r\n    const visibleMprCoronal = this.state.visibleMprCoronal\r\n    const visibleMprAxial = this.state.visibleMprAxial\r\n    const plane = this.mprPlanePosition() // plane of source\r\n\r\n    \r\n    if (visibleMprOrthogonal) {\r\n      if (this.props.activeDcmIndex === 0) {\r\n        this.dicomViewersRefs[0].runTool('openimage', index)\r\n        if (this.state.mprMode) {\r\n          this.dicomViewersRefs[1].mprReferenceLines(index)\r\n          this.dicomViewersRefs[2].mprReferenceLines(index)\r\n        }\r\n      } else if (this.props.activeDcmIndex === 1) {\r\n\r\n        this.dicomViewersRefs[1].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\r\n        this.dicomViewersRefs[2].mprReferenceLines2(index) \r\n        this.dicomViewersRefs[0].mprReferenceLines3(index, this.mprData)\r\n\r\n      } else if (this.props.activeDcmIndex === 2) {\r\n\r\n        this.dicomViewersRefs[2].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\r\n        this.dicomViewersRefs[1].mprReferenceLines2(index)   \r\n        this.dicomViewersRefs[0].mprReferenceLines3(index, this.mprData)  \r\n      }\r\n\r\n    } else { \r\n      if (objectIsEmpty(this.mprData)) { // works on new image\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', index)\r\n      } else if ((plane === 'sagittal' && visibleMprSagittal) ||\r\n          (plane === 'axial' && visibleMprAxial) ||\r\n          (plane === 'coronal' && visibleMprCoronal))\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', index)\r\n      else if (plane === 'sagittal' && visibleMprAxial)\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)  \r\n      else if (plane === 'sagittal' && visibleMprCoronal)\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)   \r\n      else if (plane === 'axial' && visibleMprSagittal)\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\r\n      else if (plane === 'axial' && visibleMprCoronal)\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\r\n      else if (plane === 'coronal' && visibleMprSagittal)\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData) \r\n      else if (plane === 'coronal' && visibleMprAxial)\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData) \r\n      else { // it's not a possible MPR, then open as normal dicom file\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', index)           \r\n      }\r\n    }\r\n\r\n    this.activeDcmViewersNum = this.getActiveDcmViewers()\r\n    if (this.activeDcmViewersNum > 0) {\r\n      this.getActiveDcmViewersSameStudy()\r\n      this.getActiveDcmViewersSamePlane()\r\n      if (this.state.visibleReferenceLines && this.dicomViewersActive.length > 1) {        \r\n        this.referenceLinesShow() \r\n      }\r\n    }\r\n  }\r\n  \r\n  handleOpenFileDicomdir = (file) => {\r\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('clear')\r\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openLocalFs', file)\r\n  }\r\n\r\n  showOpenFolder() {\r\n    this.openFolder.current.click()\r\n  }\r\n\r\n  showOpenDicomdir() {\r\n    this.openDicomdir.current.click()\r\n  }\r\n\r\n  handleOpenFolder = (files) => {\r\n    if (this.state.visibleExplorer) {\r\n      this.setState({visibleExplorer: false}, () => {\r\n        this.handleOpenFolderDo(files)\r\n      })\r\n    } else this.handleOpenFolderDo(files)\r\n    \r\n  }\r\n\r\n  handleOpenFolderDo = (files) => {\r\n    this.changeLayout(1, 1)\r\n    this.mprPlane = ''\r\n    this.volume = []\r\n    this.files = []\r\n    this.clear()\r\n\r\n    this.folder = files[0].webkitRelativePath.split('/')[0]\r\n\r\n    for (let i=0; i < files.length; i++) {\r\n      this.files.push(files[i])\r\n    }\r\n\r\n    this.setState({sliceIndex: 0,\r\n                    sliceMax: 1,\r\n                    visibleMprOrthogonal: false, \r\n                    visibleMprCoronal: false, \r\n                    visibleMprSagittal: false, \r\n                    visibleMprAxial: false})\r\n    this.setState({visibleOpenMultipleFilesDlg: true})        \r\n  }  \r\n\r\n\r\n  handleOpenDicomdir = (files) => {\r\n    this.setState({ visibleDicomdir: false }, () => {\r\n      let dicomdir = null\r\n      let datafiles = []\r\n      for (let i=0; i < files.length; i++) {\r\n        if (files[i].webkitRelativePath.includes('DICOMDIR')) {\r\n          dicomdir = files[i]\r\n        } else {\r\n          datafiles.push(files[i])\r\n        }\r\n      }\r\n      if (dicomdir !== null) {\r\n        this.props.setDicomdirStore({origin: 'local', dicomdir: dicomdir, files: datafiles})\r\n        this.toggleDicomdir()\r\n      } else {\r\n        this.setState({titleMessage: 'Warning', textMessage: 'The selected folder does not contains any DICOMDIR file.'}, () => {\r\n          this.setState({ visibleMessage: true })\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  handleOpenFsDicomdir = (fsItem) => {\r\n    this.props.setDicomdirStore({origin: 'fs', dicomdir: fsItem, files: []})\r\n    this.toggleDicomdir()\r\n  }\r\n\r\n  componentDidMount() {\r\n    // Need to set the renderNode since the drawer uses an overlay\r\n    //this.dialog = document.getElementById('drawer-routing-example-dialog')\r\n    window.scrollTo(0, 0)\r\n  }\r\n\r\n\r\n  showAppBar = () => {\r\n    window.scrollTo(0, 0)\r\n  }\r\n  \r\n\r\n  toggleMainMenu = () => {\r\n    const visibleMainMenu = this.state.visibleMainMenu\r\n    if (getSettingsFsView() === 'left') {\r\n      this.setState({ visibleMainMenu: !visibleMainMenu, visibleFileManager: false })\r\n    } else {\r\n      this.setState({ visibleMainMenu: !visibleMainMenu })\r\n    }\r\n  }\r\n  \r\n  showMainMenu = () => {\r\n    this.setState({ visibleMainMenu: true })\r\n  }\r\n\r\n  hideMainMenu = () => {\r\n    this.setState({ visibleMainMenu: false })\r\n  }\r\n\r\n  handleVisibility = (visibleMainMenu) => {\r\n    this.setState({ visibleMainMenu })\r\n  }\r\n\r\n\r\n  toggleFileManager = () => {\r\n    if (getSettingsFsView() === 'left') {\r\n      this.setState({visibleMainMenu: false, visibleFileManager: !this.state.visibleFileManager})\r\n    } else {\r\n      const visible = !this.state.visibleFileManager\r\n      this.setState({ visibleFileManager: visible })\r\n      if (visible) \r\n        this.setState({ \r\n          visibleMeasure: false, \r\n          visibleHeader: false,\r\n          visibleToolbox: false, \r\n          visibleDicomdir: false, \r\n          visibleExplorer: false\r\n        })        \r\n    }\r\n  }\r\n  \r\n  toggleExplorer = () => {\r\n    const visible = !this.state.visibleExplorer\r\n    this.setState({ visibleExplorer: visible })\r\n    if (visible) \r\n      this.setState({ \r\n        visibleMeasure: false, \r\n        visibleHeader: false,\r\n        visibleToolbox: false, \r\n        visibleDicomdir: false, \r\n        visibleFileManager: false\r\n      })    \r\n  }\r\n\r\n  toggleHeader = () => {\r\n    const visible = !this.state.visibleHeader\r\n    this.setState({ visibleHeader: visible })\r\n    if (visible) \r\n      this.setState({ \r\n        visibleMeasure: false, \r\n        visibleToolbox: false, \r\n        visibleDicomdir: false, \r\n        visibleFileManager: false,\r\n        visibleExplorer: false\r\n      })    \r\n  }\r\n\r\n\r\n  toggleToolbox = () => {\r\n    const visible = !this.state.visibleToolbox\r\n    this.setState({ visibleToolbox: visible })\r\n    if (visible) \r\n      this.setState({ \r\n        visibleMeasure: false, \r\n        visibleHeader: false, \r\n        visibleDicomdir: false, \r\n        visibleFileManager: false,\r\n        visibleExplorer: false \r\n      })\r\n  }\r\n\r\n  saveMeasure = () => {\r\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('savetools')\r\n  }\r\n  \r\n  toggleMeasure = () => {\r\n    const visible = !this.state.visibleMeasure\r\n    this.setState({ visibleMeasure: visible })\r\n    if (visible) \r\n      this.setState({ \r\n        visibleToolbox: false, \r\n        visibleHeader: false, \r\n        visibleDicomdir: false, \r\n        visibleFileManager: false,\r\n        visibleExplorer: false\r\n      })\r\n  }\r\n\r\n  hideMeasure = () => {\r\n    this.setState({ visibleMeasure: false })\r\n  }\r\n\r\n  handleVisibilityMeasure = (visibleMeasure) => {\r\n    this.setState({ visibleMeasure })\r\n  }\r\n\r\n\r\n  toggleDicomdir = () => {\r\n    const visible = !this.state.visibleDicomdir\r\n    this.setState({ visibleDicomdir: visible })\r\n    if (visible) \r\n      this.setState({ \r\n        visibleMeasure: false, \r\n        visibleToolbox: false, \r\n        visibleHeader: false, \r\n        visibleFileManager: false\r\n      })\r\n  }\r\n  \r\n\r\n  clearMeasure = () => {\r\n    this.showClearMeasureDlg()\r\n  }\r\n\r\n  showClearMeasureDlg = () => {\r\n    this.setState({ visibleClearMeasureDlg: true })\r\n  }\r\n\r\n  hideClearMeasureDlg = () => {\r\n      this.setState({ visibleClearMeasureDlg: false })\r\n  }\r\n\r\n  confirmClearMeasureDlg = () => {\r\n    this.hideClearMeasureDlg()\r\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('removetools')\r\n  }\r\n\r\n\r\n  showZippedFileDlg = () => {\r\n    this.setState({ visibleZippedFileDlg: true })\r\n  }  \r\n\r\n  hideZippedFileDlg = () => {\r\n      this.setState({ visibleZippedFileDlg: false })\r\n  }\r\n\r\n  confirmZippedFileDlg = () => {\r\n    this.hideZippedFileDlg()\r\n    this.setState({ visibleFileManager: true }, () => {\r\n      if (this.url !== null) {\r\n        this.setState({visibleDownloadZipDlg: true})\r\n      } else {\r\n        this.props.setFsZippedFile(this.file)\r\n      }\r\n    })\r\n  }\r\n\r\n\r\n  showAbout = () => {\r\n    this.setState({ visibleAbout: !this.state.visibleAbout })\r\n  }\r\n  \r\n  showSettings = () => {\r\n    this.setState({ \r\n      visibleMainMenu: false, \r\n      visibleSettings: true, \r\n      visibleToolbar: false, \r\n      position: 'right' \r\n    })\r\n  }\r\n\r\n  hideSettings = () => {\r\n    this.setState({ \r\n      visibleMainMenu: true, \r\n      visibleSettings: false, \r\n      visibleToolbar: true,\r\n      visibleFileManager: false,\r\n      visibleDicomdir: false, \r\n    })\r\n  }\r\n\r\n  handleVisibilitySettings = (visibleSettings) => {\r\n    this.setState({ visibleSettings })\r\n  }\r\n\r\n  hideDownloadZipDlg = () => {\r\n    this.setState({ visibleDownloadZipDlg: false })\r\n  }\r\n\r\n  hideOpenMultipleFilesDlg = () => {\r\n    this.setState({ visibleOpenMultipleFilesDlg: false })\r\n    this.openMultipleFilesCompleted()\r\n  }\r\n\r\n  openMultipleFilesCompleted = () => {\r\n    if (this.props.files !== null) {\r\n      this.changeLayout(1, 1)\r\n\r\n      this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', 0)\r\n\r\n      const sliceMax = this.props.files.length\r\n\r\n      this.setState({sliceMax: sliceMax}, () => {\r\n \r\n      })\r\n\r\n      // check if there are studies and series, if so then prepare Explorer\r\n      \r\n      const patientList = groupBy(this.props.files, a => a.patient.patientName)\r\n      const patientKeys = [...patientList.keys()]\r\n      const patient = {\r\n        list: patientList,\r\n        keys: patientKeys\r\n      }\r\n\r\n      this.explorer = {\r\n        folder: this.folder,\r\n        patient: patient,\r\n      }\r\n\r\n      if (sliceMax > 1)\r\n        this.setState({visibleExplorer: true, visibleFileManager: false})\r\n    } \r\n  }\r\n\r\n  showOpenUrl = () => {\r\n    this.setState({ visibleOpenUrl: true })\r\n  }\r\n\r\n  hideOpenUrl = (openDlg) => {\r\n    this.setState({ visibleOpenUrl: false },\r\n      () => {\r\n        if (openDlg) {\r\n          this.hideMainMenu()\r\n          this.file = null\r\n          this.url = this.openUrlField.value\r\n          if (getFileExtReal(this.url) === 'zip') {\r\n            this.setState({visibleZippedFileDlg: true})\r\n          } else {\r\n            return this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openurl', this.openUrlField.value)\r\n          }\r\n        } \r\n    })\r\n  }\r\n\r\n  downloadOpenUrl = () => {\r\n    this.setState({ visibleOpenUrl: false, visibleToolbar: true })\r\n  }\r\n  \r\n  resetImage = () => {\r\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('reset')\r\n  }\r\n  \r\n  saveShot = () => {\r\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('saveas')\r\n  }\r\n\r\n  cinePlayer = () => {\r\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('cine')\r\n  }\r\n\r\n  clear = () => {  \r\n    this.layoutGridClick(0)\r\n    for(let i=0; i < this.props.isOpen.length; i++)\r\n      if (this.props.isOpen[i]) this.dicomViewersRefs[i].runTool('clear')\r\n    setTimeout(() => {\r\n      this.setState({openImageEdit: false, \r\n                    openTools: false, \r\n                    mprMenu: false, \r\n                    visibleToolbox: false, \r\n                    visibleMeasure: false, \r\n                    visibleHeader: false, \r\n                    visibleDicomdir: false}, () => { \r\n                    })\r\n      this.changeLayout(1, 1)\r\n      this.props.setFilesStore(null)\r\n      this.props.setDicomdirStore(null)\r\n      //this.props.clearingStore()      \r\n    }, 100) \r\n  }\r\n\r\n  //#region Layout handler\r\n  handleLayout = (event) => {\r\n    this.setState({anchorElLayout: event.currentTarget})\r\n  }\r\n  \r\n  closeLayout = () => {\r\n    this.setState({anchorElLayout: null})\r\n  }\r\n\r\n  changeLayout = (row, col) => {\r\n    // if reduce the grid clear the unused views\r\n    if (row < this.props.layout[0] || col < this.props.layout[1]) {\r\n      for(let i=0; i < 4; i++) {\r\n        for(let j=0; j < 4; j++) {\r\n          if ((i+1 > row) || (j+1 > col)) {\r\n            const index = i*4+j\r\n            this.dicomViewersRefs[index] = undefined\r\n            if (index === this.props.activeDcmIndex) this.layoutGridClick(index-1)\r\n          }\r\n        }\r\n      }\r\n      this.activeDcmViewersNum = this.getActiveDcmViewers()\r\n      if (this.isMultipleFiles && this.activeDcmViewersNum === 1) this.setState({mprMenu: true})\r\n    }\r\n    this.props.setLayoutStore(row, col)\r\n  }\r\n\r\n  //#endregion \r\n\r\n  //#region Tools panel handler\r\n  handleToolsPanel = (event) => {\r\n    this.setState({anchorElToolsPanel: event.currentTarget})\r\n  }\r\n\r\n  closeToolsPanel = () => {\r\n    this.setState({anchorElToolsPanel: null})\r\n  }\r\n  //#endregion\r\n\r\n  toolExecute = (tool) => {\r\n    this.closeToolsPanel()\r\n    if (tool === 'referencelines') {\r\n      this.referenceLinesToggle()\r\n    } else if (tool === 'serieslink') {\r\n      this.seriesLinkToggle()\r\n    } else {\r\n      this.setState({toolActive: tool})\r\n      this.props.toolStore(tool)\r\n      this.dicomViewersRefs[this.props.activeDcmIndex].runTool(tool)\r\n    }    \r\n  }\r\n\r\n  toolChange = () => {\r\n    const toolState = 1-this.state.toolState\r\n    this.setState({toolState: toolState}, () => {\r\n      this.changeTool.changeTool(this.props.tool, toolState)\r\n    })\r\n  }\r\n\r\n  toolRemove = (index) => {\r\n    this.dicomViewersRefs[this.props.activeDcmIndex].runTool('removetool', index)\r\n  }\r\n\r\n  toggleOpenMenu = () => {\r\n    this.setState({openMenu: !this.state.openMenu})\r\n  } \r\n\r\n  toggleImageEdit = () => {\r\n    this.setState({openImageEdit: !this.state.openImageEdit})\r\n  }\r\n\r\n  toggleTools = () => {\r\n    this.setState({openTools: !this.state.openTools})\r\n  } \r\n\r\n  toggleMpr = () => {\r\n    this.setState({mprMenu: !this.state.mprMenu})\r\n  } \r\n\r\n  layoutGridClick = (index) => {\r\n    if (isMobile && index === this.props.activeDcmIndex) return\r\n\r\n\r\n    //this.mprPlanePosition(true, index)\r\n\r\n    const sliceMax = this.dicomViewersRefs[index].sliceMax\r\n    const sliceIndex = this.dicomViewersRefs[index].sliceIndex\r\n    this.setState({sliceMax: sliceMax, sliceIndex: sliceIndex})\r\n\r\n    this.props.setActiveDcmIndex(index)\r\n\r\n    if (this.state.visibleMprOrthogonal) {\r\n      this.setState({sliceMax: sliceMax, sliceIndex: sliceIndex})\r\n    }  \r\n\r\n    const dcmViewer = this.getDcmViewerRef(index)\r\n    if (dcmViewer.image === null) return // click on empty frame\r\n\r\n    this.props.setActiveMeasurements(dcmViewer.measurements)\r\n    this.props.setActiveDcm(dcmViewer) // {image: dcmViewer.image, element: dcmViewer.dicomImage, isDicom: dcmViewer.isDicom}\r\n    this.props.setExplorerActiveSeriesIndex(dcmViewer.explorerIndex) \r\n\r\n    if (this.state.visibleReferenceLines && this.dicomViewersActive.length > 1) {\r\n      if (this.referenceLines.scoutViewer !== undefined) this.referenceLines.scoutViewer.updateImage()\r\n      this.setState({ visibleReferenceLines: false }, () => {\r\n        this.referenceLinesToggle()      \r\n      })\r\n    }\r\n  }\r\n \r\n  layoutGridTouch = (index) => {\r\n    if (!isMobile && index === this.props.activeDcmIndex) return\r\n     \r\n  }\r\n\r\n  buildLayoutGrid = () => {\r\n    \r\n    //this.referenceLinesHide()\r\n\r\n    let dicomviewers = []\r\n    for(let i=0; i < this.props.layout[0]; i++) {\r\n      for(let j=0; j < this.props.layout[1]; j++) {\r\n        const styleLayoutGrid = {\r\n          border: this.props.layout[0] === 1 && this.props.layout[1] === 1 ? 'solid 1px #000000' : 'solid 1px #444444',\r\n        }\r\n        const index = i*4+j\r\n        dicomviewers.push(\r\n          <div \r\n            key={index} \r\n            style={styleLayoutGrid} \r\n            onClick={() => this.layoutGridClick(index)} \r\n            onTouchStart={() => this.layoutGridTouch(index)}\r\n          >\r\n            {this.getDcmViewer(index)}\r\n          </div>        \r\n        )\r\n      }\r\n    }\r\n\r\n    return (\r\n      <div\r\n        id=\"dicomviewer-grid\"\r\n        style={{\r\n          display: 'grid',\r\n          gridTemplateRows: `repeat(${this.props.layout[0]}, ${100 / this.props.layout[0]}%)`,\r\n          gridTemplateColumns: `repeat(${this.props.layout[1]}, ${100 / this.props.layout[1]}%)`,\r\n          height: '100%',\r\n          width: '100%',\r\n        }}\r\n      >\r\n        {dicomviewers}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  getStringVisiblePlane = () => {\r\n    if (this.state.visibleMprOrthogonal) \r\n      return 'orthogonal'    \r\n    else if (this.state.visibleMprSagittal) \r\n      return 'sagittal'\r\n    else if (this.state.visibleMprAxial) \r\n      return 'axial'\r\n    else if (this.state.visibleMprCoronal) \r\n      return 'coronal'\r\n  }\r\n\r\n  appBarTitle = (classes, isOpen, dcmViewer) => {\r\n    if (isMobile && !isTablet) {\r\n      if (isOpen) \r\n        return null\r\n      else \r\n        return (\r\n          <Typography variant=\"overline\" className={classes.title}>\r\n            <strong>AMAAR</strong> <strong>V</strong>iewer\r\n          </Typography>          \r\n        )\r\n    } else {\r\n      if (isOpen) {\r\n        const plane = this.getStringVisiblePlane()\r\n        if (this.state.sliceMax > 1 && this.mprPlane !== plane && this.mprPlane !== '') {\r\n          return (\r\n            <Typography variant=\"overline\" className={classes.title}>\r\n              {'MPR '+plane}\r\n            </Typography>\r\n          )        \r\n        }\r\n        return (\r\n          <Typography variant=\"overline\" className={classes.title}>\r\n            {dcmViewer.filename}\r\n          </Typography>\r\n        )\r\n      } else if (this.props.dicomdir !== null) {\r\n        return (\r\n          <Typography variant=\"overline\" className={classes.title}>\r\n            {this.props.dicomdir.dicomdir.webkitRelativePath}\r\n          </Typography>\r\n        )\r\n      } else\r\n        return (\r\n          <Typography variant=\"overline\" className={classes.title}>\r\n           <strong>AMAR</strong> <strong>V</strong>iewer\r\n          </Typography>\r\n        )\r\n    }\r\n  }\r\n\r\n  //  LINK SERIES\r\n  // #region LINK SERIES\r\n\r\n  seriesLinkToggle = () => {\r\n    this.setState({ visibleSeriesLink: !this.state.visibleSeriesLink })\r\n  }\r\n\r\n  //  REFERENCE LINES\r\n  // #region REFERENCE LINES\r\n\r\n  referenceLinesToggle = () => {\r\n\r\n    //if (this.state.mprMode) return\r\n    const visible = !this.state.visibleReferenceLines\r\n    this.setState({ visibleReferenceLines: visible })\r\n    if (visible && this.dicomViewersActive.length > 1) {\r\n\r\n      this.referenceLinesShow()\r\n    } else {\r\n      this.referenceLinesHide()\r\n    }\r\n  }\r\n\r\n  referenceLinesShow = () => {\r\n    if (this.state.mprMode || !this.state.visibleReferenceLines || this.dicomViewersActive.length < 2) return\r\n    this.referenceLines.crossViewer = this.getDcmViewerRef(this.props.activeDcmIndex) // this is cross-sectional image\r\n    const crossMprPlane = this.referenceLines.crossViewer.mprPlane\r\n    this.openViewers = this.dicomViewersActive.filter(v => v.layoutIndex !== this.props.activeDcmIndex && crossMprPlane !== v.mprPlane)    \r\n    //this.referenceLinesDraw()\r\n    this.referenceLines.crossViewer.updateImage()\r\n    for(let i=0; i < this.openViewers.length; i++) {\r\n      this.openViewers[i].referenceLinesBuild(this.referenceLines.crossViewer.image) // this is scout image\r\n    }\r\n  }\r\n\r\n  referenceLinesHide = () => {\r\n    if (this.state.mprMode || this.openViewers === undefined) return\r\n    for(let i=0; i < this.openViewers.length; i++) {\r\n      this.openViewers[i].updateImage() // this is scout image\r\n    }\r\n  }\r\n\r\n  // #endregion \r\n\r\n  //  MPR\r\n  // #region MPR\r\n\r\n  mprBuildVolume = () => {\r\n\r\n    // \"For the specific case of dual-echo MR images select files with same EchoNumber tag of selected image.  \r\n    const echoNumber = getDicomEchoNumber(this.dicomViewersRefs[this.props.activeDcmIndex].image)\r\n\r\n    if (this.volume.length > 0 && echoNumber === this.echoNumber) return\r\n\r\n    this.t0 = performance.now()\r\n\r\n    const files = this.dicomViewersRefs[0].files.filter((a) => {\r\n      return a.series.echoNumber === echoNumber}\r\n    )\r\n    if (files.length < this.files.length) { // until mprMode is true temporary works on files with same EchoNumber\r\n      this.echoNumber = echoNumber\r\n      this.dicomViewersRefs[this.props.activeDcmIndex].runTool('setfiles', files)\r\n    }\r\n\r\n    const sliceIndex = this.state.sliceIndex\r\n    const xPixelSpacing = getDicomPixelSpacing(files[sliceIndex].image, 1)\r\n    const spacingBetweenSlice = getDicomSpacingBetweenSlice(files[sliceIndex].image)\r\n    const sliceThickness = getDicomSliceThickness(files[sliceIndex].image)\r\n    const length = files[sliceIndex].image.getPixelData().length\r\n    const sliceLocation = getDicomSliceLocation(files[sliceIndex].image)\r\n\r\n    this.volume = []\r\n\r\n\r\n    this.mprData.zDim = Math.round(files.length * spacingBetweenSlice / xPixelSpacing)\r\n\r\n\r\n    // If spacing between slices is less than slice thickness, the images are not optimal for 3D reconstruction.\r\n    // Try an alternative algorithm based on slice distance.\r\n    let zDimMethod2 = false\r\n    if (spacingBetweenSlice < sliceThickness && sliceLocation === undefined) {\r\n      let max = files[sliceIndex].sliceDistance\r\n      let min = files[sliceIndex].sliceDistance\r\n      for(let i=0; i < files.length; i++) {\r\n        if (files[i].sliceDistance > max)\r\n          max = files[i].sliceDistance\r\n        if (files[i].sliceDistance < min)\r\n          min = files[i].sliceDistance  \r\n      }\r\n      this.mprData.zDim = Math.round(Math.abs(max - min) / xPixelSpacing)\r\n      zDimMethod2 = true\r\n    }\r\n    this.mprData.zStep = Math.round(this.mprData.zDim / files.length)\r\n    \r\n    if (files.length === this.mprData.zDim) { // slices contiguous\r\n      for (let i = 0, len = files.length; i < len; i++) {\r\n        this.volume.push(files[i].image.getPixelData())\r\n      }\r\n      \r\n    } else if (files.length < this.mprData.zDim) { // gap between slices\r\n      \r\n      let emptyPlane = new Int16Array(length).fill(0)\r\n      for (let i = 0, len = this.mprData.zDim; i < len; i++) {\r\n        this.volume.push(emptyPlane)\r\n      }\r\n\r\n      let order = []\r\n\r\n      for (let i = 0; i < files.length; i++) {\r\n        order.push({iFile: i, instanceNumber: files[i].instanceNumber, sliceDistance: files[i].sliceDistance, sliceLocation: files[i].sliceLocation})\r\n      }\r\n\r\n      if (zDimMethod2) {\r\n        // eliminate eventually duplicates\r\n        order = order.reduce((previous, current) => {\r\n          let object = previous.filter(object => object.sliceDistance === current.sliceDistance)\r\n          if (object.length === 0) {\r\n            previous.push(current)\r\n          }\r\n          return previous\r\n        }, [])\r\n\r\n        order.sort((l, r) => {\r\n          // return r.sliceDistance - l.sliceDistance\r\n          return l.instanceNumber - r.instanceNumber\r\n        })     \r\n\r\n      } else {\r\n        const reorder = (files[0].sliceDistance < files[1].sliceDistance)\r\n        // const reorder = files[sliceIndex].sliceLocation < files[1].sliceLocation\r\n        if (reorder) {\r\n          order.sort((l, r) => {\r\n            return r.sliceDistance - l.sliceDistance\r\n            //return r.sliceLocation - l.sliceLocation\r\n            // return r.instanceNumber - l.instanceNumber\r\n          })    \r\n        } else {\r\n          const isOnRows = getDicomImageXOnRows(files[sliceIndex].image)\r\n          const reorder = Math.sign(files[0].sliceDistance) * Math.sign(files[0].sliceLocation) < 0\r\n          if (reorder) {        \r\n            order.sort((l, r) => {\r\n              if (isOnRows)\r\n                return l.sliceDistance - r.sliceDistance\r\n              else\r\n                return r.sliceDistance - l.sliceDistance  \r\n            })    \r\n          }\r\n        }\r\n      }\r\n/*\r\n      order.sort((l, r) => {\r\n        return r.sliceDistance - l.sliceDistance\r\n        // return l.instanceNumber - r.instanceNumber\r\n      })  \r\n*/\r\n\r\n      this.mprData.instanceNumberOrder = files[order[0].iFile].instanceNumber < files[order[1].iFile].instanceNumber ? 1 : -1\r\n      this.mprData.indexMax = files.length\r\n\r\n      let intervals = [0]\r\n      this.volume[0] = files[order[0].iFile].image.getPixelData()\r\n      this.volume[this.mprData.zDim-1] = files[order[order.length-1].iFile].image.getPixelData()  \r\n      const step = (this.mprData.zDim-2) / (order.length-2)\r\n      let i = 0\r\n      for (let k = 1; k <= order.length-2; k++) {  \r\n          i = Math.ceil(i+step)\r\n          this.volume[i] = files[order[k].iFile].image.getPixelData() // order[k-1].iFile\r\n          intervals.push(i)\r\n      }\r\n      intervals.push(this.mprData.zDim-1)\r\n\r\n      const interpolationMethod = getSettingsMprInterpolation()\r\n\r\n      if (interpolationMethod === 'no') {\r\n        // build missing planes without interpolation, simple duplicate\r\n        for (let i = 0; i < intervals.length-1; i++)\r\n          for (let j = intervals[i]+1; j <= intervals[i+1]-1; j++)\r\n            this.volume[j] = this.volume[intervals[i+1]]\r\n      } else if (interpolationMethod === 'weightedlinear') {\r\n        // build the interpolate planes between original planes\r\n        for (let i = 0; i < intervals.length-1; i++) {\r\n          const step = intervals[i+1]-intervals[i]\r\n          for (let j = intervals[i]+1; j < intervals[i+1]; j++) {\r\n            let p = new Int16Array(length)\r\n            const w = (j-intervals[i]) / step\r\n            for (let k = 0; k < length-1; k++) {\r\n              // simple linear interpolation\r\n              // const p0 = this.volume[intervals[i]][k]\r\n              // const p1 = this.volume[intervals[i+1]][k]\r\n              // p[k] = (p0+p1)/2   \r\n\r\n              // weighted linear interpolation\r\n              const p0 = this.volume[intervals[i]][k] * (1-w)\r\n              const p1 = this.volume[intervals[i+1]][k] * w\r\n              p[k] = p0+p1\r\n\r\n              // weighted bilinear interpolation\r\n              /*if (k-1 > 0 && k+1 < length) {\r\n                const p0 = this.volume[intervals[i]][k] * (1-w) * 0.5 + this.volume[intervals[i]][k-1] * (1-w) * 0.25 + this.volume[intervals[i]][k+1] * (1-w) * 0.25\r\n                const p1 = this.volume[intervals[i+1]][k] * w * 0.5 + this.volume[intervals[i+1]][k-1] * w * 0.25 + this.volume[intervals[i+1]][k+1] * w * 0.25\r\n                p[k] = p0+p1\r\n              } else if (k-1 < 0) {\r\n                const p0 = this.volume[intervals[i]][k] * (1-w) * 0.75 + this.volume[intervals[i]][k+1] * (1-w) * 0.25\r\n                const p1 = this.volume[intervals[i+1]][k] * w * 0.5 + this.volume[intervals[i+1]][k+1] * w * 0.25\r\n                p[k] = p0+p1\r\n              } else { // k+1 > length \r\n                const p0 = this.volume[intervals[i]][k] * (1-w) * 0.75 + this.volume[intervals[i]][k-1] * (1-w) * 0.25\r\n                const p1 = this.volume[intervals[i+1]][k] * w * 0.5 + this.volume[intervals[i+1]][k-1] * w * 0.25\r\n                p[k] = p0+p1\r\n              }*/\r\n            }\r\n\r\n            this.volume[j]= p\r\n          }\r\n        }\r\n      }\r\n\r\n      this.t1 = performance.now()\r\n      console.log(`performance volume building: ${this.t1-this.t0} milliseconds`)\r\n\r\n    } else { // overlapping slices\r\n      this.mprData.zStep = Math.round(files.length / this.mprData.zDim)\r\n      for (let i = 0, len = this.mprData.zDim; i < len; i++) {\r\n        const k = i*this.mprData.zStep\r\n        this.volume.push(files[k].image.getPixelData())\r\n      }  \r\n    }\r\n\r\n    const index = Math.round(files.length / 2)\r\n    this.setState({sliceIndex: index}, () => {\r\n      if (this.state.visibleMprOrthogonal) {\r\n        this.changeToOrthogonalView()\r\n\r\n      } else if (this.state.visibleMprSagittal) {\r\n        this.changeToSagittalView()\r\n\r\n      } else if (this.state.visibleMprCoronal) {\r\n        this.changeToCoronalView()  \r\n\r\n      } else { // axial\r\n        this.changeToAxialView()\r\n      }      \r\n    })\r\n          \r\n  }\r\n\r\n  changeToOrthogonalView = () => {  \r\n    \r\n    this.setState({sliceMax: this.dicomViewersRefs[0].files.length})\r\n\r\n    this.changeLayout(1, 3)\r\n\r\n    const index = Math.trunc(this.dicomViewersRefs[0].files.length / 2)\r\n\r\n    this.setState({visibleVolumeBuilding: false, sliceIndex: index, mprMode: true}, () => {\r\n      const plane = this.mprPlanePosition()\r\n\r\n      if (this.dicomViewersRefs[0].volume === null)\r\n        this.dicomViewersRefs[0].volume = this.volume\r\n\r\n      this.dicomViewersRefs[0].runTool('openimage', index)\r\n\r\n      if (this.dicomViewersRefs[1].volume === null)\r\n        this.dicomViewersRefs[1].volume = this.volume\r\n      \r\n      this.dicomViewersRefs[1].runTool('setfiles', this.files)\r\n      this.dicomViewersRefs[1].explorerIndex = this.dicomViewersRefs[0].explorerIndex\r\n      this.dicomViewersRefs[1].sliceMax = this.dicomViewersRefs[0].files[index].image.columns\r\n      const xzIndex = Math.trunc(this.dicomViewersRefs[1].sliceMax / 2)\r\n      this.dicomViewersRefs[1].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, xzIndex, this.mprData)  \r\n      \r\n      if (this.dicomViewersRefs[2].volume === null)\r\n        this.dicomViewersRefs[2].volume = this.volume\r\n\r\n      this.dicomViewersRefs[2].runTool('setfiles', this.files) \r\n      this.dicomViewersRefs[2].explorerIndex = this.dicomViewersRefs[0].explorerIndex\r\n      this.dicomViewersRefs[2].sliceMax = this.dicomViewersRefs[0].files[index].image.columns\r\n      const yzIndex = Math.trunc(this.dicomViewersRefs[2].sliceMax / 2) \r\n      this.dicomViewersRefs[2].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, yzIndex, this.mprData)    \r\n    })\r\n\r\n  }\r\n\r\n  changeToSagittalView = () => {\r\n\r\n    this.changeLayout(1, 1)\r\n\r\n    this.setState({visibleVolumeBuilding: false}, () => {\r\n      const plane = this.mprPlanePosition()\r\n\r\n      if (this.dicomViewersRefs[this.props.activeDcmIndex].volume === null)\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].volume = this.volume\r\n\r\n      if (plane === 'sagittal') { \r\n        this.dicomViewersRefs[0].runTool('setfiles', this.files) // due to EchoNumber can be changed\r\n        const sliceMax = this.dicomViewersRefs[0].files === null ? 1 : this.dicomViewersRefs[0].files.length\r\n        const index = Math.trunc(sliceMax / 2)\r\n        this.setState({sliceIndex: index, sliceMax: sliceMax, mprMode: false}, () => {\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].sliceMax = sliceMax\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', index)\r\n        })\r\n      } else if (plane === 'axial') {\r\n        const sliceMax = this.dicomViewersRefs[0].files[0].image.rows // this.mprData.zDim \r\n        const index = Math.trunc(sliceMax / 2)\r\n        this.setState({sliceIndex: index, sliceMax: sliceMax}, () => {\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].sliceMax = sliceMax\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\r\n        })   \r\n      } else {\r\n        const sliceMax = this.dicomViewersRefs[0].files[0].image.columns // this.mprData.zDim \r\n        const index = Math.trunc(sliceMax / 2)\r\n        this.setState({sliceIndex: index, sliceMax: sliceMax}, () => {\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].sliceMax = sliceMax\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\r\n        }) \r\n      }      \r\n    })\r\n  }\r\n\r\n  changeToCoronalView = () => {  \r\n    this.changeLayout(1, 1)\r\n\r\n    this.setState({visibleVolumeBuilding: false}, () => {\r\n      const plane = this.mprPlanePosition()\r\n\r\n      if (this.dicomViewersRefs[this.props.activeDcmIndex].volume === null)\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].volume = this.volume\r\n\r\n      if (plane === 'coronal') {\r\n        this.dicomViewersRefs[0].runTool('setfiles', this.files) // due to EchoNumber can be changed\r\n        const sliceMax = this.dicomViewersRefs[0].files === null ? 1 : this.dicomViewersRefs[0].files.length\r\n        const index = Math.trunc(sliceMax / 2)\r\n        this.setState({sliceIndex: index, sliceMax: sliceMax, mprMode: false}, () => {\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].sliceMax = sliceMax\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', index)\r\n        })       \r\n\r\n      } else if (plane === 'axial') {\r\n        const sliceMax = this.dicomViewersRefs[0].files[0].image.columns // this.mprData.zDim \r\n        const index = Math.trunc(sliceMax / 2)\r\n        this.setState({sliceIndex: index, sliceMax: sliceMax}, () => {\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].sliceMax = sliceMax\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\r\n        })\r\n\r\n      } else { // plane is sagittal\r\n        const sliceMax = this.dicomViewersRefs[0].files[0].image.rows // this.mprData.zDim \r\n        const index = Math.trunc(sliceMax / 2)\r\n        this.setState({sliceIndex: index, sliceMax: sliceMax}, () => {\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].sliceMax = sliceMax\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\r\n        })  \r\n      }      \r\n    })\r\n  }\r\n\r\n  changeToAxialView = () => {  \r\n    this.changeLayout(1, 1)\r\n\r\n    this.setState({visibleVolumeBuilding: false}, () => {\r\n      const plane = this.mprPlanePosition()\r\n          \r\n      if (this.dicomViewersRefs[this.props.activeDcmIndex].volume === null)\r\n        this.dicomViewersRefs[this.props.activeDcmIndex].volume = this.volume\r\n\r\n      if (plane === 'axial') {\r\n        this.dicomViewersRefs[0].runTool('setfiles', this.files) // due to EchoNumber can be changed\r\n        const sliceMax = this.dicomViewersRefs[0].files === null ? 1 : this.dicomViewersRefs[0].files.length\r\n        const index = Math.trunc(sliceMax / 2)\r\n        this.setState({sliceIndex: index, sliceMax: sliceMax, mprMode: false}, () => {\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].sliceMax = sliceMax\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].runTool('openimage', index)\r\n        })\r\n        \r\n\r\n      } else if (plane === 'sagittal') {\r\n        const sliceMax = this.dicomViewersRefs[0].files[0].image.columns // this.mprData.zDim \r\n        const index = Math.trunc(sliceMax / 2)\r\n        this.setState({sliceIndex: index, sliceMax: sliceMax}, () => {\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].sliceMax = sliceMax\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderXZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\r\n        })\r\n        \r\n\r\n      } else {\r\n        const sliceMax = this.dicomViewersRefs[0].files[0].image.rows // this.mprData.zDim \r\n        const index = Math.trunc(sliceMax / 2)\r\n        this.setState({sliceIndex: index, sliceMax: sliceMax}, () => {\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].sliceMax = sliceMax\r\n          this.dicomViewersRefs[this.props.activeDcmIndex].mprRenderYZPlane(this.dicomViewersRefs[0].filename, plane, index, this.mprData)\r\n        })             \r\n      }      \r\n    })\r\n  }\r\n\r\n  mprPlanePosition = (force = false, index = this.props.activeDcmIndex) => {\r\n    if (this.mprPlane === '' || force) {\r\n      this.mprPlane = this.dicomViewersRefs[index].mprPlanePosition()\r\n      if (!this.state.visibleMprOrthogonal) {\r\n        if (this.mprPlane === 'sagittal')\r\n          this.setState({ visibleMprOrthogonal: false, visibleMprSagittal: true, visibleMprAxial: false, visibleMprCoronal: false})\r\n        else if (this.mprPlane === 'coronal')\r\n          this.setState({ visibleMprOrthogonal: false, visibleMprSagittal: false, visibleMprAxial: false, visibleMprCoronal: true })  \r\n        else \r\n          this.setState({ visibleMprOrthogonal: false, visibleMprSagittal: false, visibleMprAxial: true, visibleMprCoronal: false })        \r\n      }\r\n    }\r\n    return this.mprPlane  \r\n  }\r\n\r\n  mpr3D = () => {\r\n    \r\n  }\r\n\r\n  mprOrthogonal = () => {\r\n    const visibleMprOrthogonal = this.state.visibleMprOrthogonal\r\n    if (!visibleMprOrthogonal) {\r\n      this.mprData.plane = {\r\n        from: this.mprPlane,\r\n        to: 'orthogonal'\r\n      }\r\n      this.setState({visibleMprOrthogonal: true, \r\n                    visibleMprCoronal: false, \r\n                    visibleMprSagittal: false, \r\n                    visibleMprAxial: false}, () => {\r\n        if (this.volume.length === 0) {   \r\n          this.setState({visibleVolumeBuilding: true}, () => {           \r\n            setTimeout(() => {\r\n              this.mprBuildVolume()\r\n            }, 100)   \r\n          })\r\n        } else {\r\n          this.changeToOrthogonalView()\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  mprSagittal = () => {\r\n    const visibleMprSagittal = this.state.visibleMprSagittal\r\n    if (!visibleMprSagittal) {\r\n      this.mprData.plane = {\r\n        from: this.mprPlane,\r\n        to: 'sagittal'\r\n      }\r\n      this.setState({visibleMprOrthogonal: false, \r\n                    visibleMprSagittal: true, \r\n                    visibleMprCoronal: false, \r\n                    visibleMprAxial: false}, () => {\r\n        if (this.volume.length === 0) {   \r\n          this.setState({visibleVolumeBuilding: true}, () => {           \r\n            setTimeout(() => {\r\n              this.mprBuildVolume()\r\n            }, 100)   \r\n          })\r\n        } else {\r\n          this.changeToSagittalView()\r\n        }\r\n      })\r\n    }\r\n  }\r\n    \r\n  mprCoronal = () => {\r\n    const visibleMprCoronal = this.state.visibleMprCoronal\r\n    if (!visibleMprCoronal) {\r\n      this.mprData.plane = {\r\n        from: this.mprPlane,\r\n        to: 'coronal'\r\n      }\r\n      this.setState({visibleMprOrthogonal: false, \r\n                     visibleMprSagittal: false, \r\n                     visibleMprCoronal: true, \r\n                     visibleMprAxial: false}, () => {\r\n        if (this.volume.length === 0) {   \r\n          this.setState({visibleVolumeBuilding: true}, () => {           \r\n            setTimeout(() => {\r\n              this.mprBuildVolume()\r\n            }, 100)   \r\n          })\r\n        } else {\r\n          this.changeToCoronalView()\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  mprAxial = () => {\r\n    const visibleMprAxial = this.state.visibleMprAxial\r\n    if (!visibleMprAxial) {\r\n      this.mprData.plane = {\r\n        from: this.mprPlane,\r\n        to: 'axial'\r\n      }\r\n      this.setState({visibleMprOrthogonal: false, \r\n                     visibleMprSagittal: false, \r\n                     visibleMprCoronal: false, \r\n                     visibleMprAxial: true}, () => {\r\n        if (this.volume.length === 0) {   \r\n          this.setState({visibleVolumeBuilding: true}, () => {           \r\n            setTimeout(() => {\r\n              this.mprBuildVolume()\r\n            }, 100)   \r\n          })\r\n        } else {\r\n          this.changeToAxialView()\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  // #endregion \r\n  \r\n  //  FILES/SLICE MANIPULATION\r\n  //#region FILES/SLICE MANIPULATION\r\n\r\n  listOpenFilesFirstFrame = () => {\r\n    const index = 0\r\n    this.setState({sliceIndex: index}, () => {\r\n      this.isSliceChange = true\r\n      this.handleOpenImage(index)\r\n    })\r\n  }\r\n\r\n  listOpenFilesPreviousFrame = () => {\r\n    let index = this.state.sliceIndex\r\n    index = index === 0 ? this.state.sliceMax-1 : index-1\r\n    this.setState({sliceIndex: index}, () => {\r\n      this.isSliceChange = true\r\n      this.handleOpenImage(index)\r\n      this.syncActiveDcmViewersSamePlane(-1)\r\n    })\r\n  } \r\n\r\n  listOpenFilesNextFrame = () => {\r\n    let index = this.state.sliceIndex\r\n    index = index === this.state.sliceMax-1 ? 0 : index+1\r\n    this.setState({sliceIndex: index}, () => {\r\n      this.isSliceChange = true\r\n      this.handleOpenImage(index)\r\n      this.syncActiveDcmViewersSamePlane(+1)\r\n    })\r\n  }  \r\n\r\n  listOpenFilesLastFrame = () => {\r\n    const index = this.state.sliceMax-1\r\n    this.setState({sliceIndex: index}, () => {\r\n      this.isSliceChange = true\r\n      this.handleOpenImage(index)\r\n    })\r\n  }  \r\n\r\n  listOpenFilesScrolling = () => {  \r\n    const scrolling = this.state.listOpenFilesScrolling\r\n    this.setState({listOpenFilesScrolling: !scrolling}, () => {\r\n      if (scrolling) {\r\n        clearInterval(this.timerScrolling)\r\n      } else {\r\n        this.timerScrolling = setInterval(() => {\r\n          this.listOpenFilesNextFrame()\r\n        }, 500)\r\n      }      \r\n    })\r\n  }\r\n\r\n  handleSliceChange = (event, value) => {\r\n    this.setState({sliceIndex: Math.floor(value)}, () => {\r\n      let index = this.state.sliceIndex\r\n      this.isSliceChange = true\r\n      this.handleOpenImage(index)\r\n    })\r\n  }\r\n\r\n  //#endregion\r\n\r\n  // EXPLORER\r\n  //#region EXPLORER\r\n\r\n  explorerOnSelectSeries = (files, explorerIndex) => {\r\n    let index = this.props.activeDcmIndex\r\n    if (this.state.mprMode) {\r\n      index = 0\r\n      this.setState({sliceIndex: 0,\r\n        sliceMax: 1,\r\n        visibleMprOrthogonal: false, \r\n        visibleMprCoronal: false, \r\n        visibleMprSagittal: false, \r\n        visibleMprAxial: false})\r\n      this.props.setActiveDcmIndex(index)\r\n      this.changeLayout(1, 1)\r\n    }\r\n\r\n    this.files = files\r\n    this.mprPlane = ''\r\n    this.mprData = {}\r\n    this.volume = []\r\n\r\n    this.dicomViewersRefs[index].runTool('setfiles', this.files)\r\n    this.dicomViewersRefs[index].explorerIndex = explorerIndex\r\n\r\n    const sliceMax = this.dicomViewersRefs[index].sliceMax\r\n    const sliceIndex = 0 // this.dicomViewersRefs[this.props.activeDcmIndex].sliceIndex\r\n    this.setState({sliceMax: sliceMax, sliceIndex: sliceIndex, mprMode: false}, () => {\r\n      this.handleOpenImage(sliceIndex)\r\n    })\r\n  }\r\n\r\n  //#endregion EXPLORER\r\n\r\n  getActiveDcmViewers = () => {\r\n    this.dicomViewersActive = this.dicomViewersRefs.filter(v => v !== undefined && v.image !== null)\r\n    return this.dicomViewersActive.length\r\n  }  \r\n\r\n  getActiveDcmViewersSameStudy = () => {\r\n    const studyId = getDicomStudyId(this.dicomViewersRefs[this.props.activeDcmIndex].image)\r\n    this.dicomViewersActiveSameStudy = this.dicomViewersRefs.filter(v => v !== undefined && getDicomStudyId(v.image) === studyId)\r\n    return this.dicomViewersActiveSameStudy.length\r\n  }  \r\n\r\n  getActiveDcmViewersSamePlane = () => {\r\n    this.dicomViewersActiveSamePlane = []\r\n    const plane = this.dicomViewersRefs[this.props.activeDcmIndex].mprPlane\r\n    for(let i=0; i < this.dicomViewersActiveSameStudy.length; i++) {\r\n      if (this.dicomViewersActiveSameStudy[i].mprPlane === plane && \r\n          this.dicomViewersActiveSameStudy[i].layoutIndex !== this.props.activeDcmIndex)\r\n        this.dicomViewersActiveSamePlane.push(this.dicomViewersActiveSameStudy[i])\r\n    }\r\n  }\r\n\r\n  syncActiveDcmViewersSamePlane = (direction) => {\r\n    if (!this.state.visibleSeriesLink) return\r\n    if (this.dicomViewersActiveSamePlane.length > 0) {\r\n      const plane = this.dicomViewersRefs[this.props.activeDcmIndex].mprPlane\r\n      const ippX = getDicomIpp(this.dicomViewersRefs[this.props.activeDcmIndex].image, 0)\r\n      const ippY = getDicomIpp(this.dicomViewersRefs[this.props.activeDcmIndex].image, 1)\r\n      const ippZ = getDicomIpp(this.dicomViewersRefs[this.props.activeDcmIndex].image, 2)\r\n\r\n\r\n      let j = 0\r\n      for(let i=0; i < this.dicomViewersActiveSamePlane.length; i++) {\r\n        if (plane === 'sagittal')\r\n          j = this.dicomViewersActiveSamePlane[i].findFirstSliceWithIppValue(ippX, 0)\r\n        else if (plane === 'coronal') \r\n          j = this.dicomViewersActiveSamePlane[i].findFirstSliceWithIppValue(ippY, 1)\r\n        else if (plane === 'axial') \r\n          j = this.dicomViewersActiveSamePlane[i].findFirstSliceWithIppValue(ippZ, 2)\r\n        if (j >= 0) \r\n          this.dicomViewersActiveSamePlane[i].runTool('openimage', j)\r\n      }\r\n    }\r\n  }\r\n  \r\n\r\n  colorIcon = (tool) => {\r\n    return this.state.toolActive === tool ? activeColor : iconColor\r\n  }\r\n\r\n  render() {\r\n\r\n    const { classes } = this.props\r\n\r\n    const primaryClass = {primary:classes.listItemText}\r\n    const iconSize = '1.2rem'\r\n    const iconSizeSmall = '1.0rem'\r\n    \r\n    //const isMultipleView = this.props.layout[0] > 1 || this.props.layout[1] > 1\r\n    const isOpen = this.props.isOpen[this.props.activeDcmIndex]\r\n    const isDicomdir = this.props.dicomdir !== null\r\n    this.isMultipleFiles = false\r\n    if (this.dicomViewersRefs[this.props.activeDcmIndex] === undefined) {\r\n      this.isMultipleFiles = false\r\n    } else {\r\n      if (this.dicomViewersRefs[this.props.activeDcmIndex].files !== null) \r\n        this.isMultipleFiles = this.dicomViewersRefs[this.props.activeDcmIndex].files.length > 1\r\n      else\r\n        this.isMultipleFiles = false\r\n    }\r\n    //const isMultipleView = this.activeDcmViewersNum > 1\r\n\r\n    const openMenu = this.state.openMenu\r\n    const openImageEdit = this.state.openImageEdit\r\n    const openTools = this.state.openTools\r\n    const visibleMainMenu = this.state.visibleMainMenu\r\n    const visibleHeader = this.state.visibleHeader\r\n    const visibleSettings = this.state.visibleSettings\r\n    const visibleAbout = this.state.visibleAbout\r\n    const visibleMeasure = this.state.visibleMeasure\r\n    const visibleToolbox = this.state.visibleToolbox\r\n    const visibleDicomdir = this.state.visibleDicomdir\r\n    const visibleFileManager = this.state.visibleFileManager\r\n    const visibleClearMeasureDlg = this.state.visibleClearMeasureDlg\r\n    const visibleZippedFileDlg = this.state.visibleZippedFileDlg \r\n    const visibleDownloadZipDlg = this.state.visibleDownloadZipDlg\r\n    const visibleOpenMultipleFilesDlg = this.state.visibleOpenMultipleFilesDlg\r\n    const visibleLayout = Boolean(this.state.anchorElLayout)\r\n    const visibleVolumeBuilding = this.state.visibleVolumeBuilding\r\n    //const visibleMpr3D = this.state.visibleMpr3D\r\n    const visibleMprOrthogonal = this.state.visibleMprOrthogonal\r\n    const visibleMprCoronal = this.state.visibleMprCoronal\r\n    const visibleMprSagittal = this.state.visibleMprSagittal\r\n    const visibleMprAxial = this.state.visibleMprAxial\r\n    const visibleExplorer = this.state.visibleExplorer\r\n    const visibleReferenceLines = this.state.visibleReferenceLines\r\n    const visibleSeriesLink = this.state.visibleSeriesLink\r\n    const visibleToolsPanel = Boolean(this.state.anchorElToolsPanel)\r\n    const mprMenu = this.state.mprMenu && this.mprPlane !== '' //  && isMultipleFiles\r\n\r\n    //let iconToolColor = this.state.toolState === 1 ? '#FFFFFF' : '#999999'\r\n\r\n    const dcmViewer = this.getActiveDcmViewer()\r\n\r\n    const sliceMax = this.state.sliceMax\r\n\r\n\r\n    return (\r\n      <div>\r\n        <AppBar className={classes.appBar} position='static' elevation={0} style={{backgroundImage:'linear-gradient(to right, #0052d4, #65c7f7, #0052d4)',borderRadius: '0px 0px 20px 20px'}}>\r\n          <Toolbar variant=\"dense\">\r\n            <IconButton edge=\"start\" className={classes.menuButton} color=\"inherit\" aria-label=\"menu\" onClick={this.toggleMainMenu}>\r\n              <MenuIcon />\r\n            </IconButton>\r\n            { this.appBarTitle(classes, isOpen, dcmViewer) }\r\n            \r\n            <div className={classes.grow} />\r\n            {/* { !isOpen && !isDicomdir ? (\r\n              <IconButton onClick={this.showAbout}>\r\n                <Icon path={mdiInformationOutline} size={iconSize} color={iconColor} />\r\n              </IconButton> \r\n             ) : null\r\n            }         */}\r\n            {/*    \r\n            { iconTool !== null && this.props.tool !== null &&  isOpen ? (\r\n                <IconButton onClick={this.toolChange}>\r\n                  <Icon path={iconTool} size={iconSize} color={iconToolColor} />\r\n                </IconButton>\r\n              ) : null\r\n            }\r\n            */}\r\n            { isOpen && dcmViewer.numberOfFrames > 1 &&  isOpen ? (\r\n              <Tooltip title=\"Cine Player\">\r\n                <IconButton onClick={this.cinePlayer}>\r\n                  <Icon path={mdiVideo} size={iconSize} color={iconColor} />\r\n                </IconButton> \r\n              </Tooltip>\r\n              ): null\r\n            }\r\n            { isOpen ? (\r\n              <Tooltip title=\"Reset Image\">\r\n                <IconButton onClick={this.resetImage}>\r\n                  <Icon path={mdiRefresh} size={iconSize} color={iconColor} />\r\n                </IconButton>\r\n              </Tooltip>\r\n             ) : null\r\n            }            \r\n            { isOpen ? (\r\n              <Tooltip title=\"Tools\">\r\n                <IconButton onClick={this.handleToolsPanel}>\r\n                  <Icon path={mdiTools} size={iconSize} color={iconColor} />\r\n                </IconButton>\r\n              </Tooltip>\r\n             ) : null\r\n            }            \r\n            { isOpen ? (\r\n              <Tooltip title=\"Save Screenshot\">\r\n                <IconButton color=\"inherit\" onClick={this.saveShot}>\r\n                  <Icon path={mdiCamera} size={iconSize} color={iconColor} />\r\n                </IconButton>\r\n              </Tooltip>\r\n             ) : null\r\n            }\r\n            {/* isOpen ? (\r\n              <Tooltip title=\"Toolbox\">\r\n                <IconButton color=\"inherit\" onClick={this.toggleToolbox}>\r\n                  <Icon path={mdiToolbox} size={iconSize} color={iconColor} />\r\n                </IconButton>\r\n              </Tooltip>\r\n              ) : null\r\n            */}              \r\n            { isOpen ? (\r\n              <Tooltip title=\"Measurements\">\r\n                <IconButton color=\"inherit\" onClick={this.toggleMeasure}>\r\n                  <Icon path={mdiFileCad} size={iconSize} color={iconColor} />\r\n                </IconButton>\r\n              </Tooltip>\r\n              ) : null\r\n            }  \r\n            { isOpen && dcmViewer.isDicom ? (\r\n              <Tooltip title=\"Dicom Header\">\r\n                <IconButton color=\"inherit\" onClick={this.toggleHeader}>\r\n                  <Icon path={mdiFileDocument} size={iconSize} color={iconColor} />\r\n                </IconButton>\r\n              </Tooltip>\r\n              ) : null\r\n            }  \r\n            { isDicomdir ? (\r\n              <Tooltip title=\"DICOMDIR\">\r\n                <IconButton color=\"inherit\" onClick={this.toggleDicomdir}>\r\n                  <Icon path={mdiFolderOpen} size={iconSize} color={iconColor} />\r\n                </IconButton>\r\n              </Tooltip>\r\n              ) : null\r\n            }    \r\n            { (isOpen && this.isMultipleFiles) || visibleMprOrthogonal ? (\r\n              <Tooltip title=\"Explorer\">\r\n                <IconButton color=\"inherit\" onClick={this.toggleExplorer}>\r\n                  <Icon path={mdiAnimationOutline} size={iconSize} color={iconColor} />\r\n                </IconButton>\r\n              </Tooltip>\r\n              ) : null\r\n            }             \r\n            { isOpen ? (\r\n              <Tooltip title=\"Sandbox File Manager\">\r\n                <IconButton color=\"inherit\" onClick={this.toggleFileManager}>\r\n                  <Icon path={mdiFileCabinet} size={iconSize} color={iconColor} />\r\n                </IconButton>\r\n              </Tooltip>\r\n              ) : null\r\n            }                        \r\n          </Toolbar>\r\n        </AppBar>\r\n\r\n        <Drawer \r\n          variant=\"persistent\"\r\n          open={visibleMainMenu} \r\n          style={{position:'relative', zIndex: 1}}\r\n          onClose={this.toggleMainMenu}\r\n        >\r\n          <div className={classes.toolbar} style={{backgroundColor:'black',height:'100%',marginTop:'10px' ,color:'#1aa3ff'}}>\r\n          <PerfectScrollbar>   \r\n            <List dense={true}>\r\n              <ListItem button onClick={() => this.showAppBar()}>\r\n                <ListItemIcon><MenuIcon /></ListItemIcon>\r\n                <ListItemText primary='Tool Bar' />\r\n              </ListItem>    \r\n              <ListItem button onClick={() => this.toggleFileManager()}>\r\n                <ListItemIcon><Icon path={mdiFileCabinet} size={iconSize} color={iconColor1} /></ListItemIcon>\r\n                <ListItemText classes={primaryClass} primary='File Manager' />\r\n              </ListItem>      \r\n              \r\n              <ListItem button onClick={() => this.toggleOpenMenu()}>\r\n                <ListItemIcon><Icon path={mdiFolderMultiple} size={iconSize} color={iconColor1} /></ListItemIcon>\r\n                <ListItemText classes={primaryClass} primary='Open ...' />\r\n                {openMenu ? <ExpandLess /> : <ExpandMore />}\r\n              </ListItem>                    \r\n              <Collapse in={openMenu} timeout=\"auto\" unmountOnExit>\r\n                <List dense={true} component=\"div\">\r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.showFileOpen()}>\r\n                    <ListItemIcon><Icon path={mdiFolder} size={'1.0rem'} color={iconColor1} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-20px'}}>File</Typography>\r\n                      } />\r\n                  </ListItem>\r\n                  {/* <ListItem button style={{paddingLeft: 30}} onClick={() => this.showOpenUrl()}>\r\n                    <ListItemIcon><Icon path={mdiWeb} size={'1.0rem'} color={iconColor} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-20px'}}>URL</Typography>\r\n                      } />\r\n                  </ListItem> */}\r\n                  { isInputDirSupported() && !isMobile?\r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.showOpenFolder()}>\r\n                    <ListItemIcon><Icon path={mdiFolderOpen} size={'1.0rem'} color={iconColor1} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-20px'}}>Folder</Typography>\r\n                      } />\r\n                  </ListItem>    \r\n                  : null }                     \r\n                  { isInputDirSupported() && !isMobile?\r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.showOpenDicomdir()}>\r\n                    <ListItemIcon><Icon path={mdiFolderOpen} size={'1.0rem'} color={iconColor} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-20px'}}>DICOMDIR</Typography>\r\n                      } />\r\n                  </ListItem>    \r\n                  : null }                                          \r\n                </List>\r\n              </Collapse>  \r\n\r\n              <ListItem button onClick={() => this.clear()}>\r\n                <ListItemIcon><Icon path={mdiDelete} size={iconSize} color={iconColor1} /></ListItemIcon>\r\n                <ListItemText classes={primaryClass} primary='Clear All' />\r\n              </ListItem>  \r\n              <ListItem button onClick={this.handleLayout}>\r\n                <ListItemIcon><Icon path={mdiViewGridPlusOutline} size={iconSize} color={iconColor1} /></ListItemIcon>\r\n                <ListItemText classes={primaryClass} primary='Layout' />              \r\n              </ListItem>   \r\n              <ListItem button onClick={() => this.showSettings()}>\r\n                <ListItemIcon><Icon path={mdiCog} size={iconSize} color={iconColor1} /></ListItemIcon>\r\n                <ListItemText classes={primaryClass} primary='Settings' />\r\n              </ListItem>                \r\n              <Divider />\r\n              <ListItem button onClick={() => this.toggleToolbox()} disabled={!isOpen}>\r\n                <ListItemIcon><Icon path={mdiChartHistogram} size={iconSize} color={iconColor1} /></ListItemIcon>\r\n                <ListItemText classes={primaryClass} primary='Histogram' />\r\n              </ListItem>  \r\n              <ListItem button onClick={() => this.toggleMpr()} disabled={!isOpen || this.mprPlane === ''}>\r\n                <ListItemIcon><Icon path={mdiAxisArrow} size={iconSize} color={iconColor1} /></ListItemIcon>\r\n                <ListItemText classes={primaryClass} primary='MPR' />\r\n                {mprMenu ? <ExpandLess /> : <ExpandMore />}\r\n              </ListItem>            \r\n\r\n              <Collapse in={mprMenu} timeout=\"auto\" unmountOnExit>\r\n                <List dense={true} component=\"div\">\r\n{/* \r\n                  <ListItem button style={{paddingLeft: 40}} onClick={() => this.mpr3D()}>\r\n                    {visibleMpr3D ? <ListItemIcon style={{marginLeft: '-10px'}}><Icon path={mdiCheck} size={'1.0rem'} color={iconColor} /></ListItemIcon> : null}\r\n                    <ListItemText \r\n                      style={visibleMpr3D ? {marginLeft: '-7px'} : {marginLeft: '40px'}}\r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>3D</Typography>\r\n                      } />\r\n                  </ListItem>\r\n*/}\r\n                  <ListItem button style={{paddingLeft: 40}} onClick={() => this.mprOrthogonal()}>\r\n                    {visibleMprOrthogonal ? <ListItemIcon style={{marginLeft: '-10px'}}><Icon path={mdiCheck} size={'1.0rem'} color={iconColor1} /></ListItemIcon> : null}\r\n                    <ListItemText \r\n                      style={visibleMprOrthogonal ? {marginLeft: '-7px'} : {marginLeft: '40px'}}\r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Orthogonal</Typography>\r\n                      } />\r\n                  </ListItem>\r\n                  <ListItem button style={{paddingLeft: 40}} onClick={() => this.mprCoronal()}>\r\n                    {visibleMprCoronal ? <ListItemIcon style={{marginLeft: '-10px'}}><Icon path={mdiCheck} size={'1.0rem'} color={iconColor1} /></ListItemIcon> : null}\r\n                    <ListItemText \r\n                      style={visibleMprCoronal ? {marginLeft: '-7px'} : {marginLeft: '40px'}}\r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Coronal</Typography>\r\n                      } />\r\n                  </ListItem>    \r\n                  <ListItem button style={{paddingLeft: 40}} onClick={() => this.mprSagittal()}>\r\n                    {visibleMprSagittal ? <ListItemIcon style={{marginLeft: '-10px'}}><Icon path={mdiCheck} size={'1.0rem'} color={iconColor1} /></ListItemIcon> : null}  \r\n                    <ListItemText \r\n                      style={visibleMprSagittal ? {marginLeft: '-7px'} : {marginLeft: '40px'}}\r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Sagittal</Typography>\r\n                      } />\r\n                  </ListItem>    \r\n                  <ListItem button style={{paddingLeft: 40}} onClick={() => this.mprAxial()}>\r\n                    {visibleMprAxial ? <ListItemIcon style={{marginLeft: '-10px'}}><Icon path={mdiCheck} size={'1.0rem'} color={iconColor1} /></ListItemIcon> : null}  \r\n                    <ListItemText \r\n                      style={visibleMprAxial ? {marginLeft: '-7px'} : {marginLeft: '40px'}}\r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Axial</Typography>\r\n                      } />\r\n                  </ListItem>                                               \r\n                </List>\r\n              </Collapse>  \r\n\r\n              <ListItem button onClick={() => this.toggleImageEdit()} disabled={!isOpen}>\r\n                <ListItemIcon><Icon path={mdiImageEdit} size={iconSize} color={iconColor1} /></ListItemIcon>\r\n                <ListItemText classes={primaryClass} primary='Edit' />\r\n                {openImageEdit ? <ExpandLess /> : <ExpandMore />}\r\n              </ListItem>          \r\n              <Collapse in={openImageEdit} timeout=\"auto\" unmountOnExit>\r\n                <List dense={true} component=\"div\">\r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Invert')}>\r\n                    <ListItemIcon><Icon path={mdiInvertColors} size={iconSize} color={iconColor1} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} primary=\"Invert\" />\r\n                  </ListItem>\r\n                </List>\r\n              </Collapse>   \r\n              <ListItem button onClick={() => this.toggleTools()} disabled={!isOpen}>\r\n                <ListItemIcon><Icon path={mdiTools} size={iconSize} color={iconColor1} /></ListItemIcon>\r\n                <ListItemText classes={primaryClass} primary='Tools' />\r\n                {openTools ? <ExpandLess /> : <ExpandMore />}\r\n              </ListItem>   \r\n              <Collapse in={openTools} timeout=\"auto\" unmountOnExit>\r\n                <List dense={true} component=\"div\">\r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('notool')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiCursorDefault} size={iconSizeSmall} color={this.colorIcon('notool')} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>No Tool</Typography>\r\n                      }\r\n                    />\r\n                  </ListItem>     \r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('referencelines')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiArrowSplitHorizontal} size={iconSizeSmall} color={visibleReferenceLines ? activeColor : iconColor1} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass}\r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Reference Lines</Typography>\r\n                      }\r\n                    />\r\n                  </ListItem>        \r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('serieslink')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiVectorLink} size={iconSizeSmall} color={visibleSeriesLink ? activeColor : iconColor1} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass}\r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Link Series</Typography>\r\n                      }\r\n                    />\r\n                  </ListItem>                               \r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Wwwc')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiArrowAll} size={iconSize} color={this.colorIcon('Wwwc')} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass}\r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>WW/WC</Typography>\r\n                      }\r\n                    />\r\n                  </ListItem>  \r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Pan')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiCursorPointer} size={iconSize} color={this.colorIcon('Pan')} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Pan</Typography>\r\n                      } \r\n                    />\r\n                  </ListItem>  \r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Zoom')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiMagnify} size={iconSize} color={this.colorIcon('Zoom')} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Zoom</Typography>\r\n                      } \r\n                    />\r\n                  </ListItem>      \r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Magnify')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiCheckboxIntermediate} size={iconSize} color={this.colorIcon('Magnify')} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Magnify</Typography>\r\n                      } \r\n                    />\r\n                  </ListItem>       \r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Length')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiRuler} size={iconSize} color={this.colorIcon('Length')} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Length</Typography>\r\n                      }  \r\n                    />\r\n                  </ListItem>        \r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Probe')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiEyedropper} size={iconSize} color={this.colorIcon('Probe')} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Probe</Typography>\r\n                      } \r\n                    />\r\n                  </ListItem> \r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('Angle')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiAngleAcute} size={iconSize} color={this.colorIcon('Angle')} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Angle</Typography>\r\n                      }  \r\n                    />\r\n                  </ListItem>  \r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('EllipticalRoi')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiEllipse} size={iconSize} color={this.colorIcon('EllipticalRoi')} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Elliptical Roi</Typography>\r\n                      } \r\n                    />\r\n                  </ListItem>     \r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('RectangleRoi')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiRectangle} size={iconSize} color={this.colorIcon('RectangleRoi')} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Rectangle Roi</Typography>\r\n                      } \r\n                    />\r\n                  </ListItem> \r\n                  <ListItem button style={{paddingLeft: 30}} onClick={() => this.toolExecute('FreehandRoi')} disabled={!isOpen}>\r\n                    <ListItemIcon><Icon path={mdiGesture} size={iconSize} color={this.colorIcon('FreehandRoi')} /></ListItemIcon>\r\n                    <ListItemText classes={primaryClass} \r\n                      primary={\r\n                        <Typography type=\"body1\" style={{fontSize: '0.80em', marginLeft: '-23px'}}>Freehand Roi</Typography>\r\n                      } \r\n                    />\r\n                  </ListItem> \r\n                </List>\r\n              </Collapse> \r\n\r\n            </List>\r\n            \r\n            { this.isMultipleFiles || mprMenu ?\r\n              <div>     \r\n                <Divider />     \r\n                <div align='center'>\r\n                  <IconButton onClick={this.listOpenFilesFirstFrame} size='small'>\r\n                    <Icon path={mdiSkipBackward} size={'1.0rem'} color={iconColor} />\r\n                  </IconButton>\r\n                  <IconButton onClick={this.listOpenFilesPreviousFrame} size='small'>\r\n                      <Icon path={mdiSkipPrevious} size={'1.0rem'} color={iconColor} />\r\n                  </IconButton>\r\n                  <IconButton onClick={this.listOpenFilesScrolling} size='small'>\r\n                    <Icon path={this.state.listOpenFilesScrolling ? mdiPause : mdiPlay} size={'1.0rem'} color={iconColor} />\r\n                  </IconButton>\r\n                  <IconButton onClick={this.listOpenFilesNextFrame} size='small'>\r\n                      <Icon path={mdiSkipNext} size={'1.0rem'} color={iconColor} />\r\n                  </IconButton>\r\n                  <IconButton onClick={this.listOpenFilesLastFrame} size='small'>\r\n                      <Icon path={mdiSkipForward} size={'1.0rem'} color={iconColor} />\r\n                  </IconButton>                \r\n                </div>  \r\n                <div style={{textAlign: 'center'}}>\r\n                  <Typography type=\"body1\" style={{fontSize: '0.80em'}}>{`${this.state.sliceIndex+1} / ${sliceMax}`}</Typography>\r\n                </div>  \r\n                <div style={{width: '130px', margin: 'auto'}}>\r\n                  <Slider\r\n                    style={{marginTop: '-4px'}}\r\n                    value={this.state.sliceIndex}\r\n                    onChange={this.handleSliceChange}\r\n                    color=\"secondary\"\r\n                    min={0}\r\n                    max={sliceMax-1}\r\n                    step={100/sliceMax}\r\n                  />\r\n                </div>\r\n              </div> : null\r\n            }\r\n\r\n          </PerfectScrollbar>   \r\n          </div>\r\n        </Drawer>       \r\n\r\n        <Drawer\r\n          variant=\"persistent\"\r\n          anchor='right'\r\n          open={visibleHeader}\r\n          onClose={this.toggleHeader}\r\n        >\r\n          { visibleHeader ? <DicomHeader dcmViewer={dcmViewer} classes={classes} color={iconColor} /> : null } \r\n        </Drawer>\r\n\r\n        <Drawer\r\n          variant=\"persistent\"\r\n          anchor='right'\r\n          open={visibleMeasure}\r\n          onClose={this.toggleMeasure}\r\n        >\r\n          <div style={{marginTop: '48px'}}>\r\n            <Toolbar variant=\"dense\">\r\n              <Typography variant=\"subtitle1\" className={classes.title}>\r\n                Measurements&nbsp;&nbsp;\r\n              </Typography>\r\n              <div className={classes.grow} />\r\n              <IconButton color=\"inherit\" onClick={this.saveMeasure} edge=\"end\">\r\n                <Icon path={mdiContentSaveOutline} size={iconSize} color={iconColor} />\r\n              </IconButton>\r\n              <IconButton color=\"inherit\" onClick={this.clearMeasure} edge=\"end\">\r\n                <Icon path={mdiTrashCanOutline} size={iconSize} color={iconColor} />\r\n              </IconButton>\r\n            </Toolbar>\r\n            <div>  \r\n              { isOpen ? <Measurements dcmViewer={dcmViewer} toolRemove={this.toolRemove} classes={classes} /> : null } \r\n            </div>\r\n          </div>\r\n        </Drawer>  \r\n\r\n        <Drawer\r\n          variant=\"persistent\"\r\n          anchor='right'\r\n          open={visibleToolbox}\r\n          onClose={this.toggleToolbox}\r\n        >\r\n          <div style={{marginTop: '48px'}}>\r\n            <div>  \r\n              { isOpen ? <Histogram key={dcmViewer.filename} /> : null } \r\n            </div>\r\n          </div>\r\n        </Drawer>          \r\n\r\n        <Drawer\r\n          variant=\"persistent\"\r\n          anchor={getSettingsDicomdirView()}\r\n          open={visibleDicomdir}\r\n          onClose={this.toggleDicomdir}\r\n        >\r\n          <div>\r\n            <div>  \r\n              {visibleDicomdir ? <Dicomdir onOpenFile={this.handleOpenFileDicomdir} onOpenFs={this.handleOpenSandboxFs} /> : null} \r\n            </div>\r\n          </div>\r\n        </Drawer>   \r\n\r\n        <Drawer\r\n          variant=\"persistent\"\r\n          anchor={getSettingsFsView()}\r\n          open={visibleFileManager}\r\n          onClose={this.toggleFileManager}\r\n        >\r\n          <div>\r\n            <div>\r\n              {visibleFileManager ? \r\n                <FsUI \r\n                  onOpen={this.handleOpenSandboxFs} \r\n                  onOpenImage={this.handleOpenImage} \r\n                  onOpenMultipleFilesCompleted={this.openMultipleFilesCompleted}\r\n                  onOpenDicomdir={this.handleOpenFsDicomdir} \r\n                  color={iconColor} \r\n                /> \r\n              : null}\r\n            </div>\r\n          </div>\r\n        </Drawer>       \r\n\r\n        {visibleSettings ? <Settings onClose={this.hideSettings}/> : null}\r\n\r\n        {visibleAbout ? <AboutDlg onClose={this.showAbout}/> : null}\r\n\r\n        {visibleDownloadZipDlg ? <DownloadZipDlg onClose={this.hideDownloadZipDlg} url={this.url} /> : null}\r\n\r\n        {visibleOpenMultipleFilesDlg ? <OpenMultipleFilesDlg onClose={this.hideOpenMultipleFilesDlg} files={this.files} origin={'local'} /> : null}\r\n\r\n        <Dialog\r\n            open={visibleClearMeasureDlg}\r\n            onClose={this.hideClearMeasureDlg}\r\n        >\r\n            <DialogTitle>{\"Are you sure to remove all the measurements?\"}</DialogTitle>\r\n            <DialogActions>\r\n                <Button onClick={this.hideClearMeasureDlg}>\r\n                    Cancel\r\n                </Button>\r\n                <Button onClick={this.confirmClearMeasureDlg} autoFocus>\r\n                    Ok\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n\r\n        <Dialog\r\n            open={visibleZippedFileDlg}\r\n            onClose={this.hideZippedFileDlg}\r\n        >\r\n            <DialogTitle>{\"This is a zipped file, would you import into sandbox file system?\"}</DialogTitle>\r\n            <DialogActions>\r\n                <Button onClick={this.hideZippedFileDlg}>\r\n                    Cancel\r\n                </Button>\r\n                <Button onClick={this.confirmZippedFileDlg} autoFocus>\r\n                    Ok\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n\r\n        <Dialog\r\n            open={this.state.visibleOpenUrl}\r\n        >\r\n            <DialogTitle>{\"Open URL\"}</DialogTitle>\r\n              <DialogContent>\r\n                <DialogContentText>\r\n                  Insert an URL to download a DICOM or image file:\r\n                </DialogContentText>\r\n                <TextField\r\n                    autoFocus\r\n                    margin=\"dense\"\r\n                    id=\"id-open-url\"\r\n                    inputRef={input => (this.openUrlField = input)}\r\n                    fullWidth\r\n                />\r\n              </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={() => this.hideOpenUrl(false)} >\r\n                    Cancel\r\n                </Button>\r\n                <Button onClick={() => this.hideOpenUrl(true)} autoFocus>\r\n                    Ok\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n\r\n        <Dialog\r\n            open={this.state.visibleMessage}\r\n        >\r\n            <DialogTitle>{this.state.titleMessage}</DialogTitle>\r\n              <DialogContent>\r\n                <DialogContentText>\r\n                  {this.state.textMessage}\r\n                </DialogContentText>\r\n              </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={() => this.setState({visibleMessage: false})} >\r\n                    Cancel\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n\r\n        <Popover\r\n          id={'id-layout'}\r\n          open={visibleLayout}\r\n          anchorEl={this.state.anchorElLayout}\r\n          onClose={this.closeLayout}\r\n          anchorOrigin={{\r\n            vertical: 'center',\r\n            horizontal: 'right',\r\n          }}\r\n          transformOrigin={{\r\n            vertical: 'center',\r\n            horizontal: 'left',\r\n          }}\r\n        >\r\n          <LayoutTool \r\n            row={this.props.layout[0]-1} \r\n            col={this.props.layout[1]-1}\r\n            onChange={this.changeLayout}\r\n          />  \r\n        </Popover>     \r\n        \r\n        <Popover\r\n          id={'id-tools'}\r\n          open={visibleToolsPanel}\r\n          anchorEl={this.state.anchorElToolsPanel}\r\n          onClose={this.closeToolsPanel}\r\n          anchorOrigin={{\r\n            vertical: 'bottom',\r\n            horizontal: 'right',\r\n          }}\r\n          transformOrigin={{\r\n            vertical: 'top',\r\n            horizontal: 'center',\r\n          }}\r\n        >\r\n          <ToolsPanel \r\n            toolActive={this.state.toolActive}\r\n            referenceLines={visibleReferenceLines}\r\n            seriesLink={visibleSeriesLink}\r\n            toolExecute={this.toolExecute}\r\n            onChange={this.changeLayout}\r\n          />  \r\n        </Popover>               \r\n\r\n        <Snackbar\r\n          anchorOrigin={{\r\n            vertical: 'top',\r\n            horizontal: 'center',\r\n          }}\r\n          open={visibleVolumeBuilding}\r\n          autoHideDuration={6000}\r\n          message=\"Volume building, wait please ...\"\r\n        />\r\n\r\n        <div style={{height: 'calc(100vh - 48px)'}}>\r\n          {this.buildLayoutGrid()}  \r\n        </div>\r\n\r\n        <Drawer\r\n          variant=\"persistent\"\r\n          anchor='right'\r\n          open={visibleExplorer}\r\n          onClose={this.toggleExplorer}\r\n        >\r\n          <div>\r\n            <div>\r\n              {visibleExplorer ? \r\n                <Explorer \r\n                  explorer={this.explorer}\r\n                  onSelectSeries={this.explorerOnSelectSeries}\r\n                  color={iconColor} \r\n                /> \r\n              : null}\r\n            </div>\r\n          </div>\r\n        </Drawer>   \r\n\r\n        <div>\r\n          <input\r\n            type=\"file\"\r\n            id=\"file_open\"\r\n            style={{ display: \"none\" }}\r\n            ref={this.fileOpen}\r\n            onChange={e => this.handleOpenLocalFs(e.target.files)}\r\n            multiple\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <input\r\n            type=\"file\"\r\n            id=\"file_dicomdir\"\r\n            style={{ display: \"none\" }}\r\n            ref={this.openDicomdir}\r\n            onChange={e => this.handleOpenDicomdir(e.target.files)}\r\n            webkitdirectory=\"\" mozdirectory=\"\" directory=\"\" multiple\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <input\r\n            type=\"file\"\r\n            id=\"file_folder\"\r\n            style={{ display: \"none\" }}\r\n            ref={this.openFolder}\r\n            onChange={e => this.handleOpenFolder(e.target.files)}\r\n            webkitdirectory=\"\" mozdirectory=\"\" directory=\"\" multiple\r\n          />\r\n        </div>    \r\n\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    localFileStore: state.localFileStore,\r\n    //allFiles: state.allFiles,\r\n    files: state.files,\r\n    series: state.series,\r\n    isOpen: state.isOpen,\r\n    tool: state.tool,\r\n    activeDcmIndex: state.activeDcmIndex,\r\n    explorerActivePatientIndex: state.explorerActivePatientIndex,\r\n    explorerActiveStudyIndex: state.explorerActiveStudyIndex,\r\n    explorerActiveSeriesIndex: state.explorerActiveSeriesIndex,\r\n    measurements: state.measurements,\r\n    layout: state.layout,\r\n    dicomdir: state.dicomdir,\r\n    fsZippedFile: state.fsZippedFile,\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    clearingStore: () => dispatch(clearStore()),\r\n    setLocalFileStore: (file) => dispatch(localFileStore(file)),\r\n    toolStore: (tool) => dispatch(dcmTool(tool)),\r\n    isOpenStore: (value) => dispatch(dcmIsOpen(value)),\r\n    setActiveDcm: (dcm) => dispatch(activeDcm(dcm)),\r\n    setActiveDcmIndex: (index) => dispatch(activeDcmIndex(index)),\r\n    setActiveMeasurements: (measurements) => dispatch(activeMeasurements(measurements)),\r\n    setLayoutStore: (row, col) => dispatch(setLayout(row, col)),\r\n    setDicomdirStore: (dicomdir) => dispatch(setDicomdir(dicomdir)),\r\n    setFsZippedFile: (file) => dispatch(setZippedFile(file)),\r\n    setVolumeStore: (file) => dispatch(setVolume(file)),\r\n    setFilesStore: (files) => dispatch(filesStore(files)),\r\n    setExplorerActiveSeriesIndex: (index) => dispatch(explorerActiveSeriesIndex(index)),\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(App))\r\n","\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n\r\n    window.location.hostname === '[::1]' ||\r\n\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import {createStore} from 'redux'\r\nimport storeReducer from '../reducers/index'\r\n\r\nlet initialState = {\r\n    localFile: null,\r\n    fsFile: null,\r\n    //allFiles: null,\r\n    files: null,\r\n    series: null,\r\n    isOpen: new Array(16).fill(false),\r\n    tool: null,\r\n    activeDcmIndex: 0,\r\n    activeDcm: null,\r\n    explorer: null,\r\n    explorerActivePatientIndex: 0,\r\n    explorerActiveStudyIndex: 0,\r\n    explorerActiveSeriesIndex: 0,\r\n    measurements: [],\r\n    layout: [1,1], // first element represents the rows, second the columns\r\n    dicomdir: null,\r\n    fsCurrentDir: '',\r\n    fsCurrentList: [],\r\n    fsZippedFile: null,\r\n    fsRefresh: false,\r\n    volume: null,\r\n    dcmEnableTool: false,\r\n}\r\n\r\nconst store = createStore(storeReducer, initialState,\r\n    window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__())\r\n\r\nexport default store\r\n","import {\r\n  CLEAR_STORE, \r\n  LOCALFILE_STORE,\r\n  FSFILE_STORE,\r\n  //ALLFILES_STORE,\r\n  FILES_STORE,\r\n  SERIES_STORE,\r\n  DCM_IS_OPEN, \r\n  DCM_TOOL, \r\n  ACTIVE_DCM_INDEX, \r\n  ACTIVE_DCM,\r\n  ACTIVE_MEASUREMENTS,\r\n  EXPLORER_STORE,\r\n  EXPLORER_ACTIVE_PATIENT_INDEX,\r\n  EXPLORER_ACTIVE_STUDY_INDEX,\r\n  EXPLORER_ACTIVE_SERIES_INDEX,\r\n  LAYOUT,\r\n  DICOMDIR,\r\n  FSCURRENTDIR,\r\n  FSCURRENTLIST,\r\n  FSZIPPEDFILE,\r\n  FSREFRESH,\r\n  VOLUME_STORE,\r\n  DCMENABLETOOL_STORE,\r\n} from '../actions'\r\n\r\nexport default function storeReducer(state={}, action) {\r\n    //console.log('storeReducer: ', action)\r\n    switch(action.type) {\r\n      \r\n      case CLEAR_STORE:\r\n        return {\r\n          localFile: state.localFile,\r\n          fsFile: state.fsFile,\r\n          //allfiles: null,\r\n          files: null, \r\n          series: null,\r\n          isOpen: state.isOpen.map((el, i) => i === state.activeDcmIndex ? false : el),\r\n          tool: null,\r\n          activeDcmIndex: state.activeDcmIndex,\r\n          activeDcm: state.activeDcm,\r\n          explorer: state.explorer,\r\n          explorerActivePatientIndex: state.explorerActivePatientIndex,\r\n          explorerActiveStudyIndex: state.explorerActiveStudyIndex,\r\n          explorerActiveSeriesIndex: state.explorerActiveSeriesIndex,\r\n          measurements: null,\r\n          layout: state.layout,\r\n          dicomdir: state.dicomdir, \r\n          fsCurrentDir: state.fsCurrentDir,\r\n          fsCurrentList: state.fsCurrentList,\r\n          fsZippedFile: null,\r\n          fsRefresh: state.fsRefresh,\r\n          volume: null,\r\n          //lut: null,\r\n          dcmEnableTool: false\r\n        }    \r\n\r\n      case LOCALFILE_STORE:\r\n          return {\r\n            ...state,\r\n            localFile: action.localFile,     \r\n            fsFile: null,   \r\n          } \r\n\r\n      case FSFILE_STORE:\r\n          return {\r\n            ...state,\r\n            localFile: null,     \r\n            fsFile: action.fsFile,   \r\n          }\r\n/*\r\n      case ALLFILES_STORE:\r\n          return {\r\n            ...state,\r\n            allFiles: action.allFiles,  \r\n          } \r\n*/\r\n      case FILES_STORE:\r\n          return {\r\n            ...state,\r\n            files: action.files,  \r\n          } \r\n\r\n      case SERIES_STORE:\r\n          return {\r\n            ...state,\r\n            series: action.series,  \r\n          }\r\n\r\n      case DCM_IS_OPEN:\r\n          return {\r\n            ...state,\r\n            isOpen: state.isOpen.map((el, i) => i === action.value.index ? action.value.value : el),    \r\n            measurements: state.measurements,\r\n            layout: state.layout,    \r\n            dicomdir: state.dicomdir,    \r\n            fsCurrentDir: state.fsCurrentDir,\r\n            fsCurrentList: state.fsCurrentList,            \r\n          }    \r\n\r\n      case DCM_TOOL:\r\n          return {\r\n            ...state,\r\n            tool: action.tool,\r\n            measurements: state.measurements,\r\n            layout: state.layout,\r\n            dicomdir: state.dicomdir,\r\n            fsCurrentDir: state.fsCurrentDir,\r\n            fsCurrentList: state.fsCurrentList,  \r\n          }  \r\n\r\n      case ACTIVE_DCM_INDEX:\r\n          return {\r\n            ...state,\r\n            activeDcmIndex: action.activeDcmIndex,\r\n            measurements: state.measurements,\r\n            layout: state.layout,\r\n            dicomdir: state.dicomdir,\r\n            fsCurrentDir: state.fsCurrentDir,\r\n            fsCurrentList: state.fsCurrentList,  \r\n          }  \r\n\r\n      case ACTIVE_DCM:\r\n          return {\r\n            ...state,\r\n            activeDcm: action.activeDcm,\r\n            measurements: state.measurements,\r\n            layout: state.layout,\r\n            dicomdir: state.dicomdir,\r\n            fsCurrentDir: state.fsCurrentDir,\r\n            fsCurrentList: state.fsCurrentList,  \r\n          }            \r\n\r\n      case ACTIVE_MEASUREMENTS:\r\n        return {\r\n          ...state,\r\n          measurements: [...action.measurements],\r\n        }  \r\n\r\n      case EXPLORER_STORE:\r\n        return {\r\n          ...state,\r\n          explorer: action.explorer,\r\n        }  \r\n\r\n      case EXPLORER_ACTIVE_PATIENT_INDEX:\r\n        return {\r\n          ...state,\r\n          explorerActivePatientIndex: action.explorerActivePatientIndex,\r\n        }\r\n\r\n      case EXPLORER_ACTIVE_STUDY_INDEX:\r\n        return {\r\n          ...state,\r\n          explorerActiveStudyIndex: action.explorerActiveStudyIndex,\r\n        }\r\n\r\n      case EXPLORER_ACTIVE_SERIES_INDEX:\r\n        return {\r\n          ...state,\r\n          explorerActiveSeriesIndex: action.explorerActiveSeriesIndex,\r\n        }    \r\n\r\n      case LAYOUT:\r\n            return {\r\n              ...state,\r\n              measurements: state.measurements,\r\n              layout: action.layout,\r\n              dicomdir: state.dicomdir,\r\n              fsCurrentDir: state.fsCurrentDir,\r\n              fsCurrentList: state.fsCurrentList,  \r\n            }  \r\n\r\n      case DICOMDIR:\r\n            return {\r\n              ...state,\r\n              dicomdir: action.dicomdir\r\n            }  \r\n\r\n      case FSCURRENTDIR:\r\n            return {\r\n              ...state,\r\n              fsCurrentDir: action.fsCurrentDir\r\n            }  \r\n\r\n      case FSCURRENTLIST:\r\n            return {\r\n              ...state,\r\n              fsCurrentList: [...action.fsCurrentList]\r\n            }  \r\n\r\n      case FSZIPPEDFILE:\r\n            return {\r\n              ...state,\r\n              fsZippedFile: action.fsZippedFile\r\n            }  \r\n\r\n      case FSREFRESH:\r\n            return {\r\n              ...state,\r\n              fsRefresh: !state.fsRefresh\r\n            }  \r\n\r\n      case VOLUME_STORE:\r\n        return {\r\n          ...state,\r\n          volume: action.volume,        \r\n        }      \r\n\r\n      case DCMENABLETOOL_STORE:\r\n        return {\r\n          ...state,\r\n          dcmEnableTool: action.dcmEnableTool,        \r\n        }   \r\n\r\n      default:\r\n          return state\r\n    }\r\n  }\r\n  ","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport './index.css'\r\nimport App from './App'\r\nimport * as serviceWorker from './serviceWorker'\r\nimport WebFontLoader from 'webfontloader'\r\nimport {Provider} from 'react-redux'\r\nimport store from './store'\r\nimport { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles'\r\n\r\nWebFontLoader.load({\r\n    google: {\r\n        families: ['Roboto:300,400,500,700', 'Material Icons'],\r\n    },\r\n})\r\n\r\n//store.subscribe(() => console.log('store updated:', store.getState()));\r\n\r\nconst theme = createMuiTheme({\r\n    overrides: {\r\n        MuiFormControlLabel: {\r\n            label: {\r\n                fontSize: '0.85em'\r\n            },\r\n        },\r\n        MuiFormLabel: {\r\n            root: { \r\n                '&$focused': {\r\n                    color:'#CCCCCC',\r\n                },   \r\n            }\r\n         \r\n        }\r\n    },\r\n    palette: {\r\n        primary: {\r\n            main: '#004d40',\r\n        },\r\n        secondary: {\r\n            main: '#888888',\r\n        },\r\n        type: 'dark',\r\n    },\r\n  })\r\n\r\n  \r\nReactDOM.render(\r\n    <Provider store={store}>\r\n        <MuiThemeProvider theme = { theme }>\r\n            <App />\r\n        </MuiThemeProvider>\r\n    </Provider>, \r\n    document.getElementById('root')\r\n)\r\n\r\nserviceWorker.register()\r\n "],"sourceRoot":""}